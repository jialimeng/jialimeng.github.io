<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="冒险，创新，永不放弃">
<meta property="og:type" content="website">
<meta property="og:title" content="Tech Blog">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="Tech Blog">
<meta property="og:description" content="冒险，创新，永不放弃">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="David Meng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Tech Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a href="https://github.com/jialimeng" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Tech Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/25/Linux/Driver/storage/Flash%20Memory/mmc/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91eMMC%E5%88%86%E5%8C%BA%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="David Meng">
      <meta itemprop="description" content="冒险，创新，永不放弃">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tech Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/25/Linux/Driver/storage/Flash%20Memory/mmc/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91eMMC%E5%88%86%E5%8C%BA%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">【转载】eMMC分区管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-12-25 10:48:04 / Modified: 10:54:24" itemprop="dateCreated datePublished" datetime="2020-12-25T10:48:04+08:00">2020-12-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/" itemprop="url" rel="index"><span itemprop="name">Driver</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/storage/" itemprop="url" rel="index"><span itemprop="name">storage</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/storage/Flash-Memory/" itemprop="url" rel="index"><span itemprop="name">Flash Memory</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/storage/Flash-Memory/mmc/" itemprop="url" rel="index"><span itemprop="name">mmc</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>[TOC]</p>
<h2 id="1-Partitions-Overview"><a href="#1-Partitions-Overview" class="headerlink" title="1. Partitions Overview"></a>1. Partitions Overview</h2><p>eMMC 标准中，将内部的 Flash Memory 划分为 4 类区域，最多可以支持 8 个硬件分区，如下图所示：</p>
<p><img src="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/emmc_partitions.png" alt="img"></p>
<h3 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1.1 概述"></a>1.1 概述</h3><p>一般情况下，Boot Area Partitions 和 RPMB Partition 的容量大小通常都为 4MB，部分芯片厂家也会提供配置的机会。General Purpose Partitions (GPP) 则在出厂时默认不被支持，即不存在这些分区，需要用户主动使能，并配置其所要使用的 GPP 的容量大小，GPP 的数量可以为 1 - 4 个，各个 GPP 的容量大小可以不一样。User Data Area (UDA) 的容量大小则为总容量大小减去其他分区所占用的容量。更多各个分区的细节将在后续小节中描述。</p>
<h3 id="1-2-分区编址"><a href="#1-2-分区编址" class="headerlink" title="1.2 分区编址"></a>1.2 分区编址</h3><p>eMMC 的每一个硬件分区的存储空间都是独立编址的，即访问地址为 0 - partition size。具体的数据读写操作实际访问哪一个硬件分区，是由 eMMC 的 Extended CSD register 的 PARTITION_CONFIG Field 中 的 Bit[2:0]: PARTITION_ACCESS 决定的，用户可以通过配置 PARTITION_ACCESS 来切换硬件分区的访问。也就是说，用户在访问特定的分区前，需要先发送命令，配置 PARTITION_ACCESS，然后再发送相关的数据访问请求。更多数据读写相关的细节，请参考 <a href="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/emmc_bus_protocol.html" target="_blank" rel="noopener">eMMC 总线协议</a> 章节。</p>
<p>eMMC 的各个硬件分区有其自身的功能特性，多分区的设计，为不同的应用场景提供了便利。</p>
<h2 id="2-Boot-Area-Partitions"><a href="#2-Boot-Area-Partitions" class="headerlink" title="2. Boot Area Partitions"></a>2. Boot Area Partitions</h2><p>Boot Area 包含两个 Boot Area Partitions，主要用于存储 Bootloader，支持 SOC 从 eMMC 启动系统。</p>
<h3 id="2-1-容量大小"><a href="#2-1-容量大小" class="headerlink" title="2.1 容量大小"></a>2.1 容量大小</h3><p>两个 Boot Area Partitions 的大小是完全一致的，由 Extended CSD register 的 BOOT_SIZE_MULT Field 决定，大小的计算公式如下：</p>
<p><strong>Size = 128Kbytes x BOOT_SIZE_MULT</strong></p>
<p>一般情况下，Boot Area Partition 的大小都为 4 MB，即 BOOT_SIZE_MULT 为 32，部分芯片厂家会提供改写 BOOT_SIZE_MULT 的功能来改变 Boot Area Partition 的容量大小。BOOT_SIZE_MULT 最大可以为 255，即 Boot Area Partition 的最大容量大小可以为 255 x 128 KB = 32640 KB = 31.875 MB。</p>
<h3 id="2-2-从-Boot-Area-启动"><a href="#2-2-从-Boot-Area-启动" class="headerlink" title="2.2 从 Boot Area 启动"></a>2.2 从 Boot Area 启动</h3><p>eMMC 中定义了 Boot State，在 Power-up、HW reset 或者 SW reset 后，如果满足一定的条件，eMMC 就会进入该 State。进入 Boot State 的条件如下：</p>
<p><strong>Original Boot Operation</strong><br>CMD 信号保持低电平不少于 74 个时钟周期，会触发 Original Boot Operation，进入 Boot State。</p>
<p><img src="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/original_boot.png" alt="img"></p>
<p><strong>Alternative Boot Operation</strong><br>在 74 个时钟周期后，在 CMD 信号首次拉低或者 Host 发送 CMD1 之前，Host 发送参数为 0xFFFFFFFA 的 COM0时，会触发 Alternative Boot Operation，进入 Boot State。</p>
<p><img src="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/alternative_boot.png" alt="img"></p>
<p>在 Boot State 下，如果有配置 BOOT_ACK，eMMC 会先发送 “010” 的 ACK 包，接着 eMMC 会将最大为 128Kbytes x BOOT_SIZE_MULT 的 Boot Data 发送给 Host。传输过程中，Host 可以通过拉高 CMD 信号 (Original Boot 中)，或者发送 Reset 命令 (Alternative Boot 中) 来中断 eMMC 的数据发送，完成 Boot Data 传输。</p>
<p>Boot Data 根据 Extended CSD register 的 PARTITION_CONFIG Field 的 Bit[5:3]:BOOT_PARTITION_ENABLE 的设定，可以从 Boot Area Partition 1、Boot Area Partition 2 或者 User Data Area 读出。</p>
<blockquote>
<p>Boot Data 存储在 Boot Area 比在 User Data Area 中要更加的安全，可以减少意外修改导致系统无法启动，同时无法更新系统的情况出现。</p>
</blockquote>
<p>（更多 Boot State 的细节，请参考 <a href="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/emmc_modes.html" target="_blank" rel="noopener">eMMC 工作模式</a> 的 Boot Mode 章节）</p>
<h3 id="2-3-写保护"><a href="#2-3-写保护" class="headerlink" title="2.3 写保护"></a>2.3 写保护</h3><p>通过设定 Extended CSD register 的 BOOT_WP Field，可以为两个 Boot Area Partition 独立配置写保护功能,以防止数据被意外改写或者擦出。</p>
<p>eMMC 中定义了两种 Boot Area 的写保护模式：</p>
<ol>
<li>Power-on write protection，使能后，如果 eMMC 掉电，写保护功能失效，需要每次 Power on 后进行配置</li>
<li>Permanent write protection，使能后，即使掉电也不会失效，主动进行关闭才会失效</li>
</ol>
<h2 id="3-RPMB-Partition"><a href="#3-RPMB-Partition" class="headerlink" title="3. RPMB Partition"></a>3. RPMB Partition</h2><p>RPMB（Replay Protected Memory Block）Partition 是 eMMC 中的一个具有安全特性的分区。<br>eMMC 在写入数据到 RPMB 时，会校验数据的合法性，只有指定的 Host 才能够写入，同时在读数据时，也提供了签名机制，保证 Host 读取到的数据是 RPMB 内部数据，而不是攻击者伪造的数据。</p>
<p>RPMB 在实际应用中，通常用于存储一些有防止非法篡改需求的数据，例如手机上指纹支付相关的公钥、序列号等。RPMB 可以对写入操作进行鉴权，但是读取并不需要鉴权，任何人都可以进行读取的操作，因此存储到 RPMB 的数据通常会进行加密后再存储。</p>
<h3 id="3-1-容量大小"><a href="#3-1-容量大小" class="headerlink" title="3.1 容量大小"></a>3.1 容量大小</h3><p>两个 RPMB Partition 的大小是由 Extended CSD register 的 BOOT_SIZE_MULT Field 决定，大小的计算公式如下：</p>
<p><strong>Size = 128Kbytes x BOOT_SIZE_MULT</strong></p>
<p>一般情况下，Boot Area Partition 的大小为 4 MB，即 RPMB_SIZE_MULT 为 32，部分芯片厂家会提供改写 RPMB_SIZE_MULT 的功能来改变 RPMB Partition 的容量大小。RPMB_SIZE_MULT 最大可以为 128，即 Boot Area Partition 的最大容量大小可以为 128 x 128 KB = 16384 KB = 16 MB。</p>
<h3 id="3-2-Replay-Protect-原理"><a href="#3-2-Replay-Protect-原理" class="headerlink" title="3.2 Replay Protect 原理"></a>3.2 Replay Protect 原理</h3><p>使用 eMMC 的产品，在产线生产时，会为每一个产品生产一个唯一的 256 bits 的 Secure Key，烧写到 eMMC 的 OTP 区域（只能烧写一次的区域），同时 Host 在安全区域中（例如：TEE）也会保留该 Secure Key。</p>
<p>在 eMMC 内部，还有一个RPMB Write Counter。RPMB 每进行一次合法的写入操作时，Write Counter 就会自动加一 。</p>
<p>通过 Secure Key 和 Write Counter 的应用，RMPB 可以实现数据读取和写入的 Replay Protect。</p>
<h4 id="RPMB-数据读取"><a href="#RPMB-数据读取" class="headerlink" title="RPMB 数据读取"></a>RPMB 数据读取</h4><p>RPMB 数据读取的流程如下：</p>
<p><img src="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/rpmb_r.png" alt="img"></p>
<ol>
<li>Host 向 eMMC 发起读 RPMB 的请求，同时生成一个 16 bytes 的随机数，发送给 eMMC。</li>
<li>eMMC 将请求的数据从 RPMB 中读出，并使用 Secure Key 通过 HMAC SHA-256 算法，计算读取到的数据和接收到的随机数拼接到一起后的签名。然后，eMMC 将读取到的数据、接收到的随机数、计算得到的签名一并发送给 Host。</li>
<li>Host 接收到 RPMB 的数据、随机数以及签名后，首先比较随机数是否与自己发送的一致，如果一致，再用同样的 Secure Key 通过 HMAC SHA-256 算法对数据和随机数组合到一起进行签名，如果签名与 eMMC 发送的签名是一致的，那么就可以确定该数据是从 RPMB 中读取到的正确数据，而不是攻击者伪造的数据。</li>
</ol>
<p>通过上述的读取流程，可以保证 Host 正确的读取到 RPMB 的数据。</p>
<h4 id="RPMB-数据写入"><a href="#RPMB-数据写入" class="headerlink" title="RPMB 数据写入"></a>RPMB 数据写入</h4><p>RPMB 数据写入的流程如下：</p>
<p><img src="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/rpmb_w.png" alt="img"></p>
<ol>
<li>Host 按照上面的读数据流程，读取 RPMB 的 Write Counter。</li>
<li>Host 将需要写入的数据和 Write Counter 拼接到一起并计算签名，然后将数据、Write Counter 以及签名一并发给 eMMC。</li>
<li>eMMC 接收到数据后，先对比 Write Counter 是否与当前的值相同，如果相同那么再对数据和 Write Counter 的组合进行签名，然后和 Host 发送过来的签名进行比较，如果签名相同则鉴权通过，将数据写入到 RPMB 中。</li>
</ol>
<p>通过上述的写入流程，可以保证 RPMB 不会被非法篡改。</p>
<p>更多 RPMB 相关的细节，可以参考 <a href="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/emmc_rpmb.html" target="_blank" rel="noopener">eMMC RPMB</a> 章节。</p>
<h2 id="4-General-Purpose-Partitions"><a href="#4-General-Purpose-Partitions" class="headerlink" title="4. General Purpose Partitions"></a>4. General Purpose Partitions</h2><p>eMMC 提供了 General Purpose Partitions (GPP)，主要用于存储系统和应用数据。在很多使用 eMMC 的产品中，GPP 都没有被启用，因为它在功能上与 UDA 类似，产品上直接使用 UDA 就可以满足需求。</p>
<h3 id="4-1-容量大小"><a href="#4-1-容量大小" class="headerlink" title="4.1 容量大小"></a>4.1 容量大小</h3><p>eMMC 最多可以支持 4 个 GPPs，每一个 GPP 的大小可以单独配置。用户可以通过设定 Extended CSD register 的以下三个 Field 来设 GPPx (x=1~4) 的容量大小：</p>
<ul>
<li>GP_SIZE_MULT_x_2</li>
<li>GP_SIZE_MULT_x_1</li>
<li>GP_SIZE_MULT_x_0</li>
</ul>
<p>GPPx 的容量计算公式如下：</p>
<p>Size = (GP_SIZE_MULT_x_2 * 2^16 + GP_SIZE_MULT_x_1 * 2^8 + GP_SIZE_MULT_x_0 * 2^0) * (Write protect group size)</p>
<p>Write protect group size = 512KB * HC_ERASE_GRP_SIZE * HC_WP_GRP_SIZE</p>
<blockquote>
<ul>
<li>eMMC 中，擦除和写保护都是按块进行的，上述表达式中的 HC_WP_GRP_SIZE 为写保护的操作块大小，HC_ERASE_GRP_SIZE 则为擦除操作的快的大小。</li>
<li>eMMC 芯片的 GPP 的配置通常是只能进行一次 (OTP)，一般会在产品量产阶段，在产线上进行。</li>
</ul>
</blockquote>
<h3 id="4-2-分区属性"><a href="#4-2-分区属性" class="headerlink" title="4.2 分区属性"></a>4.2 分区属性</h3><p>eMMC 标准中，为 GPP 定义了两类属性，Enhanced attribute 和 Extended attribute。每个 GPP 可以设定两类属性中的一种属性，不可以同时设定多个属性。</p>
<p><img src="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/gpp_attributes.png" alt="img"></p>
<p><strong>Enhanced attribute</strong></p>
<ul>
<li>Default, 未设定 Enhanced attribute。</li>
<li>Enhanced storage media， 设定 GPP 为 Enhanced storage media。</li>
</ul>
<p>在 eMMC 标准中，实际上并未定义设定 Enhanced attribute 后对 eMMC 的影响。Enhanced attribute 的具体作用，由芯片制造商定义。<br>在实际的产品中，设定 Enhanced storage media 后，一般是把该分区的存储介质从 MLC 改变为 SLC，提高该分区的读写性能、寿命以及稳定性。由于 1 个存储单元下，MLC 的容量是 SLC 的两倍，所以在总的存储单元数量一定的情况下，如果把原本为 MLC 的分区改变为 SLC，会减少 eMMC 的容量，就是说，此时 eMMC 的实际总容量比标称的总容量会小一点。（MLC 和 SLC 的细节可以参考 <a href="https://linux.codingbelief.com/zh/storage/flash_memory/index.html" target="_blank" rel="noopener">Flash Memory</a> 章节内容）</p>
<p><strong>Extended attribute</strong></p>
<ul>
<li>Default, 未设定 Extended attribute。</li>
<li>System code， 设定 GPP 为 System code 属性，该属性主要用在存放操作系统类的、很少进行擦写更新的分区。</li>
<li>Non-Persistent，设定 GPP 为 Non-Persistent 属性，该属性主要用于存储临时数据的分区，例如 tmp 目录所在分区、 swap 分区等。</li>
</ul>
<p>在 eMMC 标准中，同样也没有定义设定 Extended attribute 后对 eMMC 的影响。Extended attribute 的具体作用，由芯片制造商定义。Extended attribute 主要是跟分区的应用场景有关，厂商可以为不用应用场景的分区做不同的优化处理。</p>
<h2 id="5-User-Data-Area"><a href="#5-User-Data-Area" class="headerlink" title="5. User Data Area"></a>5. User Data Area</h2><p>User Data Area (UDA) 通常是 eMMC 中最大的一个分区，是实际产品中，最主要的存储区域。</p>
<h3 id="5-1-容量大小"><a href="#5-1-容量大小" class="headerlink" title="5.1 容量大小"></a>5.1 容量大小</h3><p>UDA 的容量大小不需要设置，在配置完其他分区大小后，再扣除设置 Enhanced attribute 所损耗的容量，剩下的容量就是 UDA 的容量。</p>
<h3 id="5-2-软件分区"><a href="#5-2-软件分区" class="headerlink" title="5.2 软件分区"></a>5.2 软件分区</h3><p>为了更合理的管理数据，满足不同的应用需求，UDA 在实际产品中，会进行软件再分区。目前主流的软件分区技术有 MBR（Master Boot Record）和 GPT（GUID Partition Table）两种。这两种分区技术的基本原理类似，如下图所示：</p>
<p><img src="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/uda_partitions.png" alt="img"></p>
<p>软件分区技术一般是将存储介质划分为多个区域，既 SW Partitions，然后通过一个 Partition Table 来维护这些 SW Partitions。在 Partition Table 中，每一个条目都保存着一个 SW Partition 的起始地址、大小等的属性信息。软件系统在启动后，会去扫描 Partition Table，获取存储介质上的各个 SW Partitions 信息，然后根据这些信息，将各个 Partitions 加载到系统中，进行数据存取。</p>
<blockquote>
<p>MBR 和 GPT 此处不展开详细介绍，更多的细节可以参考 wikipedia 上 <a href="https://en.wikipedia.org/wiki/Master_boot_record" target="_blank" rel="noopener">MBR</a> 和 <a href="https://en.wikipedia.org/wiki/GUID_Partition_Table" target="_blank" rel="noopener">GPT</a> 相关介绍。</p>
</blockquote>
<h3 id="5-3-区域属性"><a href="#5-3-区域属性" class="headerlink" title="5.3 区域属性"></a>5.3 区域属性</h3><p>eMMC 标准中，支持为 UDA 中一个特定大小的区域设定 Enhanced attribute。与 GPP 中的 Enhanced attribute 相同，eMMC 标准也没有定义该区域设定 Enhanced attribute 后对 eMMC 的影响。Enhanced attribute 的具体作用，由芯片制造商定义。</p>
<p><strong>Enhanced attribute</strong></p>
<ul>
<li>Default, 未设定 Enhanced attribute。</li>
<li>Enhanced storage media， 设定该区域为 Enhanced storage media。</li>
</ul>
<p>在实际的产品中，UDA 区域设定为 Enhanced storage media 后，一般是把该区域的存储介质从 MLC 改变为 SLC。通常，产品中可以将某一个 SW Partition 设定为 Enhanced storage media，以获得更好的性能和健壮性。</p>
<h2 id="6-eMMC-分区应用实例"><a href="#6-eMMC-分区应用实例" class="headerlink" title="6. eMMC 分区应用实例"></a>6. eMMC 分区应用实例</h2><p>在一个 Android 手机系统中，各个分区的呈现形式如下：</p>
<ul>
<li>mmcblk0 为 eMMC 的块设备;</li>
<li>mmcblk0boot0 和 mmcblk0boot1 对应两个 Boot Area Partitions;</li>
<li>mmcblk0rpmb 则为 RPMB Partition，</li>
<li>mmcblk0px 为 UDA 划分出来的 SW Partitions;</li>
<li>如果存在 GPP，名称则为 mmcblk0gp1、mmcblk0gp2、mmcblk0gp3、mmcblk0gp4;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">root@xxx:&#x2F; # ls &#x2F;dev&#x2F;block&#x2F;mmcblk0*</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0boot0</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0boot1</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0rpmb</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p1</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p2</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p3</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p4</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p5</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p6</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p7</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p8</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p9</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p10</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p11</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p12</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p13</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p14</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p15</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p16</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p17</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p18</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p19</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p20</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p21</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p22</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p23</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p24</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p25</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p26</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p27</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p28</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p29</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p30</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p31</span><br><span class="line">&#x2F;dev&#x2F;block&#x2F;mmcblk0p32</span><br></pre></td></tr></table></figure>

<p>每一个分区会根据实际的功能来设定名称。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">root@xxx:&#x2F; # ls -l &#x2F;dev&#x2F;block&#x2F;platform&#x2F;mtk-msdc.0&#x2F;11230000.msdc0&#x2F;by-name&#x2F;</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 boot -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p22</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 cache -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p30</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 custom -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p3</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 devinfo -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p28</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 expdb -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p4</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 flashinfo -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p32</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 frp -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p5</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 keystore -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p27</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 lk -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p20</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 lk2 -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p21</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 logo -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p23</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 md1arm7 -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p17</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 md1dsp -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p16</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 md1img -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p15</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 md3img -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p18</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 metadata -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p8</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 nvdata -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p7</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 nvram -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p19</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 oemkeystore -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p12</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 para -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p2</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 ppl -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p6</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 proinfo -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p13</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 protect1 -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p9</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 protect2 -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p10</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 recovery -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p1</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 rstinfo -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p14</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 seccfg -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p11</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 secro -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p26</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 system -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p29</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 tee1 -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p24</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 tee2 -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p25</span><br><span class="line">lrwxrwxrwx root root 2015-01-03 04:03 userdata -&gt; &#x2F;dev&#x2F;block&#x2F;mmcblk0p31</span><br></pre></td></tr></table></figure>

<h2 id="7-参考资料"><a href="#7-参考资料" class="headerlink" title="7. 参考资料"></a>7. 参考资料</h2><ol>
<li><a href="http://www.jedec.org/sites/default/files/docs/JESD84-B51.pdf" target="_blank" rel="noopener">Embedded Multi-Media Card (e•MMC) Electrical Standard (5.1)</a> [PDF]</li>
<li><a href="https://en.wikipedia.org/wiki/Disk_partitioning" target="_blank" rel="noopener">Disk partitioning</a> [Web]</li>
<li><a href="https://en.wikipedia.org/wiki/Master_boot_record" target="_blank" rel="noopener">Master Boot Record</a> [Web]</li>
<li><a href="https://en.wikipedia.org/wiki/GUID_Partition_Table" target="_blank" rel="noopener">GUID Partition Table</a> [Web]</li>
</ol>
<p><strong>注</strong>：本文转自蜗窝科技<a href="http://www.wowotech.net，来自【http://www.wowotech.net/basic_tech/emmc_partitions.html】" target="_blank" rel="noopener">www.wowotech.net，来自【http://www.wowotech.net/basic_tech/emmc_partitions.html】</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/25/Linux/Driver/storage/Flash%20Memory/mmc/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91eMMC%20%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="David Meng">
      <meta itemprop="description" content="冒险，创新，永不放弃">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tech Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/25/Linux/Driver/storage/Flash%20Memory/mmc/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91eMMC%20%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">【转载】eMMC 简介</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-12-25 10:33:17 / Modified: 10:44:15" itemprop="dateCreated datePublished" datetime="2020-12-25T10:33:17+08:00">2020-12-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/" itemprop="url" rel="index"><span itemprop="name">Driver</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/storage/" itemprop="url" rel="index"><span itemprop="name">storage</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/storage/Flash-Memory/" itemprop="url" rel="index"><span itemprop="name">Flash Memory</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/storage/Flash-Memory/mmc/" itemprop="url" rel="index"><span itemprop="name">mmc</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>[TOC]</p>
<p>eMMC 是 embedded MultiMediaCard 的简称。MultiMediaCard，即 MMC， 是一种闪存卡（Flash Memory Card）标准，它定义了 MMC 的架构以及访问　Flash Memory 的接口和协议。而 eMMC 则是对 MMC 的一个拓展，以满足更高标准的性能、成本、体积、稳定、易用等的需求。</p>
<p>eMMC 的整体架构如下图片所示：</p>
<p><img src="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/emmc_architecture.png" alt="img"></p>
<p>​                                                                                                                 图片： eMMC 整体架构</p>
<p>eMMC 内部主要可以分为 Flash Memory、Flash Controller 以及 Host Interface 三大部分。</p>
<h2 id="1-Flash-Memory"><a href="#1-Flash-Memory" class="headerlink" title="1. Flash Memory"></a>1. Flash Memory</h2><p>Flash Memory 是一种非易失性的存储器，通常在嵌入式系统中用于存放系统、应用和数据等，类似与 PC 系统中的硬盘。</p>
<p>目前，绝大部分手机和平板等移动设备中所使用的 eMMC 内部的 Flash Memory 都属于 NAND Flash，关于 NAND Flash 的更多细节可以参考 <a href="https://linux.codingbelief.com/zh/storage/flash_memory/index.html" target="_blank" rel="noopener">Flash Memory</a> 章节。</p>
<p>eMMC 在内部对 Flash Memory 划分了几个主要区域，如下图所示：</p>
<p><img src="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/emmc_partitions.png" alt="img"></p>
<p>​                                                                                    图片：eMMC 内部分区</p>
<ol>
<li>BOOT Area Partition 1 &amp; 2<br>此分区主要是为了支持从 eMMC 启动系统而设计的。<br>该分区的数据，在 eMMC 上电后，可以通过很简单的协议就可以读取出来。同时，大部分的 SOC 都可以通过 GPIO 或者 FUSE 的配置，让 ROM 代码在上电后，将 eMMC BOOT 分区的内容加载到 SOC 内部的 SRAM 中执行。</li>
<li>RPMB Partition<br>RPMB 是 Replay Protected Memory Block 的简称，它通过 HMAC SHA-256 和 Write Counter 来保证保存在 RPMB 内部的数据不被非法篡改。<br>在实际应用中，RPMB 分区通常用来保存安全相关的数据，例如指纹数据、安全支付相关的密钥等。</li>
<li>General Purpose Partition 1～4<br>此区域则主要用于存储系统或者用户数据。 General Purpose Partition 在芯片出厂时，通常是不存在的，需要主动进行配置后，才会存在。</li>
<li>User Data Area<br>此区域则主要用于存储系统和用户数据。<br>User Data Area 通常会进行再分区，例如 Android 系统中，通常在此区域分出 boot、system、userdata 等分区。</li>
</ol>
<p>更多 eMMC 分区相关的细节，请参考 <a href="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/emmc_partitions.html" target="_blank" rel="noopener">eMMC 分区管理</a> 章节。</p>
<h2 id="2-Flash-Controller"><a href="#2-Flash-Controller" class="headerlink" title="2. Flash Controller"></a>2. Flash Controller</h2><p>NAND Flash 直接接入 Host 时，Host 端通常需要有 NAND Flash Translation Layer，即 NFTL 或者 NAND Flash 文件系统来做坏块管理、ECC等的功能。</p>
<p>eMMC 则在其内部集成了 Flash Controller，用于完成擦写均衡、坏块管理、ECC校验等功能。相比于直接将 NAND Flash 接入到 Host 端，eMMC 屏蔽了 NAND Flash 的物理特性，可以减少 Host 端软件的复杂度，让 Host 端专注于上层业务，省去对 NAND Flash 进行特殊的处理。同时，eMMC 通过使用 Cache、Memory Array 等技术，在读写性能上也比 NAND Flash 要好很多。</p>
<p><img src="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/emmc_vs_nand_flash.png" alt="img"></p>
<p>​                                                                                                       图片：NAND Flash 与 eMMC</p>
<h2 id="3-Host-Interface"><a href="#3-Host-Interface" class="headerlink" title="3. Host Interface"></a>3. Host Interface</h2><p>eMMC 与 Host 之间的连接如下图所示：</p>
<p><img src="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/emmc_host_interfaces.png" alt="img"></p>
<p>​                                                                                                            图片：eMMC Interface</p>
<p>各个信号的用途如下所示：</p>
<p><strong>CLK</strong><br>用于同步的时钟信号</p>
<p><strong>Data Strobe</strong><br>此信号是从 Device 端输出的时钟信号，频率和 CLK 信号相同，用于同步从 Device 端输出的数据。该信号在 eMMC 5.0 中引入。</p>
<p><strong>CMD</strong><br>此信号用于发送 Host 的 command 和 Device 的 response。</p>
<p><strong>DAT0-7</strong><br>用于传输数据的 8 bit 总线。</p>
<p>Host 与 eMMC 之间的通信都是 Host 以一个 Command 开始发起的。针对不同的 Command，Device 会做出不同的响应。详细的通信协议相关内容，请参考 <a href="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/emmc_bus_protocol.html" target="_blank" rel="noopener">eMMC 总线协议</a> 章节。</p>
<h2 id="4-参考资料"><a href="#4-参考资料" class="headerlink" title="4. 参考资料"></a>4. 参考资料</h2><ol>
<li><a href="http://www.jedec.org/sites/default/files/docs/JESD84-B51.pdf" target="_blank" rel="noopener">Embedded Multi-Media Card (e•MMC) Electrical Standard (5.1)</a> [PDF]</li>
</ol>
<p><strong>注</strong>：本文转自蜗窝科技<a href="http://www.wowotech.net，来自【http://www.wowotech.net/basic_tech/emmc_intro.html】" target="_blank" rel="noopener">www.wowotech.net，来自【http://www.wowotech.net/basic_tech/emmc_intro.html】</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/25/Linux/Driver/storage/Flash%20Memory/mmc/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91Flash%20Memory%20%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="David Meng">
      <meta itemprop="description" content="冒险，创新，永不放弃">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tech Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/25/Linux/Driver/storage/Flash%20Memory/mmc/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91Flash%20Memory%20%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">【转载】Flash Memory 简介</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-12-25 10:18:56 / Modified: 10:32:22" itemprop="dateCreated datePublished" datetime="2020-12-25T10:18:56+08:00">2020-12-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/" itemprop="url" rel="index"><span itemprop="name">Driver</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/storage/" itemprop="url" rel="index"><span itemprop="name">storage</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/storage/Flash-Memory/" itemprop="url" rel="index"><span itemprop="name">Flash Memory</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>[TOC]</p>
<p>eMMC 是 Flash Memory 的一类，在详细介绍 eMMC 之前，先简单介绍一下 Flash Memory。</p>
<p>Flash Memory 是一种非易失性的存储器。在嵌入式系统中通常用于存放系统、应用和数据等。在 PC 系统中，则主要用在固态硬盘以及主板 BIOS 中。另外，绝大部分的 U 盘、SDCard 等移动存储设备也都是使用 Flash Memory 作为存储介质。</p>
<h2 id="1-Flash-Memory-的主要特性"><a href="#1-Flash-Memory-的主要特性" class="headerlink" title="1. Flash Memory 的主要特性"></a>1. Flash Memory 的主要特性</h2><p>与传统的硬盘存储器相比，Flash Memory 具有质量轻、能耗低、体积小、抗震能力强等的优点，但也有不少局限性，主要如下：</p>
<ol>
<li>需要先擦除再写入<br>Flash Memory 写入数据时有一定的限制。它只能将当前为 1 的比特改写为 0，而无法将已经为 0 的比特改写为 1，只有在擦除的操作中，才能把整块的比特改写为 1。</li>
<li>块擦除次数有限<br>Flash Memory 的每个数据块都有擦除次数的限制（十万到百万次不等），擦写超过一定次数后，该数据块将无法可靠存储数据，成为坏块。<br>为了最大化的延长 Flash Memory 的寿命，在软件上需要做擦写均衡（Wear Leveling），通过分散写入、动态映射等手段均衡使用各个数据块。同时，软件还需要进行坏块管理（Bad Block Management，BBM），标识坏块，不让坏块参与数据存储。（注：除了擦写导致的坏块外，Flash Memory 在生产过程也会产生坏块，即固有坏块。）</li>
<li>读写干扰<br>由于硬件实现上的物理特性，Flash Memory 在进行读写操作时，有可能会导致邻近的其他比特发生位翻转，导致数据异常。这种异常可以通过重新擦除来恢复。Flash Memory 应用中通常会使用 ECC 等算法进行错误检测和数据修正。</li>
<li>电荷泄漏<br>存储在 Flash Memory 存储单元的电荷，如果长期没有使用，会发生电荷泄漏，导致数据错误。不过这个时间比较长，一般十年左右。此种异常是非永久性的，重新擦除可以恢复。</li>
</ol>
<h2 id="2-NOR-Flash-和-NAND-Flash"><a href="#2-NOR-Flash-和-NAND-Flash" class="headerlink" title="2. NOR Flash 和 NAND Flash"></a>2. NOR Flash 和 NAND Flash</h2><p>根据硬件上存储原理的不同，Flash Memory 主要可以分为 NOR Flash 和 NAND Flash 两类。 主要的差异如下所示：</p>
<ul>
<li>NAND Flash 读取速度与 NOR Flash 相近，根据接口的不同有所差异；</li>
<li>NAND Flash 的写入速度比 NOR Flash 快很多；</li>
<li>NAND Flash 的擦除速度比 NOR Flash 快很多；</li>
<li>NAND Flash 最大擦次数比 NOR Flash 多；</li>
<li>NOR Flash 支持片上执行，可以在上面直接运行代码；</li>
<li>NOR Flash 软件驱动比 NAND Flash 简单；</li>
<li>NOR Flash 可以随机按字节读取数据，NAND Flash 需要按块进行读取。</li>
<li>大容量下 NAND Flash 比 NOR Flash 成本要低很多，体积也更小；</li>
</ul>
<p>（注：NOR Flash 和 NAND Flash 的擦除都是按块块进行的，执行一个擦除或者写入操作时，NOR Flash 大约需要 5s，而 NAND Flash 通常不超过 4ms。）</p>
<h3 id="2-1-NOR-Flash"><a href="#2-1-NOR-Flash" class="headerlink" title="2.1 NOR Flash"></a>2.1 NOR Flash</h3><p>NOR Flash 根据与 CPU 端接口的不同，可以分为 Parallel NOR Flash 和 Serial NOR Flash 两类。<br>Parallel NOR Flash 可以接入到 Host 的 SRAM/DRAM Controller 上，所存储的内容可以直接映射到 CPU 地址空间，不需要拷贝到 RAM 中即可被 CPU 访问，因而支持片上执行。Serial NOR Flash 的成本比 Parallel NOR Flash 低，主要通过 SPI 接口与 Host 连接。</p>
<p><img src="http://jiali.clouddn.com/20201225_004.png" alt=""></p>
<p>​                                                                                            图片： Parallel NOR Flash 与 Serial NOR Flash</p>
<p>鉴于 NOR Flash 擦写速度慢，成本高等特性，NOR Flash 主要应用于小容量、内容更新少的场景，例如 PC 主板 BIOS、路由器系统存储等。</p>
<p>更多 NOR Flash 的相关细节，请参考 <a href="https://linux.codingbelief.com/zh/storage/flash_memory/nor_flash/index.html" target="_blank" rel="noopener">NOR Flash</a> 章节。</p>
<h3 id="2-2-NAND-Flash"><a href="#2-2-NAND-Flash" class="headerlink" title="2.2 NAND Flash"></a>2.2 NAND Flash</h3><p>NAND Flash 需要通过专门的 NFI（NAND Flash Interface）与 Host 端进行通信，如下图所示：</p>
<p><img src="http://jiali.clouddn.com/20201225_005.png" alt=""></p>
<p>​                                                                                                                图片：NAND Flash Interface</p>
<p>NAND Flash 根据每个存储单元内存储比特个数的不同，可以分为 SLC（Single-Level Cell）、MLC（Multi-Level Cell） 和 TLC（Triple-Level Cell） 三类。其中，在一个存储单元中，SLC 可以存储 1 个比特，MLC 可以存储 2 个比特，TLC 则可以存储 3 个比特。</p>
<p>NAND Flash 的一个存储单元内部，是通过不同的电压等级，来表示其所存储的信息的。在 SLC 中，存储单元的电压被分为两个等级，分别表示 0 和 1 两个状态，即 1 个比特。在 MLC 中，存储单元的电压则被分为 4 个等级，分别表示 00 01 10 11 四个状态，即 2 个比特位。同理，在 TLC 中，存储单元的电压被分为 8 个等级，存储 3 个比特信息。</p>
<p><img src="http://jiali.clouddn.com/20201225_006.png" alt=""></p>
<p>​                                                                                                              图片： SLC、MLC 与 TLC</p>
<p>NAND Flash 的单个存储单元存储的比特位越多，读写性能会越差，寿命也越短，但是成本会更低。Table 1 中，给出了特定工艺和技术水平下的成本和寿命数据。</p>
<p><strong>Table 1</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>SLC</th>
<th>MLC</th>
<th>TLC</th>
</tr>
</thead>
<tbody><tr>
<td>制造成本</td>
<td>30-35 美元 / 32GB</td>
<td>17 美元 / 32GB</td>
<td>9-12 美元 / 32GB</td>
</tr>
<tr>
<td>擦写次数</td>
<td>10万次或更高</td>
<td>1万次或更高</td>
<td>5000次甚至更高</td>
</tr>
<tr>
<td>存储单元</td>
<td>1 bit / cell</td>
<td>2 bits / cell</td>
<td>3 bits / cell</td>
</tr>
</tbody></table>
<p>（注：以上数据来源于互联网，仅供参考）</p>
<p>相比于 NOR Flash，NAND Flash 写入性能好，大容量下成本低。目前，绝大部分手机和平板等移动设备中所使用的 eMMC 内部的 Flash Memory 都属于 NAND Flash。PC 中的固态硬盘中也是使用 NAND Flash。</p>
<p>更多 NAND Flash 的相关细节，请参考 <a href="https://linux.codingbelief.com/zh/storage/flash_memory/nand_flash/index.html" target="_blank" rel="noopener">NAND Flash</a> 章节。</p>
<h2 id="3-Raw-Flash-和-Managed-Flash"><a href="#3-Raw-Flash-和-Managed-Flash" class="headerlink" title="3. Raw Flash 和 Managed Flash"></a>3. Raw Flash 和 Managed Flash</h2><p>由于 Flash Memory 存在按块擦写、擦写次数的限制、读写干扰、电荷泄露等的局限，为了最大程度的发挥 Flash Memory 的价值，通常需要有一个特殊的软件层次，实现坏块管理、擦写均衡、ECC、垃圾回收等的功能，这一个软件层次称为 FTL（Flash Translation Layer）。</p>
<p>在具体实现中，根据 FTL 所在的位置的不同，可以把 Flash Memory 分为 Raw Flash 和 Managed Flash 两类。</p>
<p><img src="http://jiali.clouddn.com/20201225_007.png" alt=""></p>
<p>​                                                                                                     图片： Raw Flash 和 Managed Flash</p>
<p><strong>Raw Flash</strong><br>在此类应用中，在 Host 端通常有专门的 FTL 或者 Flash 文件系统来实现坏块管理、擦写均衡等的功能。Host 端的软件复杂度较高，但是整体方案的成本较低，常用于价格敏感的嵌入式产品中。<br>通常我们所说的 NOR Flash 和 NAND Flash 都属于这类型。</p>
<p><strong>Managed Flash</strong><br>Managed Flash 在其内部集成了 Flash Controller，用于完成擦写均衡、坏块管理、ECC校验等功能。相比于直接将 Flash 接入到 Host 端，Managed Flash 屏蔽了 Flash 的物理特性，对 Host 提供标准化的接口，可以减少 Host 端软件的复杂度，让 Host 端专注于上层业务，省去对 Flash 进行特殊的处理。<br><a href="https://linux.codingbelief.com/zh/storage/flash_memory/emmc/index.html" target="_blank" rel="noopener">eMMC</a>、<a href="https://linux.codingbelief.com/zh/storage/flash_memory/sd_card/index.html" target="_blank" rel="noopener">SD Card</a>、<a href="https://linux.codingbelief.com/zh/storage/flash_memory/ufs/index.html" target="_blank" rel="noopener">UFS</a>、U 盘等产品是属于 Managed Flash 这一类。</p>
<h2 id="4-参考资料"><a href="#4-参考资料" class="headerlink" title="4. 参考资料"></a>4. 参考资料</h2><ol>
<li><a href="https://www.micron.com/~/media/documents/products/product-flyer/flyer_nor_nand_flash_guide.pdf" target="_blank" rel="noopener">NOR NAND Flash Guide: Selecting a Flash Storage Solution</a> [PDF]</li>
<li><a href="https://en.wikipedia.org/wiki/Common_Flash_Memory_Interface" target="_blank" rel="noopener">Wiki: Common Flash Memory Interface</a> [Web]</li>
<li>[Quick Guide to Common Flash Interface](<a href="https://www.spansion.com/Support/Application" target="_blank" rel="noopener">https://www.spansion.com/Support/Application</a> Notes/Quick_Guide_to_CFI_AN.pdf) [PDF]</li>
<li><a href="https://www.micron.com/products/nor-flash" target="_blank" rel="noopener">MICRON NOR Flash Technology</a> [Web]</li>
<li><a href="https://www.micron.com/products/nand-flash" target="_blank" rel="noopener">MICRON NAND Flash Technology</a> [Web]</li>
<li><a href="https://zh.wikipedia.org/wiki/闪存" target="_blank" rel="noopener">Wiki：闪存</a> [Web]</li>
<li><a href="https://en.wikipedia.org/wiki/Flash_file_system" target="_blank" rel="noopener">Wiki：Flash File System</a> [Web]</li>
<li><a href="https://www.micron.com/~/media/documents/products/technical-note/nand-flash/tn2961_wear_leveling_in_nand.pdf" target="_blank" rel="noopener">Wear Leveling in Micron® NAND Flash Memory</a> [PDF]</li>
<li><a href="https://flashdba.com/2014/09/17/understanding-flash-the-flash-translation-layer/" target="_blank" rel="noopener">Understanding Flash: The Flash Translation Layer</a> [Web]</li>
<li><a href="http://blog.sina.com.cn/s/blog_4b4b54da01016rx3.html" target="_blank" rel="noopener">谈NAND Flash的底层结构和解析</a> [Web]</li>
<li><a href="http://www.ssdfans.com/?p=45" target="_blank" rel="noopener">闪存基础</a> [Web]</li>
<li><a href="http://www.onfi.org/" target="_blank" rel="noopener">Open NAND Flash Interface (ONFI)</a> [Web]</li>
</ol>
<p><strong>注</strong>：本文转自蜗窝科技<a href="http://www.wowotech.net，来自【http://www.wowotech.net/basic_tech/flash_memory_intro.html】" target="_blank" rel="noopener">www.wowotech.net，来自【http://www.wowotech.net/basic_tech/flash_memory_intro.html】</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/25/Linux/Driver/storage/Flash%20Memory/mmc/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91MMC%20SD%20SDIO%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="David Meng">
      <meta itemprop="description" content="冒险，创新，永不放弃">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tech Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/25/Linux/Driver/storage/Flash%20Memory/mmc/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91MMC%20SD%20SDIO%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">【转载】MMC/SD/SDIO介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-12-25 09:45:36 / Modified: 11:10:32" itemprop="dateCreated datePublished" datetime="2020-12-25T09:45:36+08:00">2020-12-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/" itemprop="url" rel="index"><span itemprop="name">Driver</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/storage/" itemprop="url" rel="index"><span itemprop="name">storage</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/storage/Flash-Memory/" itemprop="url" rel="index"><span itemprop="name">Flash Memory</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/storage/Flash-Memory/mmc/" itemprop="url" rel="index"><span itemprop="name">mmc</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>[TOC]</p>
<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h2><p>熟悉Linux kernel的人都知道，kernel使用MMC subsystem统一管理MMC、SD、SDIO等设备，为什么呢？到底什么是MMC？SD和SDIO又是什么？为什么可以用MMC统称呢？</p>
<p>在分析Linux kernel的MMC subsystem之前，有必要先介绍一些概念，以便对MMC/SD/SDIO有一个大致的了解，这就是本文的目的。</p>
<h2 id="2-基本概念"><a href="#2-基本概念" class="headerlink" title="2. 基本概念"></a>2. 基本概念</h2><p>MMC是MultiMediaCard的简称，从本质上看，它是一种用于固态非易失性存储的内存卡（memory card）规范[1]，定义了诸如卡的形态、尺寸、容量、电气信号、和主机之间的通信协议等方方面面的内容。</p>
<p>从1997年MMC规范发布至今，基于不同的考量（物理尺寸、电压范围、管脚数量、最大容量、数据位宽、clock频率、安全特性、是否支持SPI mode、是否支持DDR mode、等等），进化出了MMC、SD、microSD、SDIO、eMMC等不同的规范（如下面图片1所示）。虽然乱花迷人，其本质终究还是一样的，丝毫未变，这就是Linux kernel将它们统称为MMC的原因。</p>
<p><img src="http://jiali.clouddn.com/20201225_001.png" alt=""></p>
<p>​                                                                                             图片1 MMC/SD/SDIO evolution</p>
<p>关于该图片，这里强调几点（其它的，大家可参考[1] [2]，不再详细介绍）：</p>
<blockquote>
<p>MMC、SD、SDIO的技术本质是一样的（使用相同的总线规范，等等），都是从MMC规范演化而来；</p>
<p>MMC强调的是多媒体存储（MM，MultiMedia）；</p>
<p>SD强调的是安全和数据保护（S，Secure）；</p>
<p>SDIO是从SD演化出来的，强调的是接口（IO，Input/Output），不再关注另一端的具体形态（可以是WIFI设备、Bluetooth设备、GPS等等）。</p>
</blockquote>
<h2 id="3-规范简介"><a href="#3-规范简介" class="headerlink" title="3. 规范简介"></a>3. 规范简介</h2><p>MMC分别从卡（Card Concept）、总线（Bus Concept）以及控制器（Host Controller）三个方面，定义MMC system的行为，如下面图片2所示：</p>
<p><img src="http://jiali.clouddn.com/20201225_002.png" alt=""></p>
<p>​                                                                                                   图片2 mmc_sd_sdio_hw_block</p>
<p>不同岗位的工程师，可以根据自己的工作性质，重点理解某一部分的规范，下面从嵌入式软件工程师的视角，简单的介绍一下。</p>
<h3 id="3-1-卡的规范"><a href="#3-1-卡的规范" class="headerlink" title="3.1 卡的规范"></a>3.1 卡的规范</h3><p>卡的规范主要规定卡的形状、物理尺寸、管脚，内部block组成、寄存器等等，以eMMC为例[3]：</p>
<p><img src="http://jiali.clouddn.com/20201225_003.png" alt=""></p>
<p>​                                                                                                      图片3 Card Concept(eMMC)</p>
<p>1）有关形状、尺寸的内容，这里不再介绍，感兴趣的同学可参考[1]。</p>
<p>2）卡的内部由如下几个block组成：</p>
<blockquote>
<p>Memory core，存储介质，一般是NAND flash、NOR flash等；</p>
<p>Memory core interface，管理存储介质的接口，用于访问（读、写、擦出等操作）存储介质；</p>
<p>Card interface（CMD、CLK、DATA），总线接口，外界访问卡内部存储介质的接口，和具体的管脚相连；</p>
<p>Card interface controller，将总线接口上的协议转换为Memory core interface的形式，用于访问内部存储介质；</p>
<p>Power模块，提供reset、上电检测等功能；</p>
<p>寄存器（图片1中位于Card interface controller的左侧，那些小矩形），用于提供卡的信息、参数、访问控制等功能。</p>
</blockquote>
<p>3）卡的管脚有VDD、GND、RST、CLK、CMD和DATA等，VDD和GND提供power，RST用于复位，CLK、CMD和DATA为MMC总线协议（具体可参考3.2小节）的物理通道：</p>
<blockquote>
<p>CLK有一条，提供同步时钟，可以在CLK的上升沿（或者下降沿，或者上升沿和下降沿）采集数据；</p>
<p>CMD有一条，用于传输双向的命令。</p>
<p>DATA用于传说双向的数据，根据MMC的类型，可以有一条（1-bit）、四条（4-bit）或者八条（8-bit）。</p>
</blockquote>
<p>4）以eMMC为例，规范定义了OCR, CID, CSD, EXT_CSD, RCA 以及DSR 6组寄存器，具体含义后面再介绍。</p>
<h3 id="3-2-总线规范"><a href="#3-2-总线规范" class="headerlink" title="3.2 总线规范"></a>3.2 总线规范</h3><p>前面我们提到过，MMC的本质是提供一套可以访问固态非易失性存储介质的通信协议，从产业化的角度看，这些存储介质一般集成在一个独立的外部模块中（卡、WIFI模组等），通过物理总线和CPU连接。对任何有线的通信协议来说，总线规范都是非常重要的。关于MMC总线规范，简单总结如下：</p>
<p>1）物理信号有CLK、CMD和DATA三类。</p>
<p>2）电压范围为1.65V和3.6V（参考上面图片2），根据工作电压的不同，MMC卡可以分为两类：</p>
<blockquote>
<p>High Voltage MultiMediaCard，工作电压为2.7V~3.6V。</p>
<p>Dual Voltage MultiMediaCard，工作电压有两种，1.70V<del>1.95V和2.7V</del>3.6V，CPU可以根据需要切换。</p>
</blockquote>
<p>3）数据传输的位宽（称作data bus width mode）是允许动态配置的，包括1-bit (默认)模式、4-bit模式和8-bit模式。</p>
<blockquote>
<p>注1：不使用的数据线，需要保持上拉状态，这就是图片2中的DATA中标出上拉的原因。另外，由于数据线宽度是动态可配的，这要求CPU可以动态的enable/disable数据线的那些上拉电阻。</p>
</blockquote>
<p>4）MMC规范定义了CLK的频率范围，包括0-20MHz、0-26MHz、0-52MHz等几种，结合数据线宽度，基本决定了MMC的访问速度。</p>
<p>5）总线规范定义了一种简单的、主从式的总线协议，MMC卡位从机（slave），CPU为主机（Host）。</p>
<p>6）协议规定了三种可以在总线上传输的信标（token）：</p>
<blockquote>
<p>Command，Host通过CMD线发送给Slave的，用于启动（或结束）一个操作（后面介绍）；</p>
<p>Response，Slave通过CMD线发送给Host，用于回应Host发送的Command；</p>
<p>Data，Host和Slave之间通过数据线传说的数据。方向可以是Host到Slave，也可以是Slave到Host。数据线的个数可以是1、4或者8。在每一个时钟周期，每根数据线上可以传输1bit或者2bits的数据。</p>
</blockquote>
<p>7）一次数据传输过程，需要涉及所有的3个信标。一次数据传输的过程也称作Bus Operation，根据场景的不同，MMC协议规定了很多类型的Bus Operation（具体可参考相应的规范）。</p>
<h3 id="3-3-控制器规范"><a href="#3-3-控制器规范" class="headerlink" title="3.3 控制器规范"></a>3.3 控制器规范</h3><p>Host控制器是MMC总线规范在Host端的实现，也是Linux驱动工程师比较关注的地方，后面将会结合Linux MMC framework的有关内容，再详细介绍。</p>
<h2 id="4-总结"><a href="#4-总结" class="headerlink" title="4. 总结"></a>4. 总结</h2><p>本文对MMC/SD/SDIO等做了一个简单的介绍，有了这些基本概念之后，在Linux kernel中编写MMC驱动将不再是一个困难的事情（因为MMC是一个协议，所有有关协议的事情，都很简单，因为协议是固定的），我们只需要如下步骤即可完成：</p>
<blockquote>
<p>1）结合MMC的规范，阅读Host MMC controller的spec，理解有关的功能和操作方法。</p>
<p>2）根据Linux MMC framework的框架，将MMC bus有关的操作方法通过MMC controller实现。</p>
</blockquote>
<p>具体可参考后续MMC framework的分析文档。</p>
<h2 id="5-参考文档"><a href="#5-参考文档" class="headerlink" title="5. 参考文档"></a>5. 参考文档</h2><p>[1] <a href="https://en.wikipedia.org/wiki/MultiMediaCard" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/MultiMediaCard</a></p>
<p>[2] <a href="https://en.wikipedia.org/wiki/Secure_Digital" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Secure_Digital</a></p>
<p>[3] eMM spec（注册后可免费下载），<a href="http://www.jedec.org/standards-documents/results/jesd84-b51" target="_blank" rel="noopener">http://www.jedec.org/standards-documents/results/jesd84-b51</a></p>
<p><strong>注</strong>：本文转自蜗窝科技<a href="http://www.wowotech.net,来自【http://www.wowotech.net/basic_tech/mmc_sd_sdio_intro.html】" target="_blank" rel="noopener">www.wowotech.net,来自【http://www.wowotech.net/basic_tech/mmc_sd_sdio_intro.html】</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/03/ubuntu/%E7%A1%AC%E7%9B%98%E6%B5%8B%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="David Meng">
      <meta itemprop="description" content="冒险，创新，永不放弃">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tech Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/03/ubuntu/%E7%A1%AC%E7%9B%98%E6%B5%8B%E8%AF%95/" class="post-title-link" itemprop="url">硬盘测试</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-09-03 11:24:37 / Modified: 13:26:16" itemprop="dateCreated datePublished" datetime="2020-09-03T11:24:37+08:00">2020-09-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>拿到一块硬盘，需要了解硬盘的性能和坏块，下面总结如何检测坏块和性能测试做些什么事情。</p>
<h2 id="检测坏块"><a href="#检测坏块" class="headerlink" title="检测坏块"></a>检测坏块</h2><p>使用 badblocks检测硬盘坏块</p>
<p>badblocks -s//显示进度  -v//显示执行详细情况   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># badblocks -s -v &#x2F;dev&#x2F;sda</span><br><span class="line">正在检查从 0 到 244198583的块</span><br><span class="line">Checking for bad blocks (read-only test): ^C0.10% done, 0:04 elapsed</span><br><span class="line">Interrupted at block 272896</span><br></pre></td></tr></table></figure>

<p>$badblocks -s//显示进度 -w//以写去检测 -v//显示执行详细情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># badblocks -w -s -v &#x2F;dev&#x2F;sda1</span><br><span class="line">Checking for bad blocks in read-write mode</span><br><span class="line">From block 0 to 25607577</span><br><span class="line">Testing with pattern 0xaa: ^C0.73% done, 0:03 elapsed</span><br><span class="line"></span><br><span class="line">注意，不能以写的方式检测已经挂载的硬盘</span><br></pre></td></tr></table></figure>

<h2 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h2><p>1.测试磁盘读写速度使用hdparm或者dd</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># hdparm -Tt &#x2F;dev&#x2F;sda</span><br><span class="line">&#x2F;dev&#x2F;sda:</span><br><span class="line">Timing cached reads:   </span><br><span class="line">1918 MB in  2.00 seconds &#x3D; 959.62 MB&#x2F;sec</span><br><span class="line">Timing buffered disk reads:  184 MB in  3.00 seconds &#x3D;  61.26 MB&#x2F;sec</span><br></pre></td></tr></table></figure>

<p>hdparm可检测，显示与设定IDE或SCSI硬盘的参数。</p>
<p>语法：</p>
<p>hdparm [-CfghiIqtTvyYZ][-a &lt;快取分区&gt;][-A &lt;0或1&gt;][-c ][-d &lt;0或1&gt;][-k &lt;0或1&gt;][-K &lt;0或1&gt;][-m &lt;分区数&gt;][-n &lt;0或1&gt;][-p ][-P &lt;分区数&gt;][-r &lt;0或1&gt;][-S &lt;时间&gt;][-u &lt;0或1&gt;][-W &lt;0或1&gt;][-X &lt;传输模式&gt;] [设备]<br>-a&lt;快取分区&gt; 设定读取文件时，预先存入块区的分区数，若不加上&lt;快取分区&gt;选项，则显示目前的设定。 -A&lt;0或1&gt; 启动或关闭读取文件时的快取功能。-c&lt;I/O模式&gt; 设定IDE32位I/O模式。 -C 检测IDE硬盘的电源管理模式。-d&lt;0或1&gt; 设定磁盘的DMA模式。-f 将内存缓冲区的数据写入硬盘，并清楚缓冲区。 -g 显示硬盘的磁轨，磁头，磁区等参数。-h 显示帮助。-i 显示硬盘的硬件规格信息，这些信息是在开机时由硬盘本身所提供。 -I 直接读取硬盘所提供的硬件规格信息。-k&lt;0或1&gt; 重设硬盘时，保留-dmu参数的设定。 -K&lt;0或1&gt; 重设硬盘时，保留-APSWXZ参数的设定。-m&lt;磁区数&gt; 设定硬盘多重分区存取的分区数。 -n&lt;0或1&gt; 忽略硬盘写入时所发生的错误。-p&lt;PIO模式&gt; 设定硬盘的PIO模式。 -P&lt;磁区数&gt; 设定硬盘内部快取的分区数。-q 在执行后续的参数时，不在屏幕上显示任何信息。 -r&lt;0或1&gt; 设定硬盘的读写模式。-S&lt;时间&gt; 设定硬盘进入省电模式前的等待时间。-t 评估硬盘的读取效率。 -T 评估硬盘快取的读取效率。-u&lt;0或1&gt; 在硬盘存取时，允许其他中断要求同时执行。-v 显示硬盘的相关设定。 -W&lt;0或1&gt; 设定硬盘的写入快取。-X&lt;传输模式&gt;  设定硬盘的传输模式。-y 使IDE硬盘进入省电模式。 -Y 使IDE硬盘进入睡眠模式。-Z 关闭某些Seagate硬盘的自动省电功能。</p>
<p>2.iostat测试IO瓶颈</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iostat -x 1</span><br><span class="line">Device:         rrqm&#x2F;s   wrqm&#x2F;s     r&#x2F;s     w&#x2F;s   rsec&#x2F;s   wsec&#x2F;s avgrq-sz avgqu-sz   await  svctm  %util</span><br><span class="line">sda               0.00     0.00 2752.00    1.00 1409024.00     8.00   511.82     4.64    1.69   0.35  96.10</span><br></pre></td></tr></table></figure>

<p>3.fio测试随机读写性能</p>
<p>下载并安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;brick.kernel.dk&#x2F;snaps&#x2F;fio-2.2.5.tar.gz</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">yum install libaio-devel gcc  -y</span><br><span class="line">tar -zxvf fio-2.2.5.tar.gz</span><br><span class="line">cd fio-2.2.5</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>使用方法参考<a href="http://www.dbhelp.net/2018/01/09/linux%E6%B5%8B%E8%AF%95%E7%A3%81%E7%9B%98io%E6%80%A7%E8%83%BD%EF%BC%88%E9%9A%8F%E6%9C%BA%E8%AF%BB%E5%86%99%EF%BC%89.html" target="_blank" rel="noopener">http://www.dbhelp.net/2018/01/09/linux%E6%B5%8B%E8%AF%95%E7%A3%81%E7%9B%98io%E6%80%A7%E8%83%BD%EF%BC%88%E9%9A%8F%E6%9C%BA%E8%AF%BB%E5%86%99%EF%BC%89.html</a></p>
<h3 id="磁盘性能指标"><a href="#磁盘性能指标" class="headerlink" title="磁盘性能指标"></a>磁盘性能指标</h3><p>1.磁盘性能指标–IOPS</p>
<p>IOPS (Input/Output Per Second)即每秒的输入输出量(或读写次数)，是衡量磁盘性能的主要指标之一。IOPS是指单位时间内系统能处理的I/O请求数量，一般以每秒处理的I/O请求数量为单位，I/O请求通常为读或写数据操作请求</p>
<p> 随机读写频繁的应用，如小文件存储(图片)、OLTP数据库、邮件服务器，关注随机读写性能，IOPS是关键衡量指标。<br> 顺序读写频繁的应用，传输大量连续数据，如电视台的视频编辑，视频点播VOD(Video On Demand)，关注连续读写性能。数据吞吐量是关键衡量指标。</p>
<p>IOPS和数据吞吐量适用于不同的场合：<br>读取10000个1KB文件，用时10秒  Throught(吞吐量)=1MB/s ，IOPS=1000  追求IOPS<br>读取1个10MB文件，用时0.2秒  Throught(吞吐量)=50MB/s, IOPS=5  追求吞吐量</p>
<p>2.磁盘服务时间</p>
<p>传统磁盘本质上一种机械装置，如FC, SAS, SATA磁盘，转速通常为5400/7200/10K/15K rpm不等。影响磁盘的关键因素是磁盘服务时间，即磁盘完成一个I/O请求所花费的时间，它由寻道时间、旋转延迟和数据传输时间三部分构成。</p>
<p>寻道时间 Tseek是指将读写磁头移动至正确的磁道上所需要的时间。寻道时间越短，I/O操作越快，目前磁盘的平均寻道时间一般在3－15ms。<br>旋转延迟 Trotation是指盘片旋转将请求数据所在扇区移至读写磁头下方所需要的时间。旋转延迟取决于磁盘转速，通常使用磁盘旋转一周所需时间的1/2表示。比如，7200 rpm的磁盘平均旋转延迟大约为60*1000/7200/2 = 4.17ms，而转速为15000 rpm的磁盘其平均旋转延迟为2ms。<br>数据传输时间 Ttransfer是指完成传输所请求的数据所需要的时间，它取决于数据传输率，其值等于数据大小除以数据传输率。目前IDE/ATA能达到133MB/s，SATA II可达到300MB/s的接口数据传输率，数据传输时间通常远小于前两部分消耗时间。简单计算时可忽略。</p>
<p>常见磁盘平均物理寻道时间为：<br>7200转/分的STAT硬盘平均物理寻道时间是9ms<br>10000转/分的STAT硬盘平均物理寻道时间是6ms<br>15000转/分的SAS硬盘平均物理寻道时间是4ms</p>
<p>常见硬盘的旋转延迟时间为：</p>
<p>7200  rpm的磁盘平均旋转延迟大约为60*1000/7200/2 = 4.17ms</p>
<p>10000 rpm的磁盘平均旋转延迟大约为60*1000/10000/2 = 3ms，</p>
<p>15000 rpm的磁盘其平均旋转延迟约为60*1000/15000/2 = 2ms</p>
<p>参考：</p>
<p><a href="https://blog.51cto.com/wushank/1708168" target="_blank" rel="noopener">磁盘性能指标–IOPS、吞吐量及测试</a></p>
<p><a href="https://blog.csdn.net/qq_35298894/article/details/79022859" target="_blank" rel="noopener">Linux 测试 IO 性能（磁盘读写速度）</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/03/ubuntu/smartctl%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="David Meng">
      <meta itemprop="description" content="冒险，创新，永不放弃">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tech Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/03/ubuntu/smartctl%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">smartctl使用介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-09-03 10:52:11 / Modified: 13:27:15" itemprop="dateCreated datePublished" datetime="2020-09-03T10:52:11+08:00">2020-09-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><a href="http://zh.wikipedia.org/wiki/S.M.A.R.T." target="_blank" rel="noopener">S.M.A.R.T.</a> 是个用来检测硬盘健康状况的指标。SMART是一种磁盘自我分析检测技术，早在90年代末就基本得到了普及每一块硬盘（包括IDE、SCSI），在运行的时候都会将自身的若干参数记录下来，这些参数包括型号、容量、温度、密度、扇区、寻道时间、传输、误码率等。硬盘运行了几千小时后，很多内在的物理参数都会发生变化，某一参数超过报警阈值，则说明硬盘接近损坏，此时硬盘依然在工作，如果用户不理睬这个报警继续使用，那么硬盘将变得非常不可靠，随时可能故障。</p>
<h2 id="smart-安装"><a href="#smart-安装" class="headerlink" title="smart 安装"></a>smart 安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install smartmontools</span><br></pre></td></tr></table></figure>



<h2 id="smart使用方法"><a href="#smart使用方法" class="headerlink" title="smart使用方法"></a>smart使用方法</h2><p>smartctl -a <device> 检查该设备是否已经打开SMART技术。 smartctl -s on <device> 如果没有打开SMART技术，使用该命令打开SMART技术。 smartctl -t short <device> 后台检测硬盘，消耗时间短； smartctl -t long <device> 后台检测硬盘，消耗时间长； smartctl -C -t short <device> 前台检测硬盘，消耗时间短； smartctl -C -t long <device> 前台检测硬盘，消耗时间长。其实就是利用硬盘SMART的自检程序。 smartctl -X <device> 中断后台检测硬盘。 smartctl -l selftest <device> 显示硬盘检测日志。 smartctl -l error <device> 显示硬盘错误汇总。<br>首先通过dmesg工具，确认一下硬盘的设备符号。例如一个IDE硬盘连接到Primary IDE 总线上的Slave位置，硬盘设备符号是/dev/hdb，hdb中的h代表IDE，如果显示为sdb，则代表SATA和SCSI，最后一个字幕b代表Primary总线，第二块硬盘即Slave位置，确认硬盘是否打开了SMART支持：</p>
<p>1.查询硬盘是否开启smart支持</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># smartctl -i &#x2F;dev&#x2F;sda</span><br><span class="line">smartctl 5.40 2010-10-16 r3189 [i386-redhat-linux-gnu] (local build)</span><br><span class="line">Copyright (C) 2002-10 by Bruce Allen, http:&#x2F;&#x2F;smartmontools.sourceforge.net</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D; START OF INFORMATION SECTION &#x3D;&#x3D;&#x3D;</span><br><span class="line">Device Model:     HITACHI HTS543225L9SA00</span><br><span class="line">Serial Number:    090131FB2F32YLG28JEA</span><br><span class="line">Firmware Version: FBEZC48C</span><br><span class="line">User Capacity:    250,059,350,016 bytes</span><br><span class="line">Device is:        Not in smartctl database [for details use: -P showall]</span><br><span class="line">ATA Version is:   8</span><br><span class="line">ATA Standard is:  ATA-8-ACS revision 3f</span><br><span class="line">Local Time is:    Wed May 25 10:10:39 2011 CST</span><br><span class="line">SMART support is: Available - device has SMART capability.</span><br><span class="line">SMART support is: Enabled                          &#x2F;&#x2F;表示启用了smart支持</span><br></pre></td></tr></table></figure>

<p>2.如果看到SMART support is: Disabled表示SMART未启用，执行如下命令，启动SMART</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo smartctl -s on &#x2F;dev&#x2F;sda</span><br><span class="line">smartctl 5.41 2011-06-09 r3365 [x86_64-linux-3.8.0-31-generic] (local build)</span><br><span class="line">Copyright (C) 2002-11 by Bruce Allen, http:&#x2F;&#x2F;smartmontools.sourceforge.net</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D; START OF ENABLE&#x2F;DISABLE COMMANDS SECTION &#x3D;&#x3D;&#x3D;</span><br><span class="line">SMART Enabled.</span><br></pre></td></tr></table></figure>

<p>3.支持 SMART 后我们可以使用 <em>-H</em> 参数来手动检查硬盘、随身硬盘的建康状态。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># - 通过 (passed)。</span><br><span class="line">$ sudo smartctl -H &#x2F;dev&#x2F;sda</span><br><span class="line">smartctl 5.41 2011-06-09 r3365 [x86_64-linux-3.8.0-31-generic] (local build)</span><br><span class="line">Copyright (C) 2002-11 by Bruce Allen, http:&#x2F;&#x2F;smartmontools.sourceforge.net</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D; START OF READ SMART DATA SECTION &#x3D;&#x3D;&#x3D;</span><br><span class="line">SMART overall-health self-assessment test result: PASSED</span><br><span class="line"></span><br><span class="line"># - 失败 (failed)。</span><br><span class="line">$ sudo smartctl -H &#x2F;dev&#x2F;sda</span><br><span class="line">smartctl 5.41 2011-06-09 r3365 [x86_64-linux-3.8.0-31-generic] (local build)</span><br><span class="line">Copyright (C) 2002-11 by Bruce Allen, http:&#x2F;&#x2F;smartmontools.sourceforge.net</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D; START OF READ SMART DATA SECTION &#x3D;&#x3D;&#x3D;</span><br><span class="line">SMART overall-health self-assessment test result: FAILED!</span><br><span class="line">Drive failure expected in less than 24 hours. SAVE ALL DATA.</span><br><span class="line">Failed Attributes:</span><br><span class="line">ID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE</span><br><span class="line">5 Reallocated_Sector_Ct   0x0033   004   004   005    Pre-fail  Always   FAILING_NOW 1887</span><br></pre></td></tr></table></figure>







<p>参考：</p>
<p><a href="https://www.w3cschool.cn/working_on_gnu_linux/working_on_gnu_linux-wqdu27ol.html" target="_blank" rel="noopener">GNU/Linux 检测硬盘健康状态：S.M.A.R.T.</a></p>
<p><a href="https://www.cnblogs.com/fiberhome/p/8275961.html" target="_blank" rel="noopener">Linux硬盘的检测–smartctl详细介绍</a></p>
<p><a href="https://www.cnblogs.com/xqzt/p/5512075.html" target="_blank" rel="noopener">硬盘SMART检测参数详解</a></p>
<p><a href="https://blog.csdn.net/watermelonbig/article/details/72871990" target="_blank" rel="noopener">smartctl检测物理磁盘健康度的测试结果解读</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/28/ubuntu/ubuntu%E4%B8%ADQT%E6%97%A0%E6%B3%95%E5%88%87%E6%8D%A2%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="David Meng">
      <meta itemprop="description" content="冒险，创新，永不放弃">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tech Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/28/ubuntu/ubuntu%E4%B8%ADQT%E6%97%A0%E6%B3%95%E5%88%87%E6%8D%A2%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5%E6%B3%95/" class="post-title-link" itemprop="url">ubuntu中QT无法切换中文输入法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-07-28 13:41:31" itemprop="dateCreated datePublished" datetime="2020-07-28T13:41:31+08:00">2020-07-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-07-29 10:19:40" itemprop="dateModified" datetime="2020-07-29T10:19:40+08:00">2020-07-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ubuntu/" itemprop="url" rel="index"><span itemprop="name">ubuntu</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在ubuntu下，系统自带的输入法为fcitx+Sunpinyin,然而QtCreator无法使用系统自带的中文输入法。原因是前下载的QtCreator中没有适配当前输入法框架（ibus、fcitx）的libfcitxplatforminputcontextplugin.so动态库。</p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>已经安装好的qt，且配置好环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export QT_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;qt</span><br><span class="line">export PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;cmake&#x2F;bin:$QT_PATH&#x2F;5.4&#x2F;gcc_64&#x2F;bin:$QT_PATH&#x2F;Tools&#x2F;QtCreator&#x2F;bin:$PATH</span><br></pre></td></tr></table></figure>

<p>1、下载fcitx-libs 源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;fcitx&#x2F;fcitx-qt5.git</span><br></pre></td></tr></table></figure>

<p>2、编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd fcitx-qt5</span><br><span class="line">cmake .</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>

<p>3、编译产生的 libfcitxplatforminputcontextplugin.so在fcitx-qt5/platforminputcontext下，拷贝这个so文件到 Qt5.5安装目录（非必须，因为安装后，会自动拷贝这个so文件到qt的安装目录）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd fcitx-qt5&#x2F;platforminputcontext </span><br><span class="line">cp libfcitxplatforminputcontextplugin.so &#x2F;usr&#x2F;local&#x2F;bin&#x2F;qt&#x2F;5.4&#x2F;gcc_64&#x2F;plugins&#x2F;platforminputcontexts -a</span><br><span class="line">cp libfcitxplatforminputcontextplugin.so &#x2F;usr&#x2F;local&#x2F;bin&#x2F;qt&#x2F;Tools&#x2F;QtCreator&#x2F;bin&#x2F;plugins&#x2F;platforminputcontexts -a</span><br></pre></td></tr></table></figure>

<p>4、重启QtCreator就可以使用系统自带的fcitx输入法了。</p>
<p><strong>编译fcitx-qt5库遇到缺失依赖库的问题：</strong></p>
<p>问题1：第一次编译 fcitx-qt5，会遇到的问题如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;fcitx-qt5# cmake .</span><br><span class="line">-- The C compiler identification is GNU 7.5.0</span><br><span class="line">-- The CXX compiler identification is GNU 7.5.0</span><br><span class="line">-- Check for working C compiler: &#x2F;usr&#x2F;bin&#x2F;cc</span><br><span class="line">-- Check for working C compiler: &#x2F;usr&#x2F;bin&#x2F;cc -- works</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - done</span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - done</span><br><span class="line">-- Check for working CXX compiler: &#x2F;usr&#x2F;bin&#x2F;c++</span><br><span class="line">-- Check for working CXX compiler: &#x2F;usr&#x2F;bin&#x2F;c++ -- works</span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - done</span><br><span class="line">-- Detecting CXX compile features</span><br><span class="line">-- Detecting CXX compile features - done</span><br><span class="line">CMake Error at CMakeLists.txt:8 (find_package):</span><br><span class="line">  Could not find a package configuration file provided by &quot;ECM&quot; (requested</span><br><span class="line">  version 1.4.0) with any of the following names:</span><br><span class="line"></span><br><span class="line">    ECMConfig.cmake</span><br><span class="line">    ecm-config.cmake</span><br><span class="line"></span><br><span class="line">  Add the installation prefix of &quot;ECM&quot; to CMAKE_PREFIX_PATH or set &quot;ECM_DIR&quot;</span><br><span class="line">  to a directory containing one of the above files.  If &quot;ECM&quot; provides a</span><br><span class="line">  separate development package or SDK, be sure it has been installed.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- Configuring incomplete, errors occurred!</span><br><span class="line">See also &quot;&#x2F;root&#x2F;fcitx-qt5&#x2F;CMakeFiles&#x2F;CMakeOutput.log&quot;.</span><br></pre></td></tr></table></figure>

<p>解决方法：</p>
<p>下载extra-cmake-modules</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~# git clone https:&#x2F;&#x2F;github.com&#x2F;KDE&#x2F;extra-cmake-modules.git</span><br><span class="line">root@ubuntu:~# cd extra-cmake-modules&#x2F;</span><br></pre></td></tr></table></figure>

<p>编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;extra-cmake-modules# cmake .</span><br><span class="line">-- Could NOT find Sphinx (missing:  Sphinx_BUILD_EXECUTABLE) (Required is at least version &quot;1.2&quot;)</span><br><span class="line">-- Found QCollectionGenerator: &#x2F;usr&#x2F;local&#x2F;bin&#x2F;qt&#x2F;5.4&#x2F;gcc_64&#x2F;bin&#x2F;qcollectiongenerator (found version &quot;1.0&quot;) </span><br><span class="line">-- The C compiler identification is GNU 7.5.0</span><br><span class="line">-- Check for working C compiler: &#x2F;usr&#x2F;bin&#x2F;cc</span><br><span class="line">-- Check for working C compiler: &#x2F;usr&#x2F;bin&#x2F;cc -- works</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - done</span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - done</span><br><span class="line">-- WARNING: skipping tests that require PyQt</span><br><span class="line">-- </span><br><span class="line">-- The following features have been enabled:</span><br><span class="line"></span><br><span class="line"> * BUILD_TESTING , Build automated tests.</span><br><span class="line"></span><br><span class="line">-- The following OPTIONAL packages have been found:</span><br><span class="line"></span><br><span class="line"> * QCollectionGenerator , Qt help collection generator. , &lt;https:&#x2F;&#x2F;www.qt.io&#x2F;&gt;</span><br><span class="line">   Required to build Extra CMake Modules documentation in Qt Help format.</span><br><span class="line"> * Qt5LinguistTools , Qt5 linguist tools. , &lt;https:&#x2F;&#x2F;www.qt.io&#x2F;&gt;</span><br><span class="line">   Required to run tests for the ECMPoQmTools module.</span><br><span class="line"> * Qt5Core , Qt5 core library. , &lt;https:&#x2F;&#x2F;www.qt.io&#x2F;&gt;</span><br><span class="line">   Required to run tests for the ECMQtDeclareLoggingCategory module, and for some tests of the KDEInstallDirs module.</span><br><span class="line"> * Qt5Gui (required version &gt;&#x3D; 5.4.1)</span><br><span class="line"> * Qt5Network (required version &gt;&#x3D; 5.4.1)</span><br><span class="line"> * Qt5Qml (required version &gt;&#x3D; 5.4.1)</span><br><span class="line"> * Qt5Quick , Qt5 Quick library. , &lt;https:&#x2F;&#x2F;www.qt.io&#x2F;&gt;</span><br><span class="line">   Required to run tests for the ECMQMLModules module.</span><br><span class="line"></span><br><span class="line">-- The following features have been disabled:</span><br><span class="line"></span><br><span class="line"> * BUILD_HTML_DOCS , Generate HTML documentation for installed modules.</span><br><span class="line"> * BUILD_MAN_DOCS , Generate man page documentation for installed modules.</span><br><span class="line"> * BUILD_QTHELP_DOCS , Generate QtHelp documentation for installed modules.</span><br><span class="line"></span><br><span class="line">-- The following OPTIONAL packages have not been found:</span><br><span class="line"></span><br><span class="line"> * Sphinx (required version &gt;&#x3D; 1.2) , Tool to generate documentation. , &lt;https:&#x2F;&#x2F;www.sphinx-doc.org&#x2F;&gt;</span><br><span class="line">   Required to build documentation for Extra CMake Modules.</span><br><span class="line"></span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: &#x2F;root&#x2F;extra-cmake-modules</span><br></pre></td></tr></table></figure>

<p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;extra-cmake-modules# make install</span><br><span class="line">Install the project...</span><br><span class="line">-- Install configuration: &quot;&quot;</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMSetupQtPluginMacroNames.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMAddAppIcon.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMFindQMLModule.cmake.in</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMAddQtDesignerPlugin.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMQtDeclareLoggingCategory.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMQmLoader.cpp.in</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMWinResolveSymlinks.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMUninstallTarget.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMMarkAsTest.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMQueryQmake.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMGenerateExportHeader.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMEnableSanitizers.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMOptionalAddSubdirectory.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMCoverageOption.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMQtDeclareLoggingCategory.cpp.in</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMConfiguredInstall.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMQMLModules.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMFindModuleHelpers.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMMarkNonGuiExecutable.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMPoQmTools.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMCreateQmFromPoFiles.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMGenerateDBusServiceFile.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMGenerateHeaders.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMPackageConfigHelpers.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMInstallIcons.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMQtDeclareLoggingCategory.h.in</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ecm_uninstall.cmake.in</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMGenerateQmlTypes.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMGeneratePriFile.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMSetupVersion.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMQchDoxygenLayout.xml</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMQchDoxygen.config.in</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMAddQch.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMAddTests.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMSourceVersionControl.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMVersionHeader.h.in</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMUseFindModules.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;modules&#x2F;ECMGeneratePkgConfigFile.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;test-modules&#x2F;test_execute_and_compare.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;kde-modules&#x2F;prefix.sh.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;kde-modules&#x2F;appstreamtest.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;kde-modules&#x2F;KDEClangFormat.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;kde-modules&#x2F;KDECompilerSettings.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;kde-modules&#x2F;KDEPackageAppTemplates.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;kde-modules&#x2F;clang-format.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;kde-modules&#x2F;KDECMakeSettings.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;kde-modules&#x2F;KDEFrameworkCompilerSettings.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;kde-modules&#x2F;KDEInstallDirs.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindXCB.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindWaylandScanner.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindX11_XCB.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindPythonModuleGeneration.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindOpenEXR.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindKF5.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindQtWaylandScanner.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindLibGit2.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindInotify.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindGperf.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindSeccomp.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindPhoneNumber.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindUDev.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindTaglib.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindSharedMimeInfo.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindQHelpGenerator.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindGLIB2.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindCanberra.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindSasl2.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;GeneratePythonBindingUmbrellaModule.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindEGL.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindPoppler.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindWayland.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindFontconfig.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindLibExiv2.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;ECMFindModuleHelpersStub.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindIcoTool.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;FindPulseAudio.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;rules_engine.py</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;run-sip.py</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;sip_generator.py</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;find-modules&#x2F;Qt5Ruleset.py</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;toolchain&#x2F;hasMainSymbol.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;toolchain&#x2F;deployment-file-qt514.json.in</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;toolchain&#x2F;ECMAndroidDeployQt.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;toolchain&#x2F;deployment-file.json.in</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;toolchain&#x2F;specifydependencies.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;toolchain&#x2F;Android.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;cmake&#x2F;ECMConfig.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;ECM&#x2F;cmake&#x2F;ECMConfigVersion.cmake</span><br></pre></td></tr></table></figure>

<p>问题2：再次编译fcitx-qt5，会遇到问题如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;fcitx-qt5# cmake .</span><br><span class="line">-- Performing Test SUPPORT_CXX11</span><br><span class="line">-- Performing Test SUPPORT_CXX11 - Success</span><br><span class="line">-- Found PkgConfig: &#x2F;usr&#x2F;bin&#x2F;pkg-config (found version &quot;0.29.1&quot;) </span><br><span class="line">-- Could NOT find XKBCommon_XKBCommon (missing:  XKBCommon_XKBCommon_LIBRARY XKBCommon_XKBCommon_INCLUDE_DIR) </span><br><span class="line">CMake Error at &#x2F;usr&#x2F;share&#x2F;cmake-3.5&#x2F;Modules&#x2F;FindPackageHandleStandardArgs.cmake:148 (message):</span><br><span class="line">  Could NOT find XKBCommon (missing: XKBCommon_LIBRARIES XKBCommon) (Required</span><br><span class="line">  is at least version &quot;0.5.0&quot;)</span><br><span class="line">Call Stack (most recent call first):</span><br><span class="line">  &#x2F;usr&#x2F;share&#x2F;cmake-3.5&#x2F;Modules&#x2F;FindPackageHandleStandardArgs.cmake:388 (_FPHSA_FAILURE_MESSAGE)</span><br><span class="line">  cmake&#x2F;FindXKBCommon.cmake:30 (find_package_handle_standard_args)</span><br><span class="line">  CMakeLists.txt:33 (find_package)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- Configuring incomplete, errors occurred!</span><br><span class="line">See also &quot;&#x2F;root&#x2F;fcitx-qt5&#x2F;CMakeFiles&#x2F;CMakeOutput.log&quot;.</span><br></pre></td></tr></table></figure>

<p>解决方法：</p>
<p><a href="http://xkbcommon.org/" target="_blank" rel="noopener">http://xkbcommon.org/</a> 下载xkbcommon（本文下次0.8.4）</p>
<p>进入xkbcommon配置并编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;libxkbcommon-0.8.4# .&#x2F;configure --disable-x11</span><br><span class="line">checking for a BSD-compatible install... &#x2F;usr&#x2F;bin&#x2F;install -c</span><br><span class="line">checking whether build environment is sane... yes</span><br><span class="line">checking for a thread-safe mkdir -p... &#x2F;bin&#x2F;mkdir -p</span><br><span class="line">checking for gawk... no</span><br><span class="line">checking for mawk... mawk</span><br><span class="line">checking whether make sets $(MAKE)... yes</span><br><span class="line">checking whether make supports nested variables... yes</span><br><span class="line">checking whether to enable maintainer-specific portions of Makefiles... yes</span><br><span class="line">checking whether make supports the include directive... yes (GNU style)</span><br><span class="line">checking for gcc... gcc</span><br><span class="line">checking whether the C compiler works... yes</span><br><span class="line">checking for C compiler default output file name... a.out</span><br><span class="line">checking for suffix of executables... </span><br><span class="line">checking whether we are cross compiling... no</span><br><span class="line">checking for suffix of object files... o</span><br><span class="line">checking whether we are using the GNU C compiler... yes</span><br><span class="line">checking whether gcc accepts -g... yes</span><br><span class="line">checking for gcc option to accept ISO C89... none needed</span><br><span class="line">checking whether gcc understands -c and -o together... yes</span><br><span class="line">checking dependency style of gcc... gcc3</span><br><span class="line">checking how to run the C preprocessor... gcc -E</span><br><span class="line">checking for grep that handles long lines and -e... &#x2F;bin&#x2F;grep</span><br><span class="line">checking for egrep... &#x2F;bin&#x2F;grep -E</span><br><span class="line">checking for ANSI C header files... yes</span><br><span class="line">checking for sys&#x2F;types.h... yes</span><br><span class="line">checking for sys&#x2F;stat.h... yes</span><br><span class="line">checking for stdlib.h... yes</span><br><span class="line">checking for string.h... yes</span><br><span class="line">checking for memory.h... yes</span><br><span class="line">checking for strings.h... yes</span><br><span class="line">checking for inttypes.h... yes</span><br><span class="line">checking for stdint.h... yes</span><br><span class="line">checking for unistd.h... yes</span><br><span class="line">checking minix&#x2F;config.h usability... no</span><br><span class="line">checking minix&#x2F;config.h presence... no</span><br><span class="line">checking for minix&#x2F;config.h... no</span><br><span class="line">checking whether it is safe to define __EXTENSIONS__... yes</span><br><span class="line">checking build system type... x86_64-pc-linux-gnu</span><br><span class="line">checking host system type... x86_64-pc-linux-gnu</span><br><span class="line">checking how to print strings... printf</span><br><span class="line">checking for a sed that does not truncate output... &#x2F;bin&#x2F;sed</span><br><span class="line">checking for fgrep... &#x2F;bin&#x2F;grep -F</span><br><span class="line">checking for ld used by gcc... &#x2F;usr&#x2F;bin&#x2F;ld</span><br><span class="line">checking if the linker (&#x2F;usr&#x2F;bin&#x2F;ld) is GNU ld... yes</span><br><span class="line">checking for BSD- or MS-compatible name lister (nm)... &#x2F;usr&#x2F;bin&#x2F;nm -B</span><br><span class="line">checking the name lister (&#x2F;usr&#x2F;bin&#x2F;nm -B) interface... BSD nm</span><br><span class="line">checking whether ln -s works... yes</span><br><span class="line">checking the maximum length of command line arguments... 1572864</span><br><span class="line">checking how to convert x86_64-pc-linux-gnu file names to x86_64-pc-linux-gnu format... func_convert_file_noop</span><br><span class="line">checking how to convert x86_64-pc-linux-gnu file names to toolchain format... func_convert_file_noop</span><br><span class="line">checking for &#x2F;usr&#x2F;bin&#x2F;ld option to reload object files... -r</span><br><span class="line">checking for objdump... objdump</span><br><span class="line">checking how to recognize dependent libraries... pass_all</span><br><span class="line">checking for dlltool... no</span><br><span class="line">checking how to associate runtime and link libraries... printf %s\n</span><br><span class="line">checking for ar... ar</span><br><span class="line">checking for archiver @FILE support... @</span><br><span class="line">checking for strip... strip</span><br><span class="line">checking for ranlib... ranlib</span><br><span class="line">checking command to parse &#x2F;usr&#x2F;bin&#x2F;nm -B output from gcc object... ok</span><br><span class="line">checking for sysroot... no</span><br><span class="line">checking for a working dd... &#x2F;bin&#x2F;dd</span><br><span class="line">checking how to truncate binary pipes... &#x2F;bin&#x2F;dd bs&#x3D;4096 count&#x3D;1</span><br><span class="line">checking for mt... mt</span><br><span class="line">checking if mt is a manifest tool... no</span><br><span class="line">checking for dlfcn.h... yes</span><br><span class="line">checking for objdir... .libs</span><br><span class="line">checking if gcc supports -fno-rtti -fno-exceptions... no</span><br><span class="line">checking for gcc option to produce PIC... -fPIC -DPIC</span><br><span class="line">checking if gcc PIC flag -fPIC -DPIC works... yes</span><br><span class="line">checking if gcc static flag -static works... yes</span><br><span class="line">checking if gcc supports -c -o file.o... yes</span><br><span class="line">checking if gcc supports -c -o file.o... (cached) yes</span><br><span class="line">checking whether the gcc linker (&#x2F;usr&#x2F;bin&#x2F;ld -m elf_x86_64) supports shared libraries... yes</span><br><span class="line">checking whether -lc should be explicitly linked in... no</span><br><span class="line">checking dynamic linker characteristics... GNU&#x2F;Linux ld.so</span><br><span class="line">checking how to hardcode library paths into programs... immediate</span><br><span class="line">checking whether stripping libraries is possible... yes</span><br><span class="line">checking if libtool supports shared libraries... yes</span><br><span class="line">checking whether to build shared libraries... yes</span><br><span class="line">checking whether to build static libraries... yes</span><br><span class="line">checking for gcc option to accept ISO C99... none needed</span><br><span class="line">checking whether __clang__ is declared... no</span><br><span class="line">checking whether __INTEL_COMPILER is declared... no</span><br><span class="line">checking whether __SUNPRO_C is declared... no</span><br><span class="line">checking for pkg-config... &#x2F;usr&#x2F;bin&#x2F;pkg-config</span><br><span class="line">checking pkg-config is at least version 0.9.0... yes</span><br><span class="line">checking if gcc supports -Werror&#x3D;unknown-warning-option... no</span><br><span class="line">checking if gcc supports -Werror&#x3D;unused-command-line-argument... no</span><br><span class="line">checking if gcc supports -Wall... yes</span><br><span class="line">checking if gcc supports -Wpointer-arith... yes</span><br><span class="line">checking if gcc supports -Wmissing-declarations... yes</span><br><span class="line">checking if gcc supports -Wformat&#x3D;2... yes</span><br><span class="line">checking if gcc supports -Wstrict-prototypes... yes</span><br><span class="line">checking if gcc supports -Wmissing-prototypes... yes</span><br><span class="line">checking if gcc supports -Wnested-externs... yes</span><br><span class="line">checking if gcc supports -Wbad-function-cast... yes</span><br><span class="line">checking if gcc supports -Wold-style-definition... yes</span><br><span class="line">checking if gcc supports -Wdeclaration-after-statement... yes</span><br><span class="line">checking if gcc supports -Wunused... yes</span><br><span class="line">checking if gcc supports -Wuninitialized... yes</span><br><span class="line">checking if gcc supports -Wshadow... yes</span><br><span class="line">checking if gcc supports -Wmissing-noreturn... yes</span><br><span class="line">checking if gcc supports -Wmissing-format-attribute... yes</span><br><span class="line">checking if gcc supports -Wredundant-decls... yes</span><br><span class="line">checking if gcc supports -Wlogical-op... yes</span><br><span class="line">checking if gcc supports -Werror&#x3D;implicit... yes</span><br><span class="line">checking if gcc supports -Werror&#x3D;nonnull... yes</span><br><span class="line">checking if gcc supports -Werror&#x3D;init-self... yes</span><br><span class="line">checking if gcc supports -Werror&#x3D;main... yes</span><br><span class="line">checking if gcc supports -Werror&#x3D;missing-braces... yes</span><br><span class="line">checking if gcc supports -Werror&#x3D;sequence-point... yes</span><br><span class="line">checking if gcc supports -Werror&#x3D;return-type... yes</span><br><span class="line">checking if gcc supports -Werror&#x3D;trigraphs... yes</span><br><span class="line">checking if gcc supports -Werror&#x3D;array-bounds... yes</span><br><span class="line">checking if gcc supports -Werror&#x3D;write-strings... yes</span><br><span class="line">checking if gcc supports -Werror&#x3D;address... yes</span><br><span class="line">checking if gcc supports -Werror&#x3D;int-to-pointer-cast... yes</span><br><span class="line">checking if gcc supports -Werror&#x3D;pointer-to-int-cast... yes</span><br><span class="line">checking if gcc supports -pedantic... yes</span><br><span class="line">checking if gcc supports -Werror... yes</span><br><span class="line">checking if gcc supports -Werror&#x3D;attributes... yes</span><br><span class="line">Package xorg-macros was not found in the pkg-config search path.</span><br><span class="line">Perhaps you should add the directory containing &#96;xorg-macros.pc&#39;</span><br><span class="line">to the PKG_CONFIG_PATH environment variable</span><br><span class="line">No package &#39;xorg-macros&#39; found</span><br><span class="line">checking whether make supports nested variables... (cached) yes</span><br><span class="line">checking whether to build documentation... yes</span><br><span class="line">checking for doxygen... no</span><br><span class="line">configure: WARNING: doxygen not found - documentation targets will be skipped</span><br><span class="line">checking for inline... inline</span><br><span class="line">checking for pkg-config... (cached) &#x2F;usr&#x2F;bin&#x2F;pkg-config</span><br><span class="line">checking pkg-config is at least version 0.9.0... yes</span><br><span class="line">checking for bison... no</span><br><span class="line">checking for byacc... no</span><br><span class="line">checking for yacc... no</span><br><span class="line">checking for eaccess... yes</span><br><span class="line">checking for euidaccess... yes</span><br><span class="line">checking for mmap... yes</span><br><span class="line">checking for mkostemp... yes</span><br><span class="line">checking for posix_fallocate... yes</span><br><span class="line">checking for secure_getenv... yes</span><br><span class="line">checking for __secure_getenv... no</span><br><span class="line">checking for __builtin_expect... yes</span><br><span class="line">checking for __builtin_popcount... yes</span><br><span class="line">checking linux&#x2F;input.h usability... yes</span><br><span class="line">checking linux&#x2F;input.h presence... yes</span><br><span class="line">checking for linux&#x2F;input.h... yes</span><br><span class="line">checking if gcc supports -fvisibility&#x3D;hidden -fno-strict-aliasing -fsanitize-undefined-trap-on-error... yes</span><br><span class="line">checking if gcc supports -Wextra -Wno-unused-parameter -Wno-missing-field-initializers... yes</span><br><span class="line">checking if gcc supports -Wdocumentation -Wno-documentation-deprecated-sync... no</span><br><span class="line">checking whether the linker accepts -Wl,--no-undefined... yes</span><br><span class="line">checking whether the linker accepts -Wl,--version-script&#x3D;&quot;.&#x2F;xkbcommon.map&quot;... yes</span><br><span class="line">checking that generated files are newer than configure... done</span><br><span class="line">configure: creating .&#x2F;config.status</span><br><span class="line">config.status: creating Makefile</span><br><span class="line">config.status: creating xkbcommon.pc</span><br><span class="line">config.status: creating xkbcommon-x11.pc</span><br><span class="line">config.status: creating doc&#x2F;Doxyfile</span><br><span class="line">config.status: creating src&#x2F;config.h</span><br><span class="line">config.status: executing depfiles commands</span><br><span class="line">config.status: executing libtool commands</span><br><span class="line"></span><br><span class="line">        libxkbcommon 0.8.4</span><br><span class="line"></span><br><span class="line">        libxkbcommon:            yes</span><br><span class="line">        libxkbcommon-x11:        no</span><br><span class="line">        Wayland utilities:       no</span><br><span class="line">        documentation:           yes</span><br><span class="line"></span><br><span class="line">        default XKB rules:       evdev</span><br><span class="line">        default XKB model:       pc105</span><br><span class="line">        default XKB layout:      us</span><br><span class="line">        default XKB variant:     </span><br><span class="line">        default XKB options:     </span><br><span class="line"></span><br><span class="line">        prefix:                  &#x2F;usr&#x2F;local</span><br><span class="line">        includedir:              $&#123;prefix&#125;&#x2F;include</span><br><span class="line">        lib dir:                 $&#123;exec_prefix&#125;&#x2F;lib</span><br><span class="line">        datarootdir:             $&#123;prefix&#125;&#x2F;share</span><br><span class="line">        XKB config root:         &#x2F;usr&#x2F;share&#x2F;X11&#x2F;xkb</span><br><span class="line">        X11 locale root:         $&#123;datarootdir&#125;&#x2F;X11&#x2F;locale</span><br></pre></td></tr></table></figure>

<p>编译会出现如下错误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;libxkbcommon-0.8.4# make</span><br><span class="line">  YACC     src&#x2F;xkbcomp&#x2F;parser.c</span><br><span class="line">.&#x2F;build-aux&#x2F;ylwrap: 行 176: yacc: 未找到命令</span><br><span class="line">Makefile:1705: recipe for target &#39;src&#x2F;xkbcomp&#x2F;parser.c&#39; failed</span><br><span class="line">make: *** [src&#x2F;xkbcomp&#x2F;parser.c] Error 127</span><br></pre></td></tr></table></figure>

<p>解决方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;libxkbcommon-0.8.4# apt-get install bison</span><br><span class="line">正在读取软件包列表... 完成</span><br><span class="line">正在分析软件包的依赖关系树       </span><br><span class="line">正在读取状态信息... 完成       </span><br><span class="line">下列软件包是自动安装的并且现在不需要了：</span><br><span class="line">  cpp-5 libisl15 libmpfr4</span><br><span class="line">使用&#39;apt autoremove&#39;来卸载它(它们)。</span><br><span class="line">将会同时安装下列软件：</span><br><span class="line">  libbison-dev</span><br><span class="line">建议安装：</span><br><span class="line">  bison-doc</span><br><span class="line">下列【新】软件包将被安装：</span><br><span class="line">  bison libbison-dev</span><br><span class="line">升级了 0 个软件包，新安装了 2 个软件包，要卸载 0 个软件包，有 1000 个软件包未被升级。</span><br><span class="line">需要下载 605 kB 的归档。</span><br><span class="line">解压缩后会消耗 1,811 kB 的额外空间。</span><br><span class="line">您希望继续执行吗？ [Y&#x2F;n] y</span><br><span class="line">获取:1 http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu bionic&#x2F;main amd64 libbison-dev amd64 2:3.0.4.dfsg-1build1 [339 kB]</span><br><span class="line">获取:2 http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu bionic&#x2F;main amd64 bison amd64 2:3.0.4.dfsg-1build1 [266 kB]</span><br><span class="line">已下载 605 kB，耗时 0秒 (1,369 kB&#x2F;s)</span><br><span class="line">正在选中未选择的软件包 libbison-dev:amd64。</span><br><span class="line">(正在读取数据库 ... 系统当前共安装有 129703 个文件和目录。)</span><br><span class="line">正准备解包 ...&#x2F;libbison-dev_2%3a3.0.4.dfsg-1build1_amd64.deb  ...</span><br><span class="line">正在解包 libbison-dev:amd64 (2:3.0.4.dfsg-1build1) ...</span><br><span class="line">正在选中未选择的软件包 bison。</span><br><span class="line">正准备解包 ...&#x2F;bison_2%3a3.0.4.dfsg-1build1_amd64.deb  ...</span><br><span class="line">正在解包 bison (2:3.0.4.dfsg-1build1) ...</span><br><span class="line">正在设置 libbison-dev:amd64 (2:3.0.4.dfsg-1build1) ...</span><br><span class="line">正在设置 bison (2:3.0.4.dfsg-1build1) ...</span><br><span class="line">update-alternatives: 使用 &#x2F;usr&#x2F;bin&#x2F;bison.yacc 来在自动模式中提供 &#x2F;usr&#x2F;bin&#x2F;yacc (yacc)</span><br><span class="line">正在处理用于 man-db (2.7.5-1) 的触发器 ...</span><br></pre></td></tr></table></figure>

<p>再次编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;libxkbcommon-0.8.4# make</span><br><span class="line">  YACC     src&#x2F;xkbcomp&#x2F;parser.c</span><br><span class="line">updating src&#x2F;xkbcomp&#x2F;parser.h</span><br><span class="line">make  all-am</span><br><span class="line">make[1]: Entering directory &#39;&#x2F;root&#x2F;libxkbcommon-0.8.4&#39;</span><br><span class="line">  CC       src&#x2F;compose&#x2F;parser.lo</span><br><span class="line">  CC       src&#x2F;compose&#x2F;paths.lo</span><br><span class="line">  CC       src&#x2F;compose&#x2F;state.lo</span><br><span class="line">  CC       src&#x2F;compose&#x2F;table.lo</span><br><span class="line">  CC       src&#x2F;xkbcomp&#x2F;action.lo</span><br><span class="line">  CC       src&#x2F;xkbcomp&#x2F;ast-build.lo</span><br><span class="line">  CC       src&#x2F;xkbcomp&#x2F;compat.lo</span><br><span class="line">  CC       src&#x2F;xkbcomp&#x2F;expr.lo</span><br><span class="line">  CC       src&#x2F;xkbcomp&#x2F;include.lo</span><br><span class="line">  CC       src&#x2F;xkbcomp&#x2F;keycodes.lo</span><br><span class="line">  CC       src&#x2F;xkbcomp&#x2F;keymap.lo</span><br><span class="line">  CC       src&#x2F;xkbcomp&#x2F;keymap-dump.lo</span><br><span class="line">  CC       src&#x2F;xkbcomp&#x2F;keywords.lo</span><br><span class="line">  CC       src&#x2F;xkbcomp&#x2F;parser.lo</span><br><span class="line">  CC       src&#x2F;xkbcomp&#x2F;rules.lo</span><br><span class="line">  CC       src&#x2F;xkbcomp&#x2F;scanner.lo</span><br><span class="line">  CC       src&#x2F;xkbcomp&#x2F;symbols.lo</span><br><span class="line">  CC       src&#x2F;xkbcomp&#x2F;types.lo</span><br><span class="line">  CC       src&#x2F;xkbcomp&#x2F;vmod.lo</span><br><span class="line">  CC       src&#x2F;xkbcomp&#x2F;xkbcomp.lo</span><br><span class="line">  CC       src&#x2F;atom.lo</span><br><span class="line">  CC       src&#x2F;context.lo</span><br><span class="line">  CC       src&#x2F;context-priv.lo</span><br><span class="line">  CC       src&#x2F;keysym.lo</span><br><span class="line">  CC       src&#x2F;keysym-utf.lo</span><br><span class="line">  CC       src&#x2F;keymap.lo</span><br><span class="line">  CC       src&#x2F;keymap-priv.lo</span><br><span class="line">  CC       src&#x2F;state.lo</span><br><span class="line">  CC       src&#x2F;text.lo</span><br><span class="line">  CC       src&#x2F;utf8.lo</span><br><span class="line">  CC       src&#x2F;utils.lo</span><br><span class="line">  CCLD     libxkbcommon.la</span><br><span class="line">copying selected object files to avoid basename conflicts...</span><br><span class="line">make[1]: Leaving directory &#39;&#x2F;root&#x2F;libxkbcommon-0.8.4&#39;</span><br></pre></td></tr></table></figure>

<p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;libxkbcommon-0.8.4# make install</span><br><span class="line">make  install-am</span><br><span class="line">make[1]: Entering directory &#39;&#x2F;root&#x2F;libxkbcommon-0.8.4&#39;</span><br><span class="line">make[2]: Entering directory &#39;&#x2F;root&#x2F;libxkbcommon-0.8.4&#39;</span><br><span class="line"> &#x2F;bin&#x2F;mkdir -p &#39;&#x2F;usr&#x2F;local&#x2F;lib&#39;</span><br><span class="line"> &#x2F;bin&#x2F;bash .&#x2F;libtool   --mode&#x3D;install &#x2F;usr&#x2F;bin&#x2F;install -c   libxkbcommon.la &#39;&#x2F;usr&#x2F;local&#x2F;lib&#39;</span><br><span class="line">libtool: install: &#x2F;usr&#x2F;bin&#x2F;install -c .libs&#x2F;libxkbcommon.so.0.0.0 &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libxkbcommon.so.0.0.0</span><br><span class="line">libtool: install: (cd &#x2F;usr&#x2F;local&#x2F;lib &amp;&amp; &#123; ln -s -f libxkbcommon.so.0.0.0 libxkbcommon.so.0 || &#123; rm -f libxkbcommon.so.0 &amp;&amp; ln -s libxkbcommon.so.0.0.0 libxkbcommon.so.0; &#125;; &#125;)</span><br><span class="line">libtool: install: (cd &#x2F;usr&#x2F;local&#x2F;lib &amp;&amp; &#123; ln -s -f libxkbcommon.so.0.0.0 libxkbcommon.so || &#123; rm -f libxkbcommon.so &amp;&amp; ln -s libxkbcommon.so.0.0.0 libxkbcommon.so; &#125;; &#125;)</span><br><span class="line">libtool: install: &#x2F;usr&#x2F;bin&#x2F;install -c .libs&#x2F;libxkbcommon.lai &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libxkbcommon.la</span><br><span class="line">libtool: install: &#x2F;usr&#x2F;bin&#x2F;install -c .libs&#x2F;libxkbcommon.a &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libxkbcommon.a</span><br><span class="line">libtool: install: chmod 644 &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libxkbcommon.a</span><br><span class="line">libtool: install: ranlib &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libxkbcommon.a</span><br><span class="line">libtool: finish: PATH&#x3D;&quot;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;cmake&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;bin&#x2F;qt&#x2F;5.4&#x2F;gcc_64&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;bin&#x2F;qt&#x2F;Tools&#x2F;QtCreator&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;cuda&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;local&#x2F;games:&#x2F;sbin&quot; ldconfig -n &#x2F;usr&#x2F;local&#x2F;lib</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Libraries have been installed in:</span><br><span class="line">   &#x2F;usr&#x2F;local&#x2F;lib</span><br><span class="line"></span><br><span class="line">If you ever happen to want to link against installed libraries</span><br><span class="line">in a given directory, LIBDIR, you must either use libtool, and</span><br><span class="line">specify the full pathname of the library, or use the &#39;-LLIBDIR&#39;</span><br><span class="line">flag during linking and do at least one of the following:</span><br><span class="line">   - add LIBDIR to the &#39;LD_LIBRARY_PATH&#39; environment variable</span><br><span class="line">     during execution</span><br><span class="line">   - add LIBDIR to the &#39;LD_RUN_PATH&#39; environment variable</span><br><span class="line">     during linking</span><br><span class="line">   - use the &#39;-Wl,-rpath -Wl,LIBDIR&#39; linker flag</span><br><span class="line">   - have your system administrator add LIBDIR to &#39;&#x2F;etc&#x2F;ld.so.conf&#39;</span><br><span class="line"></span><br><span class="line">See any operating system documentation about shared libraries for</span><br><span class="line">more information, such as the ld(1) and ld.so(8) manual pages.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line"> &#x2F;bin&#x2F;mkdir -p &#39;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;pkgconfig&#39;</span><br><span class="line"> &#x2F;usr&#x2F;bin&#x2F;install -c -m 644 xkbcommon.pc &#39;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;pkgconfig&#39;</span><br><span class="line"> &#x2F;bin&#x2F;mkdir -p &#39;&#x2F;usr&#x2F;local&#x2F;include&#x2F;xkbcommon&#39;</span><br><span class="line"> &#x2F;usr&#x2F;bin&#x2F;install -c -m 644 xkbcommon&#x2F;xkbcommon.h xkbcommon&#x2F;xkbcommon-compat.h xkbcommon&#x2F;xkbcommon-compose.h xkbcommon&#x2F;xkbcommon-keysyms.h xkbcommon&#x2F;xkbcommon-names.h &#39;&#x2F;usr&#x2F;local&#x2F;include&#x2F;xkbcommon&#39;</span><br><span class="line">make[2]: Leaving directory &#39;&#x2F;root&#x2F;libxkbcommon-0.8.4&#39;</span><br><span class="line">make[1]: Leaving directory &#39;&#x2F;root&#x2F;libxkbcommon-0.8.4&#39;</span><br></pre></td></tr></table></figure>

<p>问题3：再次编译，发现没安装cmake</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;fcitx-qt5# cmake .</span><br><span class="line">-- Found XKBCommon_XKBCommon: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libxkbcommon.so (found version &quot;0.8.4&quot;) </span><br><span class="line">-- Found XKBCommon: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libxkbcommon.so (found suitable version &quot;0.8.4&quot;, minimum required is &quot;0.5.0&quot;) found components:  XKBCommon </span><br><span class="line">CMake Error at CMakeLists.txt:36 (find_package):</span><br><span class="line">  By not providing &quot;FindFcitx.cmake&quot; in CMAKE_MODULE_PATH this project has</span><br><span class="line">  asked CMake to find a package configuration file provided by &quot;Fcitx&quot;, but</span><br><span class="line">  CMake did not find one.</span><br><span class="line"></span><br><span class="line">  Could not find a package configuration file provided by &quot;Fcitx&quot; (requested</span><br><span class="line">  version 4.2.8) with any of the following names:</span><br><span class="line"></span><br><span class="line">    FcitxConfig.cmake</span><br><span class="line">    fcitx-config.cmake</span><br><span class="line"></span><br><span class="line">  Add the installation prefix of &quot;Fcitx&quot; to CMAKE_PREFIX_PATH or set</span><br><span class="line">  &quot;Fcitx_DIR&quot; to a directory containing one of the above files.  If &quot;Fcitx&quot;</span><br><span class="line">  provides a separate development package or SDK, be sure it has been</span><br><span class="line">  installed.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- Configuring incomplete, errors occurred!</span><br><span class="line">See also &quot;&#x2F;root&#x2F;fcitx-qt5&#x2F;CMakeFiles&#x2F;CMakeOutput.log&quot;.</span><br></pre></td></tr></table></figure>

<p>安装cmake</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;fcitx-qt5# apt-get install cmake</span><br></pre></td></tr></table></figure>

<p>重新编译，还是有问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;fcitx-qt5# cmake .</span><br><span class="line">-- The C compiler identification is GNU 7.5.0</span><br><span class="line">-- The CXX compiler identification is GNU 7.5.0</span><br><span class="line">-- Check for working C compiler: &#x2F;usr&#x2F;bin&#x2F;cc</span><br><span class="line">-- Check for working C compiler: &#x2F;usr&#x2F;bin&#x2F;cc -- works</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - done</span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - done</span><br><span class="line">-- Check for working CXX compiler: &#x2F;usr&#x2F;bin&#x2F;c++</span><br><span class="line">-- Check for working CXX compiler: &#x2F;usr&#x2F;bin&#x2F;c++ -- works</span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - done</span><br><span class="line">-- Detecting CXX compile features</span><br><span class="line">-- Detecting CXX compile features - done</span><br><span class="line">CMake Error at CMakeLists.txt:36 (find_package):</span><br><span class="line">  By not providing &quot;FindFcitx.cmake&quot; in CMAKE_MODULE_PATH this project has</span><br><span class="line">  asked CMake to find a package configuration file provided by &quot;Fcitx&quot;, but</span><br><span class="line">  CMake did not find one.</span><br><span class="line"></span><br><span class="line">  Could not find a package configuration file provided by &quot;Fcitx&quot; (requested</span><br><span class="line">  version 4.2.8) with any of the following names:</span><br><span class="line"></span><br><span class="line">    FcitxConfig.cmake</span><br><span class="line">    fcitx-config.cmake</span><br><span class="line"></span><br><span class="line">  Add the installation prefix of &quot;Fcitx&quot; to CMAKE_PREFIX_PATH or set</span><br><span class="line">  &quot;Fcitx_DIR&quot; to a directory containing one of the above files.  If &quot;Fcitx&quot;</span><br><span class="line">  provides a separate development package or SDK, be sure it has been</span><br><span class="line">  installed.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- Configuring incomplete, errors occurred!</span><br><span class="line">See also &quot;&#x2F;root&#x2F;fcitx-qt5&#x2F;CMakeFiles&#x2F;CMakeOutput.log&quot;.</span><br></pre></td></tr></table></figure>

<p>解决方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;fcitx-qt5# apt-get install fcitx-libs-dev</span><br></pre></td></tr></table></figure>

<p>最后编译，成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;fcitx-qt5# cmake .</span><br><span class="line">-- Checking for module &#39;fcitx&#39;</span><br><span class="line">--   Found fcitx, version 4.2.9.6</span><br><span class="line">-- Checking for module &#39;fcitx-config&#39;</span><br><span class="line">--   Found fcitx-config, version 4.2.9.6</span><br><span class="line">-- Checking for module &#39;fcitx-utils&#39;</span><br><span class="line">--   Found fcitx-utils, version 4.2.9.6</span><br><span class="line">-- fcitx4-config found &#x2F;usr&#x2F;bin&#x2F;fcitx4-config</span><br><span class="line">-- Found Fcitx: 4.2.9.6 (Required is at least version &quot;4.2.8&quot;) </span><br><span class="line">-- Looking for dgettext</span><br><span class="line">-- Looking for dgettext - found</span><br><span class="line">-- Found LIBINTL: &#x2F;usr&#x2F;include  </span><br><span class="line">-- Performing Test COMPILER_HAS_HIDDEN_VISIBILITY</span><br><span class="line">-- Performing Test COMPILER_HAS_HIDDEN_VISIBILITY - Success</span><br><span class="line">-- Performing Test COMPILER_HAS_HIDDEN_INLINE_VISIBILITY</span><br><span class="line">-- Performing Test COMPILER_HAS_HIDDEN_INLINE_VISIBILITY - Success</span><br><span class="line">-- Performing Test COMPILER_HAS_DEPRECATED_ATTR</span><br><span class="line">-- Performing Test COMPILER_HAS_DEPRECATED_ATTR - Success</span><br><span class="line">-- The following OPTIONAL packages have been found:</span><br><span class="line"></span><br><span class="line"> * PkgConfig</span><br><span class="line"></span><br><span class="line">-- The following REQUIRED packages have been found:</span><br><span class="line"></span><br><span class="line"> * ECM (required version &gt;&#x3D; 1.4.0)</span><br><span class="line"> * Qt5DBus</span><br><span class="line"> * Qt5Widgets</span><br><span class="line"> * Qt5Concurrent</span><br><span class="line"> * Qt5 (required version &gt;&#x3D; 5.1.0)</span><br><span class="line"> * Qt5Gui (required version &gt;&#x3D; 5.1.0)</span><br><span class="line"> * XKBCommon (required version &gt;&#x3D; 0.5.0), Keyboard handling library using XKB data, &lt;http:&#x2F;&#x2F;xkbcommon.org&gt;</span><br><span class="line"> * Fcitx (required version &gt;&#x3D; 4.2.8)</span><br><span class="line"> * LibIntl</span><br><span class="line"> * Qt5Core</span><br><span class="line"></span><br><span class="line">-- Configuring done</span><br><span class="line">CMake Warning (dev) in guiwrapper&#x2F;CMakeLists.txt:</span><br><span class="line">  Policy CMP0071 is not set: Let AUTOMOC and AUTOUIC process GENERATED files.</span><br><span class="line">  Run &quot;cmake --help-policy CMP0071&quot; for policy details.  Use the cmake_policy</span><br><span class="line">  command to set the policy and suppress this warning.</span><br><span class="line"></span><br><span class="line">  For compatibility, CMake is excluding the GENERATED source file(s):</span><br><span class="line"></span><br><span class="line">    &quot;&#x2F;root&#x2F;fcitx-qt5&#x2F;guiwrapper&#x2F;ui_mainwindow.h&quot;</span><br><span class="line"></span><br><span class="line">  from processing by AUTOMOC.  If any of the files should be processed, set</span><br><span class="line">  CMP0071 to NEW.  If any of the files should not be processed, explicitly</span><br><span class="line">  exclude them by setting the source file property SKIP_AUTOMOC:</span><br><span class="line"></span><br><span class="line">    set_property(SOURCE file.h PROPERTY SKIP_AUTOMOC ON)</span><br><span class="line"></span><br><span class="line">This warning is for project developers.  Use -Wno-dev to suppress it.</span><br><span class="line"></span><br><span class="line">CMake Warning (dev) in quickphrase-editor&#x2F;CMakeLists.txt:</span><br><span class="line">  Policy CMP0071 is not set: Let AUTOMOC and AUTOUIC process GENERATED files.</span><br><span class="line">  Run &quot;cmake --help-policy CMP0071&quot; for policy details.  Use the cmake_policy</span><br><span class="line">  command to set the policy and suppress this warning.</span><br><span class="line"></span><br><span class="line">  For compatibility, CMake is excluding the GENERATED source file(s):</span><br><span class="line"></span><br><span class="line">    &quot;&#x2F;root&#x2F;fcitx-qt5&#x2F;quickphrase-editor&#x2F;ui_editordialog.h&quot;</span><br><span class="line">    &quot;&#x2F;root&#x2F;fcitx-qt5&#x2F;quickphrase-editor&#x2F;ui_batchdialog.h&quot;</span><br><span class="line">    &quot;&#x2F;root&#x2F;fcitx-qt5&#x2F;quickphrase-editor&#x2F;ui_editor.h&quot;</span><br><span class="line"></span><br><span class="line">  from processing by AUTOMOC.  If any of the files should be processed, set</span><br><span class="line">  CMP0071 to NEW.  If any of the files should not be processed, explicitly</span><br><span class="line">  exclude them by setting the source file property SKIP_AUTOMOC:</span><br><span class="line"></span><br><span class="line">    set_property(SOURCE file.h PROPERTY SKIP_AUTOMOC ON)</span><br><span class="line"></span><br><span class="line">This warning is for project developers.  Use -Wno-dev to suppress it.</span><br><span class="line"></span><br><span class="line">CMake Warning (dev) in platforminputcontext&#x2F;CMakeLists.txt:</span><br><span class="line">  Policy CMP0071 is not set: Let AUTOMOC and AUTOUIC process GENERATED files.</span><br><span class="line">  Run &quot;cmake --help-policy CMP0071&quot; for policy details.  Use the cmake_policy</span><br><span class="line">  command to set the policy and suppress this warning.</span><br><span class="line"></span><br><span class="line">  For compatibility, CMake is excluding the GENERATED source file(s):</span><br><span class="line"></span><br><span class="line">    &quot;&#x2F;root&#x2F;fcitx-qt5&#x2F;platforminputcontext&#x2F;inputcontextproxy.h&quot;</span><br><span class="line">    &quot;&#x2F;root&#x2F;fcitx-qt5&#x2F;platforminputcontext&#x2F;inputcontext1proxy.h&quot;</span><br><span class="line">    &quot;&#x2F;root&#x2F;fcitx-qt5&#x2F;platforminputcontext&#x2F;inputmethodproxy.h&quot;</span><br><span class="line">    &quot;&#x2F;root&#x2F;fcitx-qt5&#x2F;platforminputcontext&#x2F;inputmethod1proxy.h&quot;</span><br><span class="line"></span><br><span class="line">  from processing by AUTOMOC.  If any of the files should be processed, set</span><br><span class="line">  CMP0071 to NEW.  If any of the files should not be processed, explicitly</span><br><span class="line">  exclude them by setting the source file property SKIP_AUTOMOC:</span><br><span class="line"></span><br><span class="line">    set_property(SOURCE file.h PROPERTY SKIP_AUTOMOC ON)</span><br><span class="line"></span><br><span class="line">This warning is for project developers.  Use -Wno-dev to suppress it.</span><br><span class="line"></span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: &#x2F;root&#x2F;fcitx-qt5</span><br></pre></td></tr></table></figure>

<p>执行make</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;fcitx-qt5# make</span><br><span class="line">Scanning dependencies of target fcitx-scan-addons.target</span><br><span class="line">[  0%] Built target fcitx-scan-addons.target</span><br><span class="line">Scanning dependencies of target fcitx-modules.target</span><br><span class="line">[  0%] Built target fcitx-modules.target</span><br><span class="line">Scanning dependencies of target FcitxQt5DBusAddons_autogen</span><br><span class="line">[  1%] Automatic MOC for target FcitxQt5DBusAddons</span><br><span class="line">[  1%] Built target FcitxQt5DBusAddons_autogen</span><br><span class="line">Scanning dependencies of target FcitxQt5DBusAddons</span><br><span class="line">[  2%] Building CXX object dbusaddons&#x2F;CMakeFiles&#x2F;FcitxQt5DBusAddons.dir&#x2F;fcitxqtconnection.cpp.o</span><br><span class="line">[  4%] Building CXX object dbusaddons&#x2F;CMakeFiles&#x2F;FcitxQt5DBusAddons.dir&#x2F;fcitxqtformattedpreedit.cpp.o</span><br><span class="line">[  5%] Building CXX object dbusaddons&#x2F;CMakeFiles&#x2F;FcitxQt5DBusAddons.dir&#x2F;fcitxqtinputcontextproxy.cpp.o</span><br><span class="line">[  7%] Building CXX object dbusaddons&#x2F;CMakeFiles&#x2F;FcitxQt5DBusAddons.dir&#x2F;fcitxqtinputmethodproxy.cpp.o</span><br><span class="line">[  8%] Building CXX object dbusaddons&#x2F;CMakeFiles&#x2F;FcitxQt5DBusAddons.dir&#x2F;fcitxqtkeyboardlayout.cpp.o</span><br><span class="line">[ 10%] Building CXX object dbusaddons&#x2F;CMakeFiles&#x2F;FcitxQt5DBusAddons.dir&#x2F;fcitxqtkeyboardproxy.cpp.o</span><br><span class="line">[ 11%] Building CXX object dbusaddons&#x2F;CMakeFiles&#x2F;FcitxQt5DBusAddons.dir&#x2F;fcitxqtinputmethoditem.cpp.o</span><br><span class="line">[ 13%] Building CXX object dbusaddons&#x2F;CMakeFiles&#x2F;FcitxQt5DBusAddons.dir&#x2F;FcitxQt5DBusAddons_autogen&#x2F;mocs_compilation.cpp.o</span><br><span class="line">[ 14%] Linking CXX shared library libFcitxQt5DBusAddons.so</span><br><span class="line">[ 14%] Built target FcitxQt5DBusAddons</span><br><span class="line">Scanning dependencies of target FcitxQt5WidgetsAddons_autogen</span><br><span class="line">[ 16%] Automatic MOC for target FcitxQt5WidgetsAddons</span><br><span class="line">[ 16%] Built target FcitxQt5WidgetsAddons_autogen</span><br><span class="line">Scanning dependencies of target FcitxQt5WidgetsAddons</span><br><span class="line">[ 17%] Building CXX object widgetsaddons&#x2F;CMakeFiles&#x2F;FcitxQt5WidgetsAddons.dir&#x2F;fcitxqtconfiguifactory.cpp.o</span><br><span class="line">[ 19%] Building CXX object widgetsaddons&#x2F;CMakeFiles&#x2F;FcitxQt5WidgetsAddons.dir&#x2F;fcitxqtconfiguiplugin.cpp.o</span><br><span class="line">[ 20%] Building CXX object widgetsaddons&#x2F;CMakeFiles&#x2F;FcitxQt5WidgetsAddons.dir&#x2F;fcitxqtconfiguiwidget.cpp.o</span><br><span class="line">[ 22%] Building CXX object widgetsaddons&#x2F;CMakeFiles&#x2F;FcitxQt5WidgetsAddons.dir&#x2F;fcitxqtkeysequencewidget.cpp.o</span><br><span class="line">[ 23%] Building CXX object widgetsaddons&#x2F;CMakeFiles&#x2F;FcitxQt5WidgetsAddons.dir&#x2F;qtkeytrans.cpp.o</span><br><span class="line">[ 25%] Building CXX object widgetsaddons&#x2F;CMakeFiles&#x2F;FcitxQt5WidgetsAddons.dir&#x2F;FcitxQt5WidgetsAddons_autogen&#x2F;mocs_compilation.cpp.o</span><br><span class="line">[ 26%] Linking CXX shared library libFcitxQt5WidgetsAddons.so</span><br><span class="line">[ 26%] Built target FcitxQt5WidgetsAddons</span><br><span class="line">Scanning dependencies of target fcitx-qt5-gui-wrapper_autogen</span><br><span class="line">[ 27%] Automatic MOC for target fcitx-qt5-gui-wrapper</span><br><span class="line">[ 27%] Built target fcitx-qt5-gui-wrapper_autogen</span><br><span class="line">[ 29%] Generating ui_mainwindow.h</span><br><span class="line">Scanning dependencies of target fcitx-qt5-gui-wrapper</span><br><span class="line">[ 30%] Building CXX object guiwrapper&#x2F;CMakeFiles&#x2F;fcitx-qt5-gui-wrapper.dir&#x2F;main.cpp.o</span><br><span class="line">[ 32%] Building CXX object guiwrapper&#x2F;CMakeFiles&#x2F;fcitx-qt5-gui-wrapper.dir&#x2F;wrapperapp.cpp.o</span><br><span class="line">[ 33%] Building CXX object guiwrapper&#x2F;CMakeFiles&#x2F;fcitx-qt5-gui-wrapper.dir&#x2F;mainwindow.cpp.o</span><br><span class="line">[ 35%] Building CXX object guiwrapper&#x2F;CMakeFiles&#x2F;fcitx-qt5-gui-wrapper.dir&#x2F;fcitx-qt5-gui-wrapper_autogen&#x2F;mocs_compilation.cpp.o</span><br><span class="line">[ 36%] Linking CXX executable fcitx-qt5-gui-wrapper</span><br><span class="line">[ 36%] Built target fcitx-qt5-gui-wrapper</span><br><span class="line">Scanning dependencies of target fcitx-quickphrase-editor5_autogen</span><br><span class="line">[ 38%] Automatic MOC for target fcitx-quickphrase-editor5</span><br><span class="line">[ 38%] Built target fcitx-quickphrase-editor5_autogen</span><br><span class="line">[ 39%] Generating ui_editor.h</span><br><span class="line">[ 41%] Generating ui_editordialog.h</span><br><span class="line">[ 42%] Generating ui_batchdialog.h</span><br><span class="line">Scanning dependencies of target fcitx-quickphrase-editor5</span><br><span class="line">[ 44%] Building CXX object quickphrase-editor&#x2F;CMakeFiles&#x2F;fcitx-quickphrase-editor5.dir&#x2F;main.cpp.o</span><br><span class="line">[ 45%] Building CXX object quickphrase-editor&#x2F;CMakeFiles&#x2F;fcitx-quickphrase-editor5.dir&#x2F;model.cpp.o</span><br><span class="line">[ 47%] Building CXX object quickphrase-editor&#x2F;CMakeFiles&#x2F;fcitx-quickphrase-editor5.dir&#x2F;editor.cpp.o</span><br><span class="line">[ 48%] Building CXX object quickphrase-editor&#x2F;CMakeFiles&#x2F;fcitx-quickphrase-editor5.dir&#x2F;editordialog.cpp.o</span><br><span class="line">[ 50%] Building CXX object quickphrase-editor&#x2F;CMakeFiles&#x2F;fcitx-quickphrase-editor5.dir&#x2F;batchdialog.cpp.o</span><br><span class="line">[ 51%] Building CXX object quickphrase-editor&#x2F;CMakeFiles&#x2F;fcitx-quickphrase-editor5.dir&#x2F;filelistmodel.cpp.o</span><br><span class="line">[ 52%] Building CXX object quickphrase-editor&#x2F;CMakeFiles&#x2F;fcitx-quickphrase-editor5.dir&#x2F;fcitx-quickphrase-editor5_autogen&#x2F;mocs_compilation.cpp.o</span><br><span class="line">[ 54%] Linking CXX shared module libfcitx-quickphrase-editor5.so</span><br><span class="line">[ 54%] Built target fcitx-quickphrase-editor5</span><br><span class="line">Scanning dependencies of target fcitx-compile-mo.target</span><br><span class="line">[ 55%] Generating ..&#x2F;fcitx_cmake_cache&#x2F;mo&#x2F;ca&#x2F;fcitx-qt5.mo</span><br><span class="line">[ 57%] Generating ..&#x2F;fcitx_cmake_cache&#x2F;mo&#x2F;da&#x2F;fcitx-qt5.mo</span><br><span class="line">[ 58%] Generating ..&#x2F;fcitx_cmake_cache&#x2F;mo&#x2F;de&#x2F;fcitx-qt5.mo</span><br><span class="line">[ 60%] Generating ..&#x2F;fcitx_cmake_cache&#x2F;mo&#x2F;es&#x2F;fcitx-qt5.mo</span><br><span class="line">[ 61%] Generating ..&#x2F;fcitx_cmake_cache&#x2F;mo&#x2F;fr&#x2F;fcitx-qt5.mo</span><br><span class="line">[ 63%] Generating ..&#x2F;fcitx_cmake_cache&#x2F;mo&#x2F;ja&#x2F;fcitx-qt5.mo</span><br><span class="line">[ 64%] Generating ..&#x2F;fcitx_cmake_cache&#x2F;mo&#x2F;ko&#x2F;fcitx-qt5.mo</span><br><span class="line">[ 66%] Generating ..&#x2F;fcitx_cmake_cache&#x2F;mo&#x2F;ru&#x2F;fcitx-qt5.mo</span><br><span class="line">[ 67%] Generating ..&#x2F;fcitx_cmake_cache&#x2F;mo&#x2F;zh_CN&#x2F;fcitx-qt5.mo</span><br><span class="line">[ 69%] Generating ..&#x2F;fcitx_cmake_cache&#x2F;mo&#x2F;zh_TW&#x2F;fcitx-qt5.mo</span><br><span class="line">[ 69%] Built target fcitx-compile-mo.target</span><br><span class="line">Scanning dependencies of target fcitxplatforminputcontextplugin_autogen</span><br><span class="line">[ 70%] Automatic MOC for target fcitxplatforminputcontextplugin</span><br><span class="line">[ 70%] Built target fcitxplatforminputcontextplugin_autogen</span><br><span class="line">[ 72%] Generating inputmethod1proxy.cpp, inputmethod1proxy.h</span><br><span class="line">[ 73%] Generating inputcontextproxy.cpp, inputcontextproxy.h</span><br><span class="line">Warning: deprecated annotation &#39;com.trolltech.QtDBus.QtTypeName.In0&#39; found; suggest updating to &#39;org.qtproject.QtDBus.QtTypeName.In0&#39;</span><br><span class="line">[ 75%] Generating inputcontextproxy.moc</span><br><span class="line">[ 76%] Generating inputcontext1proxy.cpp, inputcontext1proxy.h</span><br><span class="line">Warning: deprecated annotation &#39;com.trolltech.QtDBus.QtTypeName.In0&#39; found; suggest updating to &#39;org.qtproject.QtDBus.QtTypeName.In0&#39;</span><br><span class="line">[ 77%] Generating inputcontext1proxy.moc</span><br><span class="line">[ 79%] Generating inputmethodproxy.cpp, inputmethodproxy.h</span><br><span class="line">[ 80%] Generating inputmethodproxy.moc</span><br><span class="line">[ 82%] Generating inputmethod1proxy.moc</span><br><span class="line">Scanning dependencies of target fcitxplatforminputcontextplugin</span><br><span class="line">[ 83%] Building CXX object platforminputcontext&#x2F;CMakeFiles&#x2F;fcitxplatforminputcontextplugin.dir&#x2F;fcitxinputcontextproxy.cpp.o</span><br><span class="line">[ 85%] Building CXX object platforminputcontext&#x2F;CMakeFiles&#x2F;fcitxplatforminputcontextplugin.dir&#x2F;fcitxqtdbustypes.cpp.o</span><br><span class="line">[ 86%] Building CXX object platforminputcontext&#x2F;CMakeFiles&#x2F;fcitxplatforminputcontextplugin.dir&#x2F;fcitxwatcher.cpp.o</span><br><span class="line">[ 88%] Building CXX object platforminputcontext&#x2F;CMakeFiles&#x2F;fcitxplatforminputcontextplugin.dir&#x2F;qfcitxplatforminputcontext.cpp.o</span><br><span class="line">[ 89%] Building CXX object platforminputcontext&#x2F;CMakeFiles&#x2F;fcitxplatforminputcontextplugin.dir&#x2F;main.cpp.o</span><br><span class="line">[ 91%] Building CXX object platforminputcontext&#x2F;CMakeFiles&#x2F;fcitxplatforminputcontextplugin.dir&#x2F;qtkey.cpp.o</span><br><span class="line">[ 92%] Building CXX object platforminputcontext&#x2F;CMakeFiles&#x2F;fcitxplatforminputcontextplugin.dir&#x2F;inputcontextproxy.cpp.o</span><br><span class="line">[ 94%] Building CXX object platforminputcontext&#x2F;CMakeFiles&#x2F;fcitxplatforminputcontextplugin.dir&#x2F;inputcontext1proxy.cpp.o</span><br><span class="line">[ 95%] Building CXX object platforminputcontext&#x2F;CMakeFiles&#x2F;fcitxplatforminputcontextplugin.dir&#x2F;inputmethodproxy.cpp.o</span><br><span class="line">[ 97%] Building CXX object platforminputcontext&#x2F;CMakeFiles&#x2F;fcitxplatforminputcontextplugin.dir&#x2F;inputmethod1proxy.cpp.o</span><br><span class="line">[ 98%] Building CXX object platforminputcontext&#x2F;CMakeFiles&#x2F;fcitxplatforminputcontextplugin.dir&#x2F;fcitxplatforminputcontextplugin_autogen&#x2F;mocs_compilation.cpp.o</span><br><span class="line">[100%] Linking CXX shared module libfcitxplatforminputcontextplugin.so</span><br><span class="line">[100%] Built target fcitxplatforminputcontextplugin</span><br></pre></td></tr></table></figure>

<p>执行make install</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;fcitx-qt5# make install </span><br><span class="line">[  0%] Built target fcitx-scan-addons.target</span><br><span class="line">[  0%] Built target fcitx-modules.target</span><br><span class="line">[  1%] Automatic MOC for target FcitxQt5DBusAddons</span><br><span class="line">[  1%] Built target FcitxQt5DBusAddons_autogen</span><br><span class="line">[ 14%] Built target FcitxQt5DBusAddons</span><br><span class="line">[ 16%] Automatic MOC for target FcitxQt5WidgetsAddons</span><br><span class="line">[ 16%] Built target FcitxQt5WidgetsAddons_autogen</span><br><span class="line">[ 26%] Built target FcitxQt5WidgetsAddons</span><br><span class="line">[ 27%] Automatic MOC for target fcitx-qt5-gui-wrapper</span><br><span class="line">[ 27%] Built target fcitx-qt5-gui-wrapper_autogen</span><br><span class="line">[ 36%] Built target fcitx-qt5-gui-wrapper</span><br><span class="line">[ 38%] Automatic MOC for target fcitx-quickphrase-editor5</span><br><span class="line">[ 38%] Built target fcitx-quickphrase-editor5_autogen</span><br><span class="line">[ 54%] Built target fcitx-quickphrase-editor5</span><br><span class="line">[ 69%] Built target fcitx-compile-mo.target</span><br><span class="line">[ 70%] Automatic MOC for target fcitxplatforminputcontextplugin</span><br><span class="line">[ 70%] Built target fcitxplatforminputcontextplugin_autogen</span><br><span class="line">[100%] Built target fcitxplatforminputcontextplugin</span><br><span class="line">Install the project...</span><br><span class="line">-- Install configuration: &quot;&quot;</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;cmake&#x2F;FcitxQt5DBusAddons&#x2F;FcitxQt5DBusAddonsConfig.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;cmake&#x2F;FcitxQt5DBusAddons&#x2F;FcitxQt5DBusAddonsConfigVersion.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;cmake&#x2F;FcitxQt5DBusAddons&#x2F;FcitxQt5DBusAddonsTargets.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;cmake&#x2F;FcitxQt5DBusAddons&#x2F;FcitxQt5DBusAddonsTargets-noconfig.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;include&#x2F;FcitxQt5&#x2F;fcitxqtdbusaddons_version.h</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libFcitxQt5DBusAddons.so.1.0</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libFcitxQt5DBusAddons.so.1</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libFcitxQt5DBusAddons.so</span><br><span class="line">-- Set runtime path of &quot;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;libFcitxQt5DBusAddons.so.1.0&quot; to &quot;&quot;</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;include&#x2F;FcitxQt5&#x2F;FcitxQtDBusAddons&#x2F;fcitxqtconnection.h</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;include&#x2F;FcitxQt5&#x2F;FcitxQtDBusAddons&#x2F;fcitxqtformattedpreedit.h</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;include&#x2F;FcitxQt5&#x2F;FcitxQtDBusAddons&#x2F;fcitxqtinputcontextproxy.h</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;include&#x2F;FcitxQt5&#x2F;FcitxQtDBusAddons&#x2F;fcitxqtinputmethodproxy.h</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;include&#x2F;FcitxQt5&#x2F;FcitxQtDBusAddons&#x2F;fcitxqtkeyboardlayout.h</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;include&#x2F;FcitxQt5&#x2F;FcitxQtDBusAddons&#x2F;fcitxqtkeyboardproxy.h</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;include&#x2F;FcitxQt5&#x2F;FcitxQtDBusAddons&#x2F;fcitxqtinputmethoditem.h</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;include&#x2F;FcitxQt5&#x2F;FcitxQtDBusAddons&#x2F;fcitxqtdbusaddons_export.h</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;cmake&#x2F;FcitxQt5WidgetsAddons&#x2F;FcitxQt5WidgetsAddonsConfig.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;cmake&#x2F;FcitxQt5WidgetsAddons&#x2F;FcitxQt5WidgetsAddonsConfigVersion.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;cmake&#x2F;FcitxQt5WidgetsAddons&#x2F;FcitxQt5WidgetsAddonsTargets.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;cmake&#x2F;FcitxQt5WidgetsAddons&#x2F;FcitxQt5WidgetsAddonsTargets-noconfig.cmake</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;include&#x2F;FcitxQt5&#x2F;fcitxqtwidgetsaddons_version.h</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libFcitxQt5WidgetsAddons.so.1.0</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libFcitxQt5WidgetsAddons.so.1</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libFcitxQt5WidgetsAddons.so</span><br><span class="line">-- Set runtime path of &quot;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;libFcitxQt5WidgetsAddons.so.1.0&quot; to &quot;&quot;</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;include&#x2F;FcitxQt5&#x2F;FcitxQtWidgetsAddons&#x2F;fcitxqtconfiguifactory.h</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;include&#x2F;FcitxQt5&#x2F;FcitxQtWidgetsAddons&#x2F;fcitxqtconfiguiplugin.h</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;include&#x2F;FcitxQt5&#x2F;FcitxQtWidgetsAddons&#x2F;fcitxqtconfiguiwidget.h</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;include&#x2F;FcitxQt5&#x2F;FcitxQtWidgetsAddons&#x2F;fcitxqtkeysequencewidget.h</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;include&#x2F;FcitxQt5&#x2F;FcitxQtWidgetsAddons&#x2F;fcitxqtwidgetsaddons_export.h</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;fcitx&#x2F;libexec&#x2F;fcitx-qt5-gui-wrapper</span><br><span class="line">-- Set runtime path of &quot;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;fcitx&#x2F;libexec&#x2F;fcitx-qt5-gui-wrapper&quot; to &quot;&quot;</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;fcitx&#x2F;qt&#x2F;libfcitx-quickphrase-editor5.so</span><br><span class="line">-- Set runtime path of &quot;&#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;fcitx&#x2F;qt&#x2F;libfcitx-quickphrase-editor5.so&quot; to &quot;&quot;</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;locale&#x2F;ca&#x2F;LC_MESSAGES&#x2F;fcitx-qt5.mo</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;locale&#x2F;da&#x2F;LC_MESSAGES&#x2F;fcitx-qt5.mo</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;locale&#x2F;de&#x2F;LC_MESSAGES&#x2F;fcitx-qt5.mo</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;locale&#x2F;es&#x2F;LC_MESSAGES&#x2F;fcitx-qt5.mo</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;locale&#x2F;fr&#x2F;LC_MESSAGES&#x2F;fcitx-qt5.mo</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;locale&#x2F;ja&#x2F;LC_MESSAGES&#x2F;fcitx-qt5.mo</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;locale&#x2F;ko&#x2F;LC_MESSAGES&#x2F;fcitx-qt5.mo</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;locale&#x2F;ru&#x2F;LC_MESSAGES&#x2F;fcitx-qt5.mo</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;locale&#x2F;zh_CN&#x2F;LC_MESSAGES&#x2F;fcitx-qt5.mo</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;share&#x2F;locale&#x2F;zh_TW&#x2F;LC_MESSAGES&#x2F;fcitx-qt5.mo</span><br><span class="line">-- Installing: &#x2F;usr&#x2F;local&#x2F;bin&#x2F;qt&#x2F;5.4&#x2F;gcc_64&#x2F;plugins&#x2F;platforminputcontexts&#x2F;libfcitxplatforminputcontextplugin.so</span><br><span class="line">-- Set runtime path of &quot;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;qt&#x2F;5.4&#x2F;gcc_64&#x2F;plugins&#x2F;platforminputcontexts&#x2F;libfcitxplatforminputcontextplugin.so&quot; to &quot;&quot;</span><br></pre></td></tr></table></figure>

<p>查看发现QT的安装目录已经有libfcitxplatforminputcontextplugin.so</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~&#x2F;fcitx-qt5# ls &#x2F;usr&#x2F;local&#x2F;bin&#x2F;qt&#x2F;5.4&#x2F;gcc_64&#x2F;plugins&#x2F;platforminputcontexts</span><br><span class="line">libcomposeplatforminputcontextplugin.so  libfcitxplatforminputcontextplugin.so  libibusplatforminputcontextplugin.so</span><br></pre></td></tr></table></figure>

<p>最后，打开qt程序，发现已经可以使用中文输入法</p>
<p><img src="http://jiali.clouddn.com/20200729_001.png" alt=""></p>
<p>参考：</p>
<p><a href="https://my.oschina.net/lieefu/blog/505363?fromerr=NNm21wBS" target="_blank" rel="noopener">解决Qt5 Creator无法切换输入法（fcitx），Ubuntu中不能使用搜狗输入法录入汉字问题</a></p>
<p><a href="https://blog.csdn.net/tianminggenie/article/details/82909224" target="_blank" rel="noopener">Linux 下 Qt 5 无法切换中文输入法</a></p>
<p><a href="https://www.cnblogs.com/cposture/p/5397694.html" target="_blank" rel="noopener">Ubuntu 16.04 下 Qt 5.6 无法输入中文的问题</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/28/Linux/Driver/Input/Linux%20%E5%BA%94%E7%94%A8%E5%B1%82%E6%A8%A1%E6%8B%9F%E9%94%AE%E7%9B%98%E5%92%8C%E9%BC%A0%E6%A0%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="David Meng">
      <meta itemprop="description" content="冒险，创新，永不放弃">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tech Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/28/Linux/Driver/Input/Linux%20%E5%BA%94%E7%94%A8%E5%B1%82%E6%A8%A1%E6%8B%9F%E9%94%AE%E7%9B%98%E5%92%8C%E9%BC%A0%E6%A0%87/" class="post-title-link" itemprop="url">Linux 应用层模拟键盘和鼠标</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-07-28 10:56:24" itemprop="dateCreated datePublished" datetime="2020-07-28T10:56:24+08:00">2020-07-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-05 11:08:36" itemprop="dateModified" datetime="2021-01-05T11:08:36+08:00">2021-01-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/" itemprop="url" rel="index"><span itemprop="name">Driver</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/Input%E5%AD%90%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">Input子系统</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>利用Linux做一些产品，有时候需要应用程序向系统发送一些键盘的值来替代手动敲键盘。因此，应用程序如何实现向系统发送键盘和鼠标的值？有三种方法可以解决这个问题。方法如下：</p>
<ol>
<li>因为Linux使用input子系统管理鼠标和键盘，所以执行cat /proc/bus/input/devices，找出鼠标和键盘的属于哪个事件，然后调用open()和 write()。</li>
<li>有时候，鼠标和键盘都没有，第一种方法就行不通。使用uinput module就可以解决没有鼠标和键盘仍然可以发送键盘和鼠标事件。</li>
<li>模仿uinput模块，自己编写input的字符驱动设备，然后在该字符设备基础上，把键盘值发送给系统。</li>
</ol>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><h3 id="键盘CTRL-SPACE实现"><a href="#键盘CTRL-SPACE实现" class="headerlink" title="键盘CTRL+SPACE实现"></a>键盘CTRL+SPACE实现</h3><p>方法1–直接使用键盘input事件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">int SimulateKey(void)</span><br><span class="line">&#123;</span><br><span class="line">    struct input_event event;</span><br><span class="line">    int fd &#x3D; 0;</span><br><span class="line"></span><br><span class="line">    fd &#x3D; open(&quot;&#x2F;dev&#x2F;input&#x2F;event3&quot;, O_RDWR);</span><br><span class="line">    if(fd &lt;&#x3D; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        printf(&quot;&#x2F;dev&#x2F;input&#x2F;event3 fail\n&quot;);</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;先发送一个CTRL按下事件</span><br><span class="line">    event.type &#x3D; EV_KEY;</span><br><span class="line">    event.value &#x3D; 1;</span><br><span class="line">    event.code &#x3D; KEY_LEFTCTRL;</span><br><span class="line">    gettimeofday(&amp;event.time,NULL);</span><br><span class="line">    write(fd,&amp;event,sizeof(event)) ;</span><br><span class="line">    &#x2F;&#x2F;发送同步事件</span><br><span class="line">    event.type &#x3D; EV_SYN;</span><br><span class="line">    event.code &#x3D; SYN_REPORT;</span><br><span class="line">    event.value &#x3D; 0;</span><br><span class="line">    write(fd, &amp;event, sizeof(event));</span><br><span class="line">    &#x2F;&#x2F;然后发送一个SPACE按下事件</span><br><span class="line">    memset(&amp;event, 0, sizeof(event));</span><br><span class="line">    gettimeofday(&amp;event.time, NULL);</span><br><span class="line">    event.type &#x3D; EV_KEY;</span><br><span class="line">    event.code &#x3D; KEY_SPACE;</span><br><span class="line">    event.value &#x3D; 1;</span><br><span class="line">    write(fd, &amp;event, sizeof(event));</span><br><span class="line">    &#x2F;&#x2F;发送一个释放SPACE事件</span><br><span class="line">    memset(&amp;event, 0, sizeof(event));</span><br><span class="line">    gettimeofday(&amp;event.time, NULL);</span><br><span class="line">    event.type &#x3D; EV_KEY;</span><br><span class="line">    event.code &#x3D; KEY_SPACE;</span><br><span class="line">    event.value &#x3D; 0;</span><br><span class="line">    write(fd, &amp;event, sizeof(event));</span><br><span class="line">    &#x2F;&#x2F;发送同步事件</span><br><span class="line">    event.type &#x3D; EV_SYN;</span><br><span class="line">    event.code &#x3D; SYN_REPORT;</span><br><span class="line">    event.value &#x3D; 0;</span><br><span class="line">    write(fd, &amp;event, sizeof(event));</span><br><span class="line">    &#x2F;&#x2F;发送释放CTRL事件</span><br><span class="line">    memset(&amp;event, 0, sizeof(event));</span><br><span class="line">    event.type &#x3D; EV_KEY;</span><br><span class="line">    event.value &#x3D; 0;</span><br><span class="line">    event.code &#x3D; KEY_LEFTCTRL;</span><br><span class="line">    gettimeofday(&amp;event.time,NULL);</span><br><span class="line">    write(fd,&amp;event,sizeof(event)) ;</span><br><span class="line">    &#x2F;&#x2F;发送同步事件</span><br><span class="line">    event.type &#x3D; EV_SYN;</span><br><span class="line">    event.code &#x3D; SYN_REPORT;</span><br><span class="line">    event.value &#x3D; 0;</span><br><span class="line">    write(fd, &amp;event, sizeof(event));</span><br><span class="line"></span><br><span class="line">    close(fd);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法2–使用uinput模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">void SimulateKey(int fd)</span><br><span class="line">&#123;</span><br><span class="line">    struct input_event event;</span><br><span class="line">  </span><br><span class="line">    &#x2F;&#x2F;先发送一个CTRL按下事件</span><br><span class="line">    event.type &#x3D; EV_KEY;</span><br><span class="line">    event.value &#x3D; 1;</span><br><span class="line">    event.code &#x3D; KEY_LEFTCTRL;</span><br><span class="line">    gettimeofday(&amp;event.time,NULL);</span><br><span class="line">    write(fd,&amp;event,sizeof(event)) ;</span><br><span class="line">    &#x2F;&#x2F;发送同步事件</span><br><span class="line">    event.type &#x3D; EV_SYN;</span><br><span class="line">    event.code &#x3D; SYN_REPORT;</span><br><span class="line">    event.value &#x3D; 0;</span><br><span class="line">    write(fd, &amp;event, sizeof(event));</span><br><span class="line">    &#x2F;&#x2F;然后发送一个SPACE按下事件</span><br><span class="line">    memset(&amp;event, 0, sizeof(event));</span><br><span class="line">    gettimeofday(&amp;event.time, NULL);</span><br><span class="line">    event.type &#x3D; EV_KEY;</span><br><span class="line">    event.code &#x3D; KEY_SPACE;</span><br><span class="line">    event.value &#x3D; 1;</span><br><span class="line">    write(fd, &amp;event, sizeof(event));</span><br><span class="line">    &#x2F;&#x2F;发送一个释放SPACE事件</span><br><span class="line">    memset(&amp;event, 0, sizeof(event));</span><br><span class="line">    gettimeofday(&amp;event.time, NULL);</span><br><span class="line">    event.type &#x3D; EV_KEY;</span><br><span class="line">    event.code &#x3D; KEY_SPACE;</span><br><span class="line">    event.value &#x3D; 0;</span><br><span class="line">    write(fd, &amp;event, sizeof(event));</span><br><span class="line">    &#x2F;&#x2F;发送同步事件</span><br><span class="line">    event.type &#x3D; EV_SYN;</span><br><span class="line">    event.code &#x3D; SYN_REPORT;</span><br><span class="line">    event.value &#x3D; 0;</span><br><span class="line">    write(fd, &amp;event, sizeof(event));</span><br><span class="line">    &#x2F;&#x2F;发送释放CTRL事件</span><br><span class="line">    memset(&amp;event, 0, sizeof(event));</span><br><span class="line">    event.type &#x3D; EV_KEY;</span><br><span class="line">    event.value &#x3D; 0;</span><br><span class="line">    event.code &#x3D; KEY_LEFTCTRL;</span><br><span class="line">    gettimeofday(&amp;event.time,NULL);</span><br><span class="line">    write(fd,&amp;event,sizeof(event)) ;</span><br><span class="line">    &#x2F;&#x2F;发送同步事件</span><br><span class="line">    event.type &#x3D; EV_SYN;</span><br><span class="line">    event.code &#x3D; SYN_REPORT;</span><br><span class="line">    event.value &#x3D; 0;</span><br><span class="line">    write(fd, &amp;event, sizeof(event));</span><br><span class="line">&#125;</span><br><span class="line">void emit(int fd, int type, int code, int val)</span><br><span class="line">&#123;</span><br><span class="line">   struct input_event ie;</span><br><span class="line"></span><br><span class="line">   ie.type &#x3D; type;</span><br><span class="line">   ie.code &#x3D; code;</span><br><span class="line">   ie.value &#x3D; val;</span><br><span class="line">   &#x2F;* timestamp values below are ignored *&#x2F;</span><br><span class="line">   ie.time.tv_sec &#x3D; 0;</span><br><span class="line">   ie.time.tv_usec &#x3D; 0;</span><br><span class="line"></span><br><span class="line">   write(fd, &amp;ie, sizeof(ie));</span><br><span class="line">&#125;</span><br><span class="line">struct input_event event &#x3D; &#123;0&#125;;</span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">   struct uinput_setup usetup;</span><br><span class="line"></span><br><span class="line">   int fd &#x3D; open(&quot;&#x2F;dev&#x2F;uinput&quot;, O_WRONLY | O_NONBLOCK);</span><br><span class="line">	int i&#x3D;5;</span><br><span class="line"></span><br><span class="line">   &#x2F;*</span><br><span class="line">    * The ioctls below will enable the device that is about to be</span><br><span class="line">    * created, to pass key events, in this case the space key.</span><br><span class="line">    *&#x2F;</span><br><span class="line">    &#x2F;&#x2F;这里必须设置一下EVBIT类型和KEYBIT类型。这里设置为键盘类型，创建KEY_SPACE和KEY_LEFTCTRL键盘值</span><br><span class="line">   ioctl(fd, UI_SET_EVBIT, EV_KEY);</span><br><span class="line">   ioctl(fd, UI_SET_KEYBIT, KEY_SPACE);</span><br><span class="line">   ioctl(fd, UI_SET_KEYBIT, KEY_LEFTCTRL);</span><br><span class="line"></span><br><span class="line">   memset(&amp;usetup, 0, sizeof(usetup));</span><br><span class="line">   usetup.id.bustype &#x3D; BUS_USB;</span><br><span class="line">   usetup.id.vendor &#x3D; 0x1234; &#x2F;* sample vendor *&#x2F;</span><br><span class="line">   usetup.id.product &#x3D; 0x5678; &#x2F;* sample product *&#x2F;</span><br><span class="line">   strcpy(usetup.name, &quot;Example device&quot;);</span><br><span class="line"></span><br><span class="line">   ioctl(fd, UI_DEV_SETUP, &amp;usetup);</span><br><span class="line">   ioctl(fd, UI_DEV_CREATE);</span><br><span class="line"></span><br><span class="line">   &#x2F;*</span><br><span class="line">    * On UI_DEV_CREATE the kernel will create the device node for this</span><br><span class="line">    * device. We are inserting a pause here so that userspace has time</span><br><span class="line">    * to detect, initialize the new device, and can start listening to</span><br><span class="line">    * the event, otherwise it will not notice the event we are about</span><br><span class="line">    * to send. This pause is only needed in our example code!</span><br><span class="line">    *&#x2F;</span><br><span class="line">   sleep(1);</span><br><span class="line"></span><br><span class="line">   &#x2F;* Key press, report the event, send key release, and report again *&#x2F;</span><br><span class="line">  &#x2F;* emit(fd, EV_KEY, KEY_SPACE, 1);</span><br><span class="line">   emit(fd, EV_SYN, SYN_REPORT, 0);</span><br><span class="line">   emit(fd, EV_KEY, KEY_SPACE, 0);</span><br><span class="line">   emit(fd, EV_SYN, SYN_REPORT, 0);*&#x2F;</span><br><span class="line">   SimulateKey(fd);</span><br><span class="line"></span><br><span class="line">   &#x2F;*</span><br><span class="line">    * Give userspace some time to read the events before we destroy the</span><br><span class="line">    * device with UI_DEV_DESTOY.</span><br><span class="line">    *&#x2F;</span><br><span class="line">   sleep(1);</span><br><span class="line"></span><br><span class="line">   ioctl(fd, UI_DEV_DESTROY);</span><br><span class="line">   close(fd);</span><br><span class="line"></span><br><span class="line">   return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="鼠标实现"><a href="#鼠标实现" class="headerlink" title="鼠标实现"></a>鼠标实现</h3><p>略。</p>
<p>参考：</p>
<p><a href="https://www.kernel.org/doc/html/v4.12/input/uinput.html" target="_blank" rel="noopener">uinput module</a></p>
<p><a href="https://my.oschina.net/u/4382392/blog/3920785" target="_blank" rel="noopener">linux系统下，在用户空间应用程序中模拟发送系统键盘事件</a></p>
<p><a href="http://ghostbaby.github.io/blog/2013/08/19/linuxxia-ru-he-mo-ni-an-jian-shu-ru-he-mo-ni-shu-biao/" target="_blank" rel="noopener">Linux下如何模拟按键输入和模拟鼠标</a></p>
<p><a href="http://blog.chinaunix.net/uid-23381466-id-3883164.html" target="_blank" rel="noopener">driver: linux下如何模拟按键输入和模拟鼠标</a></p>
<p><a href="https://www.iteye.com/blog/sipgreen-1774676" target="_blank" rel="noopener">使用UInput模拟系统输入设备–键盘，鼠标，触摸屏</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/25/Linux/Driver/PCIe/linux%E6%9F%A5%E7%9C%8BPCIe%E7%9A%84%E9%85%8D%E7%BD%AE%E7%A9%BA%E9%97%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="David Meng">
      <meta itemprop="description" content="冒险，创新，永不放弃">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tech Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/25/Linux/Driver/PCIe/linux%E6%9F%A5%E7%9C%8BPCIe%E7%9A%84%E9%85%8D%E7%BD%AE%E7%A9%BA%E9%97%B4/" class="post-title-link" itemprop="url">linux查看PCIe的配置空间</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-07-25 10:49:37 / Modified: 14:55:20" itemprop="dateCreated datePublished" datetime="2020-07-25T10:49:37+08:00">2020-07-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/" itemprop="url" rel="index"><span itemprop="name">Driver</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/PCIe/" itemprop="url" rel="index"><span itemprop="name">PCIe</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>操作系统完成PCI/PCIe的初始化后，建立了PCI总线树。在Linux中，用户空间如何访问PCI/PCIe的配置空间和查看PCIe设备信息呢？本节重点讲在应用层读取配置空间和显示PCI/PCIe设备信息。</p>
<h2 id="查看配置空间信息"><a href="#查看配置空间信息" class="headerlink" title="查看配置空间信息"></a>查看配置空间信息</h2><p>读取PCIe设备配置空间的命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci</span><br></pre></td></tr></table></figure>

<p>lspci 是一个用来显示系统中所有PCI总线设备或连接到该总线上的所有设备的工具。</p>
<p>常用的几个参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-v</span><br><span class="line">使得 lspci 以冗余模式显示所有设备的详细信息。</span><br><span class="line">-vv</span><br><span class="line">使得 lspci 以过冗余模式显示更详细的信息 (事实上是 PCI 设备能给出的所有东西)。这些数据的确切意义没有在此手册页中解释，如果你想知道更多，请参照 &#x2F;usr&#x2F;include&#x2F;linux&#x2F;pci.h 或者 PCI 规范。</span><br><span class="line">-vvv 显示设备所有可解析的信息</span><br><span class="line">-n</span><br><span class="line">以数字形式显示 PCI 生产厂商和设备号，而不是在 PCI ID 数据库中查找它们。</span><br><span class="line">-x</span><br><span class="line">以十六进制显示 配置空间 (configuration space) 的前64个字节映像 (标准头部信息)。此参数对调试驱动和 lspci 本身很有用。</span><br><span class="line">-xxx</span><br><span class="line">以十六进制显示所有配置空间的256Byte映像。此选项只有 root 可用，并且很多 PCI 设备在你试图读取配置空间的未定义部分时会崩溃 (此操作可能不违反PCI标准，但是它至少非常愚蠢)。</span><br><span class="line">-xxxx 以16进制显示整个PCIe配置空间（4096字节）。</span><br><span class="line">-t</span><br><span class="line">以树形方式显示包含所有总线、桥、设备和它们的连接的图表。</span><br><span class="line">-s [[]:][][.[]]</span><br><span class="line">仅显示指定总线、插槽上的设备或设备上的功能块信息。设备地址的任何部分都可以忽略，或以「*」代替 (意味著所有值)。所有数字都是十六进制。例如：「0：」指的是在0号总线上的所有设备；「0」指的是在任意总线上0号设备的所有功能块；「0.3」选择 了所有总线上0号设备的第三个功能块；「.4」则是只列出每一设备上的第四个功能块。</span><br><span class="line">-d []:[]</span><br><span class="line">只显示指定生产厂商和设备 ID 的设备。 这两个 ID 都以十六进制表示，可以忽略或者以「*」代替 (意味著所有值)。</span><br></pre></td></tr></table></figure>

<p>操作示例</p>
<p>示例1：只是简单显示目前所有的硬件设备</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">~# lspci </span><br><span class="line">00:00.0 Host bridge: Intel Corporation Xeon E3-1200 v6&#x2F;7th Gen Core Processor Host Bridge&#x2F;DRAM Registers (rev 05)</span><br><span class="line">00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v5&#x2F;E3-1500 v5&#x2F;6th Gen Core Processor PCIe Controller (x16) (rev 05)</span><br><span class="line">00:08.0 System peripheral: Intel Corporation Xeon E3-1200 v5&#x2F;v6 &#x2F; E3-1500 v5 &#x2F; 6th&#x2F;7th Gen Core Processor Gaussian Mixture Model</span><br><span class="line">00:14.0 USB controller: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family USB 3.0 xHCI Controller (rev 31)</span><br><span class="line">00:14.2 Signal processing controller: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family Thermal Subsystem (rev 31)</span><br><span class="line">00:15.0 Signal processing controller: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family Serial IO I2C Controller #0 (rev 31)</span><br><span class="line">00:15.1 Signal processing controller: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family Serial IO I2C Controller #1 (rev 31)</span><br><span class="line">00:16.0 Communication controller: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family MEI Controller #1 (rev 31)</span><br><span class="line">00:16.3 Serial controller: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family KT Redirection (rev 31)</span><br><span class="line">00:17.0 SATA controller: Intel Corporation Q170&#x2F;Q150&#x2F;B150&#x2F;H170&#x2F;H110&#x2F;Z170&#x2F;CM236 Chipset SATA Controller [AHCI Mode] (rev 31)</span><br><span class="line">00:1c.0 PCI bridge: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family PCI Express Root Port #6 (rev f1)</span><br><span class="line">00:1d.0 PCI bridge: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family PCI Express Root Port #9 (rev f1)</span><br><span class="line">00:1f.0 ISA bridge: Intel Corporation Q170 Chipset LPC&#x2F;eSPI Controller (rev 31)</span><br><span class="line">00:1f.2 Memory controller: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family Power Management Controller (rev 31)</span><br><span class="line">00:1f.3 Audio device: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family HD Audio Controller (rev 31)</span><br><span class="line">00:1f.4 SMBus: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family SMBus (rev 31)</span><br><span class="line">00:1f.6 Ethernet controller: Intel Corporation Ethernet Connection (2) I219-LM (rev 31)</span><br><span class="line">01:00.0 VGA compatible controller: NVIDIA Corporation GP107 [GeForce GTX 1050 Ti] (rev a1)</span><br><span class="line">01:00.1 Audio device: NVIDIA Corporation GP107GL High Definition Audio Controller (rev a1)</span><br><span class="line">02:00.0 Ethernet controller: Intel Corporation I211 Gigabit Network Connection (rev 03)</span><br><span class="line">03:00.0 Memory controller: Xilinx Corporation Device 8034</span><br></pre></td></tr></table></figure>

<p>示例2：显示所有设备详细的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br></pre></td><td class="code"><pre><span class="line">~# lspci -v</span><br><span class="line">00:00.0 Host bridge: Intel Corporation Xeon E3-1200 v6&#x2F;7th Gen Core Processor Host Bridge&#x2F;DRAM Registers (rev 05)</span><br><span class="line">	Subsystem: Intel Corporation Xeon E3-1200 v6&#x2F;7th Gen Core Processor Host Bridge&#x2F;DRAM Registers</span><br><span class="line">	Flags: bus master, fast devsel, latency 0</span><br><span class="line">	Capabilities: [e0] Vendor Specific Information: Len&#x3D;10 &lt;?&gt;</span><br><span class="line"></span><br><span class="line">00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v5&#x2F;E3-1500 v5&#x2F;6th Gen Core Processor PCIe Controller (x16) (rev 05) (prog-if 00 [Normal decode])</span><br><span class="line">	Flags: bus master, fast devsel, latency 0, IRQ 121</span><br><span class="line">	Bus: primary&#x3D;00, secondary&#x3D;01, subordinate&#x3D;01, sec-latency&#x3D;0</span><br><span class="line">	I&#x2F;O behind bridge: 0000e000-0000efff</span><br><span class="line">	Memory behind bridge: de000000-df0fffff</span><br><span class="line">	Prefetchable memory behind bridge: 00000000c0000000-00000000d1ffffff</span><br><span class="line">	Capabilities: [88] Subsystem: Intel Corporation Skylake PCIe Controller (x16)</span><br><span class="line">	Capabilities: [80] Power Management version 3</span><br><span class="line">	Capabilities: [90] MSI: Enable+ Count&#x3D;1&#x2F;1 Maskable- 64bit-</span><br><span class="line">	Capabilities: [a0] Express Root Port (Slot+), MSI 00</span><br><span class="line">	Capabilities: [100] Virtual Channel</span><br><span class="line">	Capabilities: [140] Root Complex Link</span><br><span class="line">	Capabilities: [d94] #19</span><br><span class="line">	Kernel driver in use: pcieport</span><br><span class="line">	Kernel modules: shpchp</span><br><span class="line"></span><br><span class="line">00:08.0 System peripheral: Intel Corporation Xeon E3-1200 v5&#x2F;v6 &#x2F; E3-1500 v5 &#x2F; 6th&#x2F;7th Gen Core Processor Gaussian Mixture Model</span><br><span class="line">	Subsystem: Intel Corporation Skylake Gaussian Mixture Model</span><br><span class="line">	Flags: fast devsel, IRQ 11</span><br><span class="line">	Memory at df252000 (64-bit, non-prefetchable) [disabled] [size&#x3D;4K]</span><br><span class="line">	Capabilities: [90] MSI: Enable- Count&#x3D;1&#x2F;1 Maskable- 64bit-</span><br><span class="line">	Capabilities: [dc] Power Management version 2</span><br><span class="line">	Capabilities: [f0] PCI Advanced Features</span><br><span class="line"></span><br><span class="line">00:14.0 USB controller: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family USB 3.0 xHCI Controller (rev 31) (prog-if 30 [XHCI])</span><br><span class="line">	Subsystem: Intel Corporation Sunrise Point-H USB 3.0 xHCI Controller</span><br><span class="line">	Flags: bus master, medium devsel, latency 0, IRQ 124</span><br><span class="line">	Memory at df230000 (64-bit, non-prefetchable) [size&#x3D;64K]</span><br><span class="line">	Capabilities: [70] Power Management version 2</span><br><span class="line">	Capabilities: [80] MSI: Enable+ Count&#x3D;1&#x2F;8 Maskable- 64bit+</span><br><span class="line">	Kernel driver in use: xhci_hcd</span><br><span class="line"></span><br><span class="line">00:14.2 Signal processing controller: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family Thermal Subsystem (rev 31)</span><br><span class="line">	Subsystem: Intel Corporation Sunrise Point-H Thermal subsystem</span><br><span class="line">	Flags: fast devsel, IRQ 18</span><br><span class="line">	Memory at df251000 (64-bit, non-prefetchable) [size&#x3D;4K]</span><br><span class="line">	Capabilities: [50] Power Management version 3</span><br><span class="line">	Capabilities: [80] MSI: Enable- Count&#x3D;1&#x2F;1 Maskable- 64bit-</span><br><span class="line">	Kernel driver in use: intel_pch_thermal</span><br><span class="line">	Kernel modules: intel_pch_thermal</span><br><span class="line"></span><br><span class="line">00:15.0 Signal processing controller: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family Serial IO I2C Controller #0 (rev 31)</span><br><span class="line">	Subsystem: Intel Corporation Sunrise Point-H Serial IO I2C Controller</span><br><span class="line">	Flags: bus master, fast devsel, latency 0, IRQ 16</span><br><span class="line">	Memory at df250000 (64-bit, non-prefetchable) [size&#x3D;4K]</span><br><span class="line">	Capabilities: [80] Power Management version 3</span><br><span class="line">	Capabilities: [90] Vendor Specific Information: Len&#x3D;14 &lt;?&gt;</span><br><span class="line">	Kernel driver in use: intel-lpss</span><br><span class="line">	Kernel modules: intel_lpss_pci</span><br><span class="line"></span><br><span class="line">00:15.1 Signal processing controller: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family Serial IO I2C Controller #1 (rev 31)</span><br><span class="line">	Subsystem: Intel Corporation Sunrise Point-H Serial IO I2C Controller</span><br><span class="line">	Flags: bus master, fast devsel, latency 0, IRQ 17</span><br><span class="line">	Memory at df24f000 (64-bit, non-prefetchable) [size&#x3D;4K]</span><br><span class="line">	Capabilities: [80] Power Management version 3</span><br><span class="line">	Capabilities: [90] Vendor Specific Information: Len&#x3D;14 &lt;?&gt;</span><br><span class="line">	Kernel driver in use: intel-lpss</span><br><span class="line">	Kernel modules: intel_lpss_pci</span><br><span class="line"></span><br><span class="line">00:16.0 Communication controller: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family MEI Controller #1 (rev 31)</span><br><span class="line">	Subsystem: Intel Corporation Sunrise Point-H CSME HECI</span><br><span class="line">	Flags: bus master, fast devsel, latency 0, IRQ 324</span><br><span class="line">	Memory at df24e000 (64-bit, non-prefetchable) [size&#x3D;4K]</span><br><span class="line">	Capabilities: [50] Power Management version 3</span><br><span class="line">	Capabilities: [8c] MSI: Enable+ Count&#x3D;1&#x2F;1 Maskable- 64bit+</span><br><span class="line">	Kernel driver in use: mei_me</span><br><span class="line">	Kernel modules: mei_me</span><br><span class="line"></span><br><span class="line">00:16.3 Serial controller: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family KT Redirection (rev 31) (prog-if 02 [16550])</span><br><span class="line">	Subsystem: Intel Corporation Sunrise Point-H KT Redirection</span><br><span class="line">	Flags: 66MHz, fast devsel, IRQ 19</span><br><span class="line">	I&#x2F;O ports at f060 [size&#x3D;8]</span><br><span class="line">	Memory at df24d000 (32-bit, non-prefetchable) [size&#x3D;4K]</span><br><span class="line">	Capabilities: [40] MSI: Enable- Count&#x3D;1&#x2F;1 Maskable- 64bit+</span><br><span class="line">	Capabilities: [50] Power Management version 3</span><br><span class="line">	Kernel driver in use: serial</span><br><span class="line"></span><br><span class="line">00:17.0 SATA controller: Intel Corporation Q170&#x2F;Q150&#x2F;B150&#x2F;H170&#x2F;H110&#x2F;Z170&#x2F;CM236 Chipset SATA Controller [AHCI Mode] (rev 31) (prog-if 01 [AHCI 1.0])</span><br><span class="line">	Subsystem: Intel Corporation Sunrise Point-H SATA controller [AHCI mode]</span><br><span class="line">	Flags: bus master, 66MHz, medium devsel, latency 0, IRQ 317</span><br><span class="line">	Memory at df248000 (32-bit, non-prefetchable) [size&#x3D;8K]</span><br><span class="line">	Memory at df24c000 (32-bit, non-prefetchable) [size&#x3D;256]</span><br><span class="line">	I&#x2F;O ports at f050 [size&#x3D;8]</span><br><span class="line">	I&#x2F;O ports at f040 [size&#x3D;4]</span><br><span class="line">	I&#x2F;O ports at f020 [size&#x3D;32]</span><br><span class="line">	Memory at df24b000 (32-bit, non-prefetchable) [size&#x3D;2K]</span><br><span class="line">	Capabilities: [80] MSI: Enable+ Count&#x3D;1&#x2F;1 Maskable- 64bit-</span><br><span class="line">	Capabilities: [70] Power Management version 3</span><br><span class="line">	Capabilities: [a8] SATA HBA v1.0</span><br><span class="line">	Kernel driver in use: ahci</span><br><span class="line">	Kernel modules: ahci</span><br><span class="line"></span><br><span class="line">00:1c.0 PCI bridge: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family PCI Express Root Port #6 (rev f1) (prog-if 00 [Normal decode])</span><br><span class="line">	Flags: bus master, fast devsel, latency 0, IRQ 122</span><br><span class="line">	Bus: primary&#x3D;00, secondary&#x3D;02, subordinate&#x3D;02, sec-latency&#x3D;0</span><br><span class="line">	I&#x2F;O behind bridge: 0000d000-0000dfff</span><br><span class="line">	Memory behind bridge: df100000-df1fffff</span><br><span class="line">	Capabilities: [40] Express Root Port (Slot+), MSI 00</span><br><span class="line">	Capabilities: [80] MSI: Enable+ Count&#x3D;1&#x2F;1 Maskable- 64bit-</span><br><span class="line">	Capabilities: [90] Subsystem: Intel Corporation Sunrise Point-H PCI Express Root Port</span><br><span class="line">	Capabilities: [a0] Power Management version 3</span><br><span class="line">	Capabilities: [100] Advanced Error Reporting</span><br><span class="line">	Capabilities: [140] Access Control Services</span><br><span class="line">	Capabilities: [200] L1 PM Substates</span><br><span class="line">	Capabilities: [220] #19</span><br><span class="line">	Kernel driver in use: pcieport</span><br><span class="line">	Kernel modules: shpchp</span><br><span class="line"></span><br><span class="line">00:1d.0 PCI bridge: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family PCI Express Root Port #9 (rev f1) (prog-if 00 [Normal decode])</span><br><span class="line">	Flags: bus master, fast devsel, latency 0, IRQ 123</span><br><span class="line">	Bus: primary&#x3D;00, secondary&#x3D;03, subordinate&#x3D;03, sec-latency&#x3D;0</span><br><span class="line">	Memory behind bridge: dc000000-ddffffff</span><br><span class="line">	Capabilities: [40] Express Root Port (Slot+), MSI 00</span><br><span class="line">	Capabilities: [80] MSI: Enable+ Count&#x3D;1&#x2F;1 Maskable- 64bit-</span><br><span class="line">	Capabilities: [90] Subsystem: Intel Corporation Sunrise Point-H PCI Express Root Port</span><br><span class="line">	Capabilities: [a0] Power Management version 3</span><br><span class="line">	Capabilities: [100] Advanced Error Reporting</span><br><span class="line">	Capabilities: [140] Access Control Services</span><br><span class="line">	Capabilities: [200] L1 PM Substates</span><br><span class="line">	Capabilities: [220] #19</span><br><span class="line">	Kernel driver in use: pcieport</span><br><span class="line">	Kernel modules: shpchp</span><br><span class="line"></span><br><span class="line">00:1f.0 ISA bridge: Intel Corporation Q170 Chipset LPC&#x2F;eSPI Controller (rev 31)</span><br><span class="line">	Subsystem: Intel Corporation Sunrise Point-H LPC Controller</span><br><span class="line">	Flags: bus master, medium devsel, latency 0</span><br><span class="line"></span><br><span class="line">00:1f.2 Memory controller: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family Power Management Controller (rev 31)</span><br><span class="line">	Subsystem: Intel Corporation Sunrise Point-H PMC</span><br><span class="line">	Flags: bus master, fast devsel, latency 0</span><br><span class="line">	Memory at df244000 (32-bit, non-prefetchable) [size&#x3D;16K]</span><br><span class="line"></span><br><span class="line">00:1f.3 Audio device: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family HD Audio Controller (rev 31)</span><br><span class="line">	Subsystem: Advantech Co. Ltd Sunrise Point-H HD Audio</span><br><span class="line">	Flags: bus master, fast devsel, latency 32, IRQ 325</span><br><span class="line">	Memory at df240000 (64-bit, non-prefetchable) [size&#x3D;16K]</span><br><span class="line">	Memory at df220000 (64-bit, non-prefetchable) [size&#x3D;64K]</span><br><span class="line">	Capabilities: [50] Power Management version 3</span><br><span class="line">	Capabilities: [60] MSI: Enable+ Count&#x3D;1&#x2F;1 Maskable- 64bit+</span><br><span class="line">	Kernel driver in use: snd_hda_intel</span><br><span class="line">	Kernel modules: snd_hda_intel</span><br><span class="line"></span><br><span class="line">00:1f.4 SMBus: Intel Corporation 100 Series&#x2F;C230 Series Chipset Family SMBus (rev 31)</span><br><span class="line">	Subsystem: Intel Corporation Sunrise Point-H SMBus</span><br><span class="line">	Flags: medium devsel, IRQ 11</span><br><span class="line">	Memory at df24a000 (64-bit, non-prefetchable) [size&#x3D;256]</span><br><span class="line">	I&#x2F;O ports at f000 [size&#x3D;32]</span><br><span class="line">	Kernel modules: i2c_i801</span><br><span class="line"></span><br><span class="line">00:1f.6 Ethernet controller: Intel Corporation Ethernet Connection (2) I219-LM (rev 31)</span><br><span class="line">	Subsystem: Intel Corporation Ethernet Connection (2) I219-LM</span><br><span class="line">	Flags: bus master, fast devsel, latency 0, IRQ 318</span><br><span class="line">	Memory at df200000 (32-bit, non-prefetchable) [size&#x3D;128K]</span><br><span class="line">	Capabilities: [c8] Power Management version 3</span><br><span class="line">	Capabilities: [d0] MSI: Enable+ Count&#x3D;1&#x2F;1 Maskable- 64bit+</span><br><span class="line">	Capabilities: [e0] PCI Advanced Features</span><br><span class="line">	Kernel driver in use: e1000e</span><br><span class="line">	Kernel modules: e1000e</span><br><span class="line"></span><br><span class="line">01:00.0 VGA compatible controller: NVIDIA Corporation GP107 [GeForce GTX 1050 Ti] (rev a1) (prog-if 00 [VGA controller])</span><br><span class="line">	Subsystem: NVIDIA Corporation Device 11bf</span><br><span class="line">	Flags: bus master, fast devsel, latency 0, IRQ 326</span><br><span class="line">	Memory at de000000 (32-bit, non-prefetchable) [size&#x3D;16M]</span><br><span class="line">	Memory at c0000000 (64-bit, prefetchable) [size&#x3D;256M]</span><br><span class="line">	Memory at d0000000 (64-bit, prefetchable) [size&#x3D;32M]</span><br><span class="line">	I&#x2F;O ports at e000 [size&#x3D;128]</span><br><span class="line">	[virtual] Expansion ROM at 000c0000 [disabled] [size&#x3D;128K]</span><br><span class="line">	Capabilities: [60] Power Management version 3</span><br><span class="line">	Capabilities: [68] MSI: Enable+ Count&#x3D;1&#x2F;1 Maskable- 64bit+</span><br><span class="line">	Capabilities: [78] Express Legacy Endpoint, MSI 00</span><br><span class="line">	Capabilities: [100] Virtual Channel</span><br><span class="line">	Capabilities: [250] Latency Tolerance Reporting</span><br><span class="line">	Capabilities: [128] Power Budgeting &lt;?&gt;</span><br><span class="line">	Capabilities: [420] Advanced Error Reporting</span><br><span class="line">	Capabilities: [600] Vendor Specific Information: ID&#x3D;0001 Rev&#x3D;1 Len&#x3D;024 &lt;?&gt;</span><br><span class="line">	Capabilities: [900] #19</span><br><span class="line">	Kernel driver in use: nvidia</span><br><span class="line">	Kernel modules: nvidiafb, nouveau, nvidia_drm, nvidia</span><br><span class="line"></span><br><span class="line">01:00.1 Audio device: NVIDIA Corporation GP107GL High Definition Audio Controller (rev a1)</span><br><span class="line">	Subsystem: NVIDIA Corporation Device 11bf</span><br><span class="line">	Flags: bus master, fast devsel, latency 0, IRQ 17</span><br><span class="line">	Memory at df080000 (32-bit, non-prefetchable) [size&#x3D;16K]</span><br><span class="line">	Capabilities: [60] Power Management version 3</span><br><span class="line">	Capabilities: [68] MSI: Enable- Count&#x3D;1&#x2F;1 Maskable- 64bit+</span><br><span class="line">	Capabilities: [78] Express Endpoint, MSI 00</span><br><span class="line">	Capabilities: [100] Advanced Error Reporting</span><br><span class="line">	Kernel driver in use: snd_hda_intel</span><br><span class="line">	Kernel modules: snd_hda_intel</span><br><span class="line"></span><br><span class="line">02:00.0 Ethernet controller: Intel Corporation I211 Gigabit Network Connection (rev 03)</span><br><span class="line">	Subsystem: Intel Corporation I211 Gigabit Network Connection</span><br><span class="line">	Flags: bus master, fast devsel, latency 0, IRQ 17</span><br><span class="line">	Memory at df100000 (32-bit, non-prefetchable) [size&#x3D;128K]</span><br><span class="line">	I&#x2F;O ports at d000 [size&#x3D;32]</span><br><span class="line">	Memory at df120000 (32-bit, non-prefetchable) [size&#x3D;16K]</span><br><span class="line">	Capabilities: [40] Power Management version 3</span><br><span class="line">	Capabilities: [50] MSI: Enable- Count&#x3D;1&#x2F;1 Maskable+ 64bit+</span><br><span class="line">	Capabilities: [70] MSI-X: Enable+ Count&#x3D;5 Masked-</span><br><span class="line">	Capabilities: [a0] Express Endpoint, MSI 00</span><br><span class="line">	Capabilities: [100] Advanced Error Reporting</span><br><span class="line">	Capabilities: [140] Device Serial Number c4-00-ad-ff-ff-3a-e7-2d</span><br><span class="line">	Capabilities: [1a0] Transaction Processing Hints</span><br><span class="line">	Kernel driver in use: igb</span><br><span class="line">	Kernel modules: igb</span><br><span class="line"></span><br><span class="line">03:00.0 Memory controller: Xilinx Corporation Device 8034</span><br><span class="line">	Subsystem: Xilinx Corporation Device 0007</span><br><span class="line">	Flags: fast devsel, IRQ 11</span><br><span class="line">	Memory at dc000000 (32-bit, non-prefetchable) [disabled] [size&#x3D;32M]</span><br><span class="line">	Capabilities: [80] Power Management version 3</span><br><span class="line">	Capabilities: [90] MSI: Enable- Count&#x3D;1&#x2F;4 Maskable- 64bit+</span><br><span class="line">	Capabilities: [c0] Express Endpoint, MSI 00</span><br><span class="line">	Capabilities: [100] Advanced Error Reporting</span><br><span class="line">	Capabilities: [300] #19</span><br></pre></td></tr></table></figure>

<p>示例3：显示具体设备更详细的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">~# lspci -vv -s 03:00.0</span><br><span class="line">03:00.0 Memory controller: Xilinx Corporation Device 8034</span><br><span class="line">	Subsystem: Xilinx Corporation Device 0007</span><br><span class="line">	Control: I&#x2F;O- Mem- BusMaster- SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx-</span><br><span class="line">	Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL&#x3D;fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx-</span><br><span class="line">	Interrupt: pin A routed to IRQ 11</span><br><span class="line">	Region 0: Memory at dc000000 (32-bit, non-prefetchable) [disabled] [size&#x3D;32M]</span><br><span class="line">	Capabilities: [80] Power Management version 3</span><br><span class="line">		Flags: PMEClk- DSI- D1- D2- AuxCurrent&#x3D;0mA PME(D0-,D1-,D2-,D3hot-,D3cold-)</span><br><span class="line">		Status: D0 NoSoftRst+ PME-Enable- DSel&#x3D;0 DScale&#x3D;0 PME-</span><br><span class="line">	Capabilities: [90] MSI: Enable- Count&#x3D;1&#x2F;4 Maskable- 64bit+</span><br><span class="line">		Address: 0000000000000000  Data: 0000</span><br><span class="line">	Capabilities: [c0] Express (v2) Endpoint, MSI 00</span><br><span class="line">		DevCap:	MaxPayload 512 bytes, PhantFunc 0, Latency L0s &lt;64ns, L1 &lt;1us</span><br><span class="line">			ExtTag- AttnBtn- AttnInd- PwrInd- RBE+ FLReset-</span><br><span class="line">		DevCtl:	Report errors: Correctable- Non-Fatal- Fatal- Unsupported-</span><br><span class="line">			RlxdOrd+ ExtTag- PhantFunc- AuxPwr- NoSnoop+</span><br><span class="line">			MaxPayload 256 bytes, MaxReadReq 512 bytes</span><br><span class="line">		DevSta:	CorrErr- UncorrErr- FatalErr- UnsuppReq- AuxPwr- TransPend-</span><br><span class="line">		LnkCap:	Port #0, Speed 8GT&#x2F;s, Width x4, ASPM not supported, Exit Latency L0s unlimited, L1 unlimited</span><br><span class="line">			ClockPM- Surprise- LLActRep- BwNot- ASPMOptComp+</span><br><span class="line">		LnkCtl:	ASPM Disabled; RCB 64 bytes Disabled- CommClk+</span><br><span class="line">			ExtSynch- ClockPM- AutWidDis- BWInt- AutBWInt-</span><br><span class="line">		LnkSta:	Speed 8GT&#x2F;s, Width x4, TrErr- Train- SlotClk+ DLActive- BWMgmt- ABWMgmt-</span><br><span class="line">		DevCap2: Completion Timeout: Range B, TimeoutDis+, LTR-, OBFF Not Supported</span><br><span class="line">		DevCtl2: Completion Timeout: 50us to 50ms, TimeoutDis-, LTR-, OBFF Disabled</span><br><span class="line">		LnkCtl2: Target Link Speed: 8GT&#x2F;s, EnterCompliance- SpeedDis-</span><br><span class="line">			 Transmit Margin: Normal Operating Range, EnterModifiedCompliance- ComplianceSOS-</span><br><span class="line">			 Compliance De-emphasis: -6dB</span><br><span class="line">		LnkSta2: Current De-emphasis Level: -3.5dB, EqualizationComplete+, EqualizationPhase1+</span><br><span class="line">			 EqualizationPhase2+, EqualizationPhase3+, LinkEqualizationRequest-</span><br><span class="line">	Capabilities: [100 v2] Advanced Error Reporting</span><br><span class="line">		UESta:	DLP- SDES- TLP- FCP- CmpltTO- CmpltAbrt- UnxCmplt- RxOF- MalfTLP- ECRC- UnsupReq- ACSViol-</span><br><span class="line">		UEMsk:	DLP- SDES- TLP- FCP- CmpltTO- CmpltAbrt- UnxCmplt- RxOF- MalfTLP- ECRC- UnsupReq- ACSViol-</span><br><span class="line">		UESvrt:	DLP+ SDES+ TLP- FCP+ CmpltTO- CmpltAbrt- UnxCmplt- RxOF+ MalfTLP+ ECRC- UnsupReq- ACSViol-</span><br><span class="line">		CESta:	RxErr- BadTLP- BadDLLP- Rollover- Timeout- NonFatalErr-</span><br><span class="line">		CEMsk:	RxErr- BadTLP- BadDLLP- Rollover- Timeout- NonFatalErr+</span><br><span class="line">		AERCap:	First Error Pointer: 00, GenCap- CGenEn- ChkCap- ChkEn-</span><br><span class="line">	Capabilities: [300 v1] #19</span><br></pre></td></tr></table></figure>

<p>示例4：显示具体设备的256byte配置空间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~# lspci -xxx -s 03:00.0</span><br><span class="line">03:00.0 Memory controller: Xilinx Corporation Device 8034</span><br><span class="line">00: ee 10 34 80 00 00 10 00 00 00 80 05 10 00 00 00</span><br><span class="line">10: 00 00 00 dc 00 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">20: 00 00 00 00 00 00 00 00 00 00 00 00 ee 10 07 00</span><br><span class="line">30: 00 00 00 00 80 00 00 00 00 00 00 00 0b 01 00 00</span><br><span class="line">40: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">50: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">60: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">70: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">80: 01 90 03 00 08 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">90: 05 c0 84 00 00 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">b0: 11 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">c0: 10 00 02 00 02 80 e8 07 30 28 00 00 43 f0 43 00</span><br><span class="line">d0: 40 00 43 10 00 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">e0: 00 00 00 00 12 00 00 00 00 00 00 00 0e 00 00 00</span><br><span class="line">f0: 03 00 1f 00 00 00 00 00 00 00 00 00 00 00 00 00</span><br></pre></td></tr></table></figure>

<p>示例5：显示总线树</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@ivus:~# lspci -tv</span><br><span class="line">-[0000:00]-+-00.0  Intel Corporation Xeon E3-1200 v6&#x2F;7th Gen Core Processor Host Bridge&#x2F;DRAM Registers</span><br><span class="line">           +-01.0-[01]--+-00.0  NVIDIA Corporation GP107 [GeForce GTX 1050 Ti]</span><br><span class="line">           |            \-00.1  NVIDIA Corporation GP107GL High Definition Audio Controller</span><br><span class="line">           +-08.0  Intel Corporation Xeon E3-1200 v5&#x2F;v6 &#x2F; E3-1500 v5 &#x2F; 6th&#x2F;7th Gen Core Processor Gaussian Mixture Model</span><br><span class="line">           +-14.0  Intel Corporation 100 Series&#x2F;C230 Series Chipset Family USB 3.0 xHCI Controller</span><br><span class="line">           +-14.2  Intel Corporation 100 Series&#x2F;C230 Series Chipset Family Thermal Subsystem</span><br><span class="line">           +-15.0  Intel Corporation 100 Series&#x2F;C230 Series Chipset Family Serial IO I2C Controller #0</span><br><span class="line">           +-15.1  Intel Corporation 100 Series&#x2F;C230 Series Chipset Family Serial IO I2C Controller #1</span><br><span class="line">           +-16.0  Intel Corporation 100 Series&#x2F;C230 Series Chipset Family MEI Controller #1</span><br><span class="line">           +-16.3  Intel Corporation 100 Series&#x2F;C230 Series Chipset Family KT Redirection</span><br><span class="line">           +-17.0  Intel Corporation Q170&#x2F;Q150&#x2F;B150&#x2F;H170&#x2F;H110&#x2F;Z170&#x2F;CM236 Chipset SATA Controller [AHCI Mode]</span><br><span class="line">           +-1c.0-[02]----00.0  Intel Corporation I211 Gigabit Network Connection</span><br><span class="line">           +-1d.0-[03]----00.0  Xilinx Corporation Device 8034</span><br><span class="line">           +-1f.0  Intel Corporation Q170 Chipset LPC&#x2F;eSPI Controller</span><br><span class="line">           +-1f.2  Intel Corporation 100 Series&#x2F;C230 Series Chipset Family Power Management Controller</span><br><span class="line">           +-1f.3  Intel Corporation 100 Series&#x2F;C230 Series Chipset Family HD Audio Controller</span><br><span class="line">           +-1f.4  Intel Corporation 100 Series&#x2F;C230 Series Chipset Family SMBus</span><br><span class="line">           \-1f.6  Intel Corporation Ethernet Connection (2) I219-LM</span><br></pre></td></tr></table></figure>

<p>示例6：查看厂家和设备号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">~# lspci -n</span><br><span class="line">00:00.0 0600: 8086:591f (rev 05)</span><br><span class="line">00:01.0 0604: 8086:1901 (rev 05)</span><br><span class="line">00:08.0 0880: 8086:1911</span><br><span class="line">00:14.0 0c03: 8086:a12f (rev 31)</span><br><span class="line">00:14.2 1180: 8086:a131 (rev 31)</span><br><span class="line">00:15.0 1180: 8086:a160 (rev 31)</span><br><span class="line">00:15.1 1180: 8086:a161 (rev 31)</span><br><span class="line">00:16.0 0780: 8086:a13a (rev 31)</span><br><span class="line">00:16.3 0700: 8086:a13d (rev 31)</span><br><span class="line">00:17.0 0106: 8086:a102 (rev 31)</span><br><span class="line">00:1c.0 0604: 8086:a115 (rev f1)</span><br><span class="line">00:1d.0 0604: 8086:a118 (rev f1)</span><br><span class="line">00:1f.0 0601: 8086:a146 (rev 31)</span><br><span class="line">00:1f.2 0580: 8086:a121 (rev 31)</span><br><span class="line">00:1f.3 0403: 8086:a170 (rev 31)</span><br><span class="line">00:1f.4 0c05: 8086:a123 (rev 31)</span><br><span class="line">00:1f.6 0200: 8086:15b7 (rev 31)</span><br><span class="line">01:00.0 0300: 10de:1c82 (rev a1)</span><br><span class="line">01:00.1 0403: 10de:0fb9 (rev a1)</span><br><span class="line">02:00.0 0200: 8086:1539 (rev 03)</span><br><span class="line">03:00.0 0580: 10ee:8034</span><br></pre></td></tr></table></figure>

<p>解释最后一条信息的含义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">03:00.0 0580: 10ee:8034</span><br></pre></td></tr></table></figure>

<p>03:00.0代表什么意思？</p>
<p>就是 bus number = 03 ,device number = 00 function = 0 </p>
<p>0580就是Class code</p>
<p>10ee就是厂家ID</p>
<p>8034就是设备ID</p>
<h2 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h2><h3 id="修改配置空间"><a href="#修改配置空间" class="headerlink" title="修改配置空间"></a>修改配置空间</h3><p>在应用层修改配置空间的命令为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setpci</span><br></pre></td></tr></table></figure>

<h3 id="扫描PCI设备"><a href="#扫描PCI设备" class="headerlink" title="扫描PCI设备"></a>扫描PCI设备</h3><p>探测PCI/PCIe设备的命令为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scanpci</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<p><a href="http://ilinuxkernel.com/?p=166" target="_blank" rel="noopener">Linux PCI/PCI-E设备配置空间读取与修改</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/22/Linux/Driver/PCIe/PCIe%E6%80%BB%E7%BA%BF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="David Meng">
      <meta itemprop="description" content="冒险，创新，永不放弃">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tech Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/22/Linux/Driver/PCIe/PCIe%E6%80%BB%E7%BA%BF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="post-title-link" itemprop="url">PCIe总线基础知识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-07-22 14:42:00" itemprop="dateCreated datePublished" datetime="2020-07-22T14:42:00+08:00">2020-07-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-07-25 14:21:21" itemprop="dateModified" datetime="2020-07-25T14:21:21+08:00">2020-07-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/" itemprop="url" rel="index"><span itemprop="name">Driver</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/Driver/PCIe/" itemprop="url" rel="index"><span itemprop="name">PCIe</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>[TOC]</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>PCIe,全称是PCI-Express（peripheral component interconnect express），这是一种高速串行计算机扩展总线标准。PCI总线使用并行总线结构，在同一条总线上的所有外部设备共享总线带宽，而PCIe总线使用高速串行差分总线，并采用端到端的连接方式，因此，在每一条PCIe链路中只能连接两个设备。两个设备之间的PCIe链路如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200722_001.png" alt=""></p>
<p>如果一条链路不够快，可以扩展多几个链路，犹如高速公路一样，车道越多，越少出现拥挤现象，开得越快。</p>
<p><img src="http://jiali.clouddn.com/20200722_002.png" alt=""></p>
<p>常见的PCIe插槽如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200724_007.png" alt=""></p>
<p>还有一些常见的PCIe设备如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200724_008.png" alt=""></p>
<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="硬件接口"><a href="#硬件接口" class="headerlink" title="硬件接口"></a>硬件接口</h3><p>PCIe链路使用端到端的数据传送，每一个端口都包含了发送端（TX）和接收端（RX），硬件接口如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200722_003.png" alt=""></p>
<p>从图可以看出，在PCIe总线物理链路的一条PCIe数据通路（Lane）中，发送端和接收端各自有一组差分信号D-和D+，共4根线。一条PCIe总线链路中可以由多个Lane组成。使用差分信号，抗干扰性更强，因此PCIe总线可以在很高频率下正常工作。</p>
<p>PCIe链路可以支持x1、x2、x4、x8、x12、x16和x32宽度的PCIe链路。频率和编码关系如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200722_004.png" alt=""></p>
<p>8/10b编码就是10bit中含有8bit有效数据，128/130b编码就是130bit含有128位有效数据。在PCIe总线中，使用GT(Gigatransfer)计算PCIe链路的峰值带宽。计算公式如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">总线频率*数据位宽*2</span><br></pre></td></tr></table></figure>

<h3 id="电气信号"><a href="#电气信号" class="headerlink" title="电气信号"></a>电气信号</h3><p>略。</p>
<h3 id="拓扑结构"><a href="#拓扑结构" class="headerlink" title="拓扑结构"></a>拓扑结构</h3><p>一个通用处理器的PCIe总线拓扑结构如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200723_002.png" alt=""></p>
<p>整个PCIe拓扑结构是一个树形结构，Root Complex（RC）是树的根。RC为CPU代言，与整个计算机系统其它部分通讯，比如CPU通过它访问内存，通过它访问PCIe系统中的设备。大多数PCIe总线结构中，都包含了RC 、Switch 、PCIe-to-PCI桥和Endpoint（PCIe设备）组件。</p>
<p>实际上，Root Complex,简称RC。RC设计比较复杂，一个虚拟的处理器系统的RC设计如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200723_003.png" alt=""></p>
<p><strong>RC组件</strong></p>
<p>在一个处理器系统PCIe总线中，都有一个RC控制器，主要完成地址转换，和物理信号转换。类似HOST主桥的角色。具体的RC设计，看具体的处理器系统。</p>
<p><strong>Switch</strong></p>
<p>因为一条PCIe链路使用端到端的连接方式，所以，只能连接一个设备。为了一条PCIe链路能挂载多个EP，因此，需要Switch器件进行扩展。一个标准的Switch具有一个上游端口和多个下游端口。Switch内部结构如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200723_004.png" alt=""></p>
<h2 id="PCIe总线分层结构"><a href="#PCIe总线分层结构" class="headerlink" title="PCIe总线分层结构"></a>PCIe总线分层结构</h2><p>PCIe总线采用串行硬件接口，并以数据包(Packet)格式进行数据传输。数据包需要通过事务层和数据链路层，最后达到物理层，发送出去。PCIe总线的分层如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200722_005.png" alt=""></p>
<p><strong>事务层</strong>的主要职责是创建（发送）或者解析（接收）TLP (Transaction Layer packet)，流量控制，QoS，事务排序等。</p>
<p><strong>数据链路层</strong>的主要职责是创建（发送）或者解析（接收）DLLP(Data Link Layer packet)，Ack/Nak协议（链路层检错和纠错），流控，电源管理等。</p>
<p><strong>物理层</strong>的主要职责是处理所有的Packet数据物理传输，发送端数据分发到各个Lane传输（stripe），接收端把各个Lane上的数据汇总起来（De-stripe），每个Lane上加扰（Scramble，目的是让0和1分布均匀，去除信道的电磁干扰EMI）去扰（De-scramble)，以及8/10或者128/130编码解码，等等。</p>
<p>每一层都会定义包头包尾的数据格式。如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200722_007.png" alt=""></p>
<p>CPU与设备端数据交互的过程如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200722_008.png" alt=""></p>
<h2 id="事务层的TLP协议"><a href="#事务层的TLP协议" class="headerlink" title="事务层的TLP协议"></a>事务层的TLP协议</h2><p>事务层将接收PCIe设备产生的数据请求，并封装成TLP协议。FPGA PCIe的开发工作，就是在PCIe核下封装TLP协议，其他层次基本看不到。因此，重点讲一下TLP协议。TLP的基本格式如下：</p>
<p><img src="http://jiali.clouddn.com/20200722_009.png" alt=""></p>
<p>TLP头是最重要的标志，TLP Head包含了当前TLP的总线事务类型、路由信息等一系列信息。Data Payload 表示有效数据，Data Payload 长度与Max_Payload_Size、Max_Read_Request_Size和RCB参数相关。</p>
<p><strong>TLP Head格式</strong></p>
<p>一个Header大小可以是3DW，也可以是4DW。以4DW的Header为例，TLP的Header长下面样子：</p>
<p><img src="http://jiali.clouddn.com/20200722_011.png" alt=""></p>
<p>红色区域为所有TLP Header公共部分，所有Header都有这些；其它则是跟具体的TLP相关。</p>
<p>注释：</p>
<p><strong>Fmt</strong>：Format, 表明该TLP是否带有数据，Header是3DW还是4DW；</p>
<p><strong>Type</strong>：TLP类型，上一节提到的，Memory Read, Memory Write, Configuration Read, Configuration Write, Message和Completion，等等；</p>
<p><strong>R：</strong> Reserved，为0；</p>
<p><strong>TC</strong>: Traffic Class，TLP也分三六九等，优先级高的先得到服务。这里是3比特，说明可以分为8个等级，0-7，TC默认是0，数字越大，优先级越高；</p>
<p><strong>Attr:</strong> Attrbiute, 属性，前后共三个bit，先不说；</p>
<p><strong>TH</strong>: TLP Processing Hints，先不说；</p>
<p><strong>TD</strong>: TLP Digest，之前说ECRC可选，如果这个这个bit置起来，说明该TLP包含ECRC，接收端应该做CRC校验；</p>
<p><strong>EP</strong>: Poisoned data, 有毒的数据，远离，哈哈；</p>
<p><strong>AT</strong>: Address Type，地址种类，先不说；</p>
<p><strong>Length</strong>： Payload数据长度，1~1024，单位DW（4byte），所以TLP最大数据长度是4KB; 该长度总是DW的整数倍，如果TLP的数据不是DW的整数倍（不是4Byte的整数倍），则需要用到两个域：Last DW BE 和 1st DW BE。</p>
<p><strong>存储器读写请求的TLP</strong></p>
<p>64位的处理器系统的存储器读写请求的TLP格式如下图</p>
<p><img src="http://jiali.clouddn.com/20200722_012.png" alt=""></p>
<p>32位的处理器系统的存储器读写请求的TLP格式如下图</p>
<p><img src="http://jiali.clouddn.com/20200722_013.png" alt=""></p>
<p>Requester ID字段包含了生成这个TLP报文的PCIe设备的总线号（Bus Number）、设备号（Device Number）和功能号（Function Number）。因此，Requester ID就是源地址，其格式如下：</p>
<p><img src="http://jiali.clouddn.com/20200722_014.png" alt=""></p>
<p>Address:目的地址。PCIe设备，进行DMA操作，往处理器的DDR读写数据时候，需要获取DDR的内存地址，来填充Address。</p>
<p><strong>注意：</strong></p>
<p>基于厂家FPGA 的PCIe开发，主要是做事务层开发工作，封装TLP，对TLP接收和发送进行处理。因此，熟悉事务层的存储器、I/O和配置读写请求TLP过程很重要。曾经，CPU写FPGA PCIe设备的BAR地址空间的某个寄存器，因为FPGA 不返回TLP，导致CPU卡住。</p>
<p><strong>Data Payload参数</strong> </p>
<p>Max_Payload_Size参数存放PCIe设备<strong>实际使用</strong>的TLP有效负载的最大值。<strong>该参数由PCIe链路两端的设备协商决定，是PCIe设备进行数据传送时，实际使用的参数</strong>。当PCIe设备发送数据报文时，设置Max_Payload_Size参数决定TLP的Data Payload 长度的最大值。</p>
<p>Max_Payload_Size_Supported参数表示一个PCIe设备中TLP有效负载的最大值，这是由PCIe设备的硬件逻辑决定，软件不能更改。</p>
<p>Max_Payload_Size和Max_Payload_Size_Supported分别在PCI Express Capability结构中的Device Capability和Device Control寄存器中定义。</p>
<p>Max_Payload_Size可以设置为128byte、256byte、512byte和1024byte.在FPGA实际应用中，需要配置Max_Payload_Size和<strong>TLP</strong>的Length字段。FPGA的Max_Payload_Size配置如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200722_010.png" alt=""></p>
<p><strong>注意：</strong></p>
<p>当PCIe设备接收TLP时，该TLP的最大有效负载不能超过Max_Payload_Size（就是Length字段不能超过Max_Payload_Size），如果Length字段超过Length字段，则接收TLP的PCIe设备认为TLP非法。因此一次TLP传输数据失败。曾经，FPGA进行DMA操作，往CPU系统的DDR写数据，因为一次性把很大的数据量填充到TLP中，所以导致，CPU收不到数据。</p>
<h2 id="PCIe设备的配置空间"><a href="#PCIe设备的配置空间" class="headerlink" title="PCIe设备的配置空间"></a>PCIe设备的配置空间</h2><p>0x00<del>0xff,这段地址空间共256byte，PCI\PCI-X\PCIe都包含了这256byte配置空间。大多数PCI设备仅支持0x00</del>0x3f，这64byte的配置空间。此外，0x40~0xff，这段配置空间，主要存放一些与MSI或者MSI-X中断管理和电源管理相关的Capability结构。大多数PCI设备不支持MSI\MSI-X中断，而PCIe设备必须支持MSI\MSI-X中断机制(<strong>大多是PCIe设备使用MSI中断</strong>)。</p>
<p>64byte的配置空间如下图：</p>
<p><img src="http://jiali.clouddn.com/20200721_004.png" alt=""></p>
<p>另外，PCIe设备支持0x100<del>0xfff这段扩展配置空间。因此PCIe设备的配置空间最大位4k。0x100</del>0xfff这段空间，存放PCIe设备所独有的一些Capability结构，PCI设备是不能使用这段空间（事实上，PCI设备仅支持0x00~0x3f这段配置空间）。</p>
<p>PCIe设备的配置空间如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200723_005.png" alt=""></p>
<p><strong>注意：</strong></p>
<p>在实际工程中，在FPGA PCIe核设置好BAR配置空间的大小，系统软件根据大小分配PCIe总线地址空间。FPGA配置如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200724_001.png" alt=""></p>
<h2 id="MSI中断机制"><a href="#MSI中断机制" class="headerlink" title="MSI中断机制"></a>MSI中断机制</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>在PCI总线中，所有需要提交的中断请求，必须通过INTx引脚向处理器提交中断请求；而在PCIe总线中，PCIe设备向处理器提交中断，是通过MSI机制实现，不需要通过INTx引脚。</p>
<p>MSI机制就是使用存储器写请求TLP向处理器提交中断请求。这种MSI消息，也简称为MSI报文。此外MSI中断最多支持32个中断。32位和64位的MSI 报文协议结构如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200724_002.png" alt=""></p>
<p><strong>Message Control:</strong> 该字段存放当前PCIe设备使用的MSI机制进行中断请求的状态与控制信息。</p>
<p><strong>Message Address:</strong> 该字段存放MSI存储器写事务的目的地址低32位。</p>
<p><strong>Message Upper Address:</strong> 该字段存放MSI存储器写事务的目的地址高32位。</p>
<p>重点关注Message Control字段含义，如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200724_003.png" alt=""></p>
<h3 id="工程实践"><a href="#工程实践" class="headerlink" title="工程实践"></a>工程实践</h3><p>FPGA PCIe MSI控制器配置寄存器地址，如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200724_004.png" alt=""></p>
<p>MSI Control Register，如下图所示。</p>
<p><img src="http://jiali.clouddn.com/20200724_005.png" alt=""></p>
<p>通过MSI控制寄存器可将MSI中断配置成多消息中断模式，中断个数可通过Multiple Message Enable 配置，只读字段Multiple Message Capable表示系统分配给PCIe设备的中断向量数量。</p>
<p><strong>注意：</strong></p>
<p>曾经FPGA没有配置字段Multiple Message Capable，因为该字段默认为0,所以，无论怎么配置Multiple Message Enable，MSI只产生1个中断（0号MSI中断）。</p>
<p>FPGA PCIe设备中，cfg_interrupt_msi_int MSI各中断寄存器如下表所示。</p>
<p><img src="http://jiali.clouddn.com/20200724_006.png" alt=""></p>
<p>只要置位中断寄存器对应的Bit,就可以触发中断。例如，本次使用0，1，2号中断，在相应位置位就可以触发中断。</p>
<p>Linux MSI中断配置如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;1、申请四个中断</span><br><span class="line">pci_alloc_irq_vectors(pdev,1,4,PCI_IRQ_MSI);</span><br><span class="line">&#x2F;&#x2F;2、设置Multiple Message Enable字段为4</span><br><span class="line">control |&#x3D; 0x0020;</span><br><span class="line">pci_write_config_word(pdev,pdev-&gt;msi_cap+2,control);</span><br><span class="line">&#x2F;&#x2F;注册中断</span><br><span class="line">irq &#x3D; pci_irq_vector(pdev,0);</span><br><span class="line">err &#x3D; request_irq(irq, ps_pcie_intr_handler_no_msix, IRQF_SHARED, &quot;PCIE PS PCIe DMA Device&quot;, ptr_dma_desc_temp);</span><br><span class="line">irq &#x3D; pci_irq_vector(pdev,1);	</span><br><span class="line">err &#x3D; request_irq(irq, ps_pcie_intr_handler_no_msix_1, IRQF_SHARED, &quot;PCIE PS PCIe DMA Device_1&quot;, ptr_dma_desc_temp);</span><br><span class="line">irq &#x3D; pci_irq_vector(pdev,2);</span><br><span class="line">err &#x3D; request_irq(irq, ps_pcie_intr_handler_no_msix_2, IRQF_SHARED, &quot;PCIE PS PCIe DMA Device2&quot;, ptr_dma_desc_temp);</span><br><span class="line">&#x2F;&#x2F;编写中断函数</span><br><span class="line">略。。。</span><br></pre></td></tr></table></figure>









<p>参考：</p>
<p><a href="https://www.cnblogs.com/YINBin/p/10946247.html" target="_blank" rel="noopener">PCIe总线（协议简述）</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/26172972" target="_blank" rel="noopener">深入PCI与PCIe之一：硬件篇</a></p>
<p><a href="http://xilinx.eetrend.com/d6-xilinx/blog/2018-08/13327.html" target="_blank" rel="noopener">PCIe学习（一）：PCIe基础及生成PIO例程分析</a></p>
<p><a href="http://www.ssdfans.com/?p=8211" target="_blank" rel="noopener">老男孩读PCIe之一：从PCIe速度说起</a></p>
<p><a href="http://www.ssdfans.com/?p=8213" target="_blank" rel="noopener">老男孩读PCIe之二：PCIe拓扑结构</a></p>
<p><a href="http://www.ssdfans.com/?p=8214" target="_blank" rel="noopener">老男孩读PCIe之三：PCIe分层结构</a></p>
<p><a href="http://www.ssdfans.com/?p=8215" target="_blank" rel="noopener">老男孩读PCIe之四：TLP类型</a></p>
<p><a href="http://www.ssdfans.com/?p=8212" target="_blank" rel="noopener">老男孩读PCIe之五：TLP结构</a></p>
<p><a href="http://www.ssdfans.com/?p=8210" target="_blank" rel="noopener">老男孩读PCIe之六：配置和地址空间</a></p>
<p><a href="http://www.ssdfans.com/?p=8216" target="_blank" rel="noopener">老男孩读PCIe之七：TLP的路由</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="David Meng"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">David Meng</p>
  <div class="site-description" itemprop="description">冒险，创新，永不放弃</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">59</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jialimeng" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jialimeng" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:jiali201209@163.com" title="E-Mail → mailto:jiali201209@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://ilinuxkernel.com/" title="http:&#x2F;&#x2F;ilinuxkernel.com" rel="noopener" target="_blank">Linux Kernel Exploration</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.wowotech.net/" title="http:&#x2F;&#x2F;www.wowotech.net" rel="noopener" target="_blank">蜗窝科技</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://tinylab.org/" title="http:&#x2F;&#x2F;tinylab.org" rel="noopener" target="_blank">泰晓科技</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Meng</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
